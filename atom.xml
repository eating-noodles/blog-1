<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å†·çŸ³</title>
  <icon>https://coldstone.fun/avatar.png</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://coldstone.fun/"/>
  <updated>2020-06-18T09:46:58.876Z</updated>
  <id>https://coldstone.fun/</id>
  
  <author>
    <name>ColdStone</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æœ€å¥½çš„ä½ </title>
    <link href="https://coldstone.fun/post/2020/06/17/leetcode-1014/"/>
    <id>https://coldstone.fun/post/2020/06/17/leetcode-1014/</id>
    <published>2020-06-17T06:19:00.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="https://leetcode-cn.com/problems/best-sightseeing-pair/" target="_blank" rel="noopener">LeetCode 1014. æœ€ä½³è§‚å…‰ç»„åˆ</a></p><img src="./images/best_of_you.png" width="1106" style="width:553px" alt="best_of_you">]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;p&gt;&lt;a href=&quot;https://leetcode-cn.com/problems/best-sightseeing-pair/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;LeetCode 1014.
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="ä»£ç å†™è¯—" scheme="https://coldstone.fun/tags/%E4%BB%A3%E7%A0%81%E5%86%99%E8%AF%97/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆäºŒï¼‰é¥¼çŠ¶å›¾ğŸª</title>
    <link href="https://coldstone.fun/post/2020/06/09/flutter-pie-chart/"/>
    <id>https://coldstone.fun/post/2020/06/09/flutter-pie-chart/</id>
    <published>2020-06-09T06:08:00.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/flutter-pie-chart/cover.png" alt="pie"></p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ¥ä¸Šæ–‡ï¼Œæœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ Flutter ç»˜åˆ¶é¥¼çŠ¶å›¾ï¼Œæœ€ç»ˆæ•ˆæœå¦‚å›¾</p><img src="./images/flutter-pie-chart/pie.gif" width="524" style="width:260px"><p><a href="https://dartpad.dartlang.org/b8a2b88647fa75df5d31445a93cb390f" target="_blank" rel="noopener">åœ¨çº¿æŸ¥çœ‹</a></p><h2 id="å®šä¹‰-PieChart-amp-PiePart"><a href="#å®šä¹‰-PieChart-amp-PiePart" class="headerlink" title="å®šä¹‰ PieChart &amp; PiePart"></a>å®šä¹‰ PieChart &amp; PiePart</h2><p>ç¬¬ä¸€æ­¥å®šä¹‰ <code>PieChart</code> å’Œ <code>PiePart</code> ç±»ã€‚<code>PieChart</code> æ˜¯æ•´ä¸ªé¥¼çŠ¶å›¾æ§ä»¶ï¼Œæœ‰ <code>datas</code> å’Œ <code>legends</code> ä¸¤ä¸ªå±æ€§ï¼Œè¡¨ç¤ºé¥¼å›¾çš„æ•°æ®å’Œæ¯éƒ¨åˆ†çš„æ ‡è¯†ã€‚<br><code>PiePart</code> è¡¨ç¤ºé¥¼å›¾çš„ä¸€éƒ¨åˆ†ï¼Œæœ‰ <code>color</code>, <code>startAngle</code>, <code>sweepAngle</code> ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«è¡¨ç¤ºé¢œè‰²ï¼Œèµ·å§‹å¼§åº¦å€¼ï¼Œå æ®åœ†å½¢çš„å¼§åº¦å€¼ã€‚<code>PeiChartPainter</code> ç±»å®ç°äº†å…·ä½“çš„ç»˜åˆ¶æ–¹æ³•ã€‚</p><pre><code class="dart">class PiePart {  double sweepAngle;  final Color color;  final double startAngle;  PiePart(    this.startAngle,    this.sweepAngle,    this.color,  );}class PieChart extends StatefulWidget {  final List&lt;double&gt; datas;  final List&lt;String&gt; legends;  const PieChart({    @required this.datas,    @required this.legends,  });  @override  _PieChartState createState() =&gt; _PieChartState();}class _PieChartState extends State&lt;PieChart&gt; with TickerProviderStateMixin {  double _total = 0.0;  final List&lt;PiePart&gt; _parts = &lt;PiePart&gt;[];  @override  Widget build(BuildContext context) {    return Column(      mainAxisAlignment: MainAxisAlignment.center,      children: [        Container(          width: 300,          height: 300,          child: CustomPaint(            painter: PeiChartPainter(              total: _total,              parts: _parts,              datas: widget.datas,              legends: widget.legends            ),          ),        ),      ],    );  }}class PeiChartPainter extends CustomPainter {  final double total;  final List&lt;double&gt; datas;  final List&lt;PiePart&gt; parts;  final List&lt;String&gt; legends;  PeiChartPainter({    @required this.total,    @required this.datas,    @required this.parts,    @required this.legends,  });  @override  void paint(Canvas canvas, Size size) {    // TODO  }  @override  bool shouldRepaint(PeiChartPainter oldDelegate) =&gt; true;}</code></pre><h2 id="ç»˜åˆ¶åœ†æ¡†"><a href="#ç»˜åˆ¶åœ†æ¡†" class="headerlink" title="ç»˜åˆ¶åœ†æ¡†"></a>ç»˜åˆ¶åœ†æ¡†</h2><p>å…ˆç»˜åˆ¶å›¾è¡¨çš„åœ†æ¡†ï¼Œåœ¨ <code>PeiChartPainter</code> ä¸Šæ·»åŠ  <code>drawCircle</code> æ–¹æ³•ï¼Œä»¥åœ†çš„ä¸­å¿ƒç‚¹å’Œåœ†çš„åŠå¾„ç»˜åˆ¶ä¸€ä¸ªç©ºå¿ƒåœ†å½¢ã€‚</p><pre><code class="dart">void drawCircle(Canvas canvas, Size size) {  final sw = size.width;  final sh = size.height;  // ç¡®å®šåœ†çš„åŠå¾„  final double radius = math.min(sw, sh) / 2;  // å®šä¹‰ä¸­å¿ƒç‚¹  final Offset center = Offset(sw / 2, sh / 2);  // å®šä¹‰åœ†å½¢çš„ç»˜åˆ¶å±æ€§  final paint = Paint()    ..style = PaintingStyle.stroke    ..color = Colors.grey    ..strokeWidth = 1.0;  // ä½¿ç”¨ Canvas çš„ drawCircle ç»˜åˆ¶  canvas.drawCircle(center, radius, paint);}@overridevoid paint(Canvas canvas, Size size) {  drawCircle(canvas, size);}</code></pre><img src="./images/flutter-pie-chart/circle.png" width="520" style="width:260px"><h2 id="ç»˜åˆ¶æ ‡è¯†"><a href="#ç»˜åˆ¶æ ‡è¯†" class="headerlink" title="ç»˜åˆ¶æ ‡è¯†"></a>ç»˜åˆ¶æ ‡è¯†</h2><p>è¿™ä¸€æ­¥éœ€è¦å…ˆåœ¨ <code>_PieChartState</code> é‡Œé¢è¿›è¡Œæ•°æ®çš„åˆå§‹åŒ–ï¼Œç„¶åç»˜åˆ¶æ¯ä¸ªæ•°æ®å¯¹åº”çš„æ ‡è¯†ï¼Œåˆ†ä»¥ä¸‹å‡ æ­¥è¿›è¡Œ</p><ol><li>è®¡ç®—å‡ºæ¯ä¸ªæ•°æ®å æ€»å’Œçš„å æ¯”</li><li>æ ¹æ®å æ¯”è®¡ç®—æ•°æ®å æ®åœ†çš„å¼§åº¦å€¼</li><li>æ ¹æ®ä¹‹å‰æ•°æ®å æ®åœ†å½¢çš„å¼§åº¦å€¼è®¡ç®—å‡ºä¸‹ä¸€ä¸ªæ•°æ®çš„èµ·å§‹å¼§åº¦å€¼</li><li>æ ¹æ®è®¡ç®—å‡ºçš„èµ·å§‹å¼§åº¦å€¼å’Œå æ®å¼§åº¦å€¼åˆ›å»º <code>PiePart</code> å¯¹è±¡</li><li>ä½¿ç”¨ <code>PiePart</code> å¯¹è±¡ç»˜åˆ¶æ ‡è¯†</li></ol><pre><code class="dart">class _PieChartState extends State&lt;PieChart&gt; with TickerProviderStateMixin {  double _total = 0.0;  final List&lt;PiePart&gt; _parts = &lt;PiePart&gt;[];  @override  void initState() {    super.initState();    List&lt;double&gt; datas = widget.datas;    // è®¡ç®—å‡ºæ•°æ®æ€»å’Œ    _total = datas.reduce((a, b) =&gt; a + b);    // å®šä¹‰ä¸€ä¸ªèµ·å§‹å˜é‡    double startAngle = 0.0;    for (int i = 0; i &lt; datas.length; i++) {      final data = datas[i];      // è®¡ç®—å‡ºæ¯ä¸ªæ•°æ®æ‰€å çš„å¼§åº¦å€¼      final angle = (data / _total) * -math.pi * 2;      PiePart peiPart;      if (i &gt; 0) {        // ä¸‹ä¸€ä¸ªæ•°æ®çš„èµ·å§‹å¼§åº¦å€¼ç­‰äºä¹‹å‰çš„æ•°æ®å¼§åº¦å€¼ä¹‹å’Œ        double lastSweepAngle = _parts[i - 1].sweepAngle;        startAngle += lastSweepAngle;        peiPart = PiePart(startAngle, angle, colors[i]);      } else {        // ç¬¬ä¸€ä¸ªæ•°æ®çš„èµ·å§‹å¼§åº¦ä¸º 0.0        peiPart = PiePart(0.0, angle, colors[i]);      }      // æ·»åŠ åˆ°æ•°ç»„ä¸­      _parts.add(peiPart);    }  }    @override  Widget build(BuildContext context) {    return Column(      mainAxisAlignment: MainAxisAlignment.center,      children: [        Container(          width: 300,          height: 300,          child: CustomPaint(            // å°†æ•°æ®ä¼ ç»™ PeiChartPainter            painter: PeiChartPainter(              total: _total,              parts: _parts,              datas: widget.datas,              legends: widget.legends,            ),          ),        ),      ],    );  }}</code></pre><p>åœ¨ PeiChartPainter ä¸Šæ·»åŠ  <code>drawLegends</code> æ–¹æ³•ï¼Œåœ¨åœ†æ¡†çš„å¤–å›´ç»˜åˆ¶æ¯éƒ¨åˆ†å¯¹åº”çš„æ ‡è¯†ã€‚</p><pre><code class="dart">void drawLegends(Canvas canvas, Size size) {  final sw = size.width;  final sh = size.height;  final double radius = math.min(sw, sh) / 2;  final double fontSize = 12.0;  for (int i = 0; i &lt; datas.length; i++) {    final PiePart part = parts[i];    final String legend = legends[i];    // æ ¹æ®æ¯éƒ¨åˆ†çš„èµ·å§‹å¼§åº¦åŠ ä¸Šè‡ªèº«å¼§åº¦å€¼çš„ä¸€åŠå¾—åˆ°æ¯éƒ¨åˆ†çš„ä¸­é—´å¼§åº¦å€¼    final radians = part.startAngle + part.sweepAngle / 2;    // æ ¹æ®ä¸‰è§’å‡½æ•°è®¡ç®—ä¸­å‡ºæ ‡è¯†æ–‡å­—çš„ x å’Œ y ä½ç½®ï¼Œéœ€è¦åŠ ä¸Šå®½å’Œé«˜çš„ä¸€åŠé€‚é… Canvas çš„åæ ‡    double x = math.cos(radians) * (radius + 32) + sw / 2 - fontSize;    double y = math.sin(radians) * (radius + 32) + sh / 2;    final offset = Offset(x, y);    // ä½¿ç”¨ TextPainter ç»˜åˆ¶æ–‡å­—æ ‡è¯†    TextPainter(      textAlign: TextAlign.center,      text: TextSpan(        text: legend,        style: TextStyle(          fontSize: fontSize,          color: Colors.black,        ),      ),      textDirection: TextDirection.ltr,    )      ..layout(        minWidth: 0,        maxWidth: size.width,      )      ..paint(canvas, offset);  }}@overridevoid paint(Canvas canvas, Size size) {  drawCircle(canvas, size);  drawLegends(canvas, size);}</code></pre><img src="./images/flutter-pie-chart/legend.png" width="520" style="width:260px"><p>è®¡ç®—æ–‡å­—ä½ç½®ç”¨åˆ°çš„çš„ä¸‰è§’å‡½æ•°æ˜¯</p><p><img src="./images/flutter-pie-chart/angle.png" alt="angle"></p><h2 id="ç»˜åˆ¶æ•°æ®å¯¹åº”çš„å¼§å½¢"><a href="#ç»˜åˆ¶æ•°æ®å¯¹åº”çš„å¼§å½¢" class="headerlink" title="ç»˜åˆ¶æ•°æ®å¯¹åº”çš„å¼§å½¢"></a>ç»˜åˆ¶æ•°æ®å¯¹åº”çš„å¼§å½¢</h2><p>åœ¨ <code>PeiChartPainter</code> ä¸Šæ·»åŠ  <code>drawParts</code> æ–¹æ³•ï¼Œç»˜åˆ¶æ¯ä¸ªæ•°æ®å¯¹åº”çš„å¼§å½¢ã€‚</p><pre><code class="dart">void drawParts(Canvas canvas, Size size) {  final sw = size.width;  final sh = size.height;  final double fontSize = 10.0;  final double radius = math.min(sw, sh) / 2;  final Offset center = Offset(sw / 2, sh / 2);  // åˆ›å»ºå¼§å½¢ä¾ç…§çš„çŸ©å½¢  final rect = Rect.fromCenter(    center: center,    width: radius * 2,    height: radius * 2,  );  // è®¾ç½®ç»˜åˆ¶å±æ€§  final paint = Paint()    ..strokeWidth = 0.0    ..isAntiAlias = true    ..style = PaintingStyle.fill;  for (int i = 0; i &lt; parts.length; i++) {    final PiePart part = parts[i];    // è®¾ç½®æ¯éƒ¨åˆ†çš„é¢œè‰²    paint.color = part.color;    // ä½¿ç”¨ drawArc æ–¹æ³•ç”»å‡ºå¼§å½¢ï¼Œå‚æ•°ä¾æ¬¡æ˜¯ä¾ç…§çš„çŸ©å½¢ï¼Œèµ·å§‹å¼§åº¦å€¼ï¼Œå æ®çš„å¼§åº¦å€¼ï¼Œæ˜¯å¦ä»ä¸­å¿ƒç‚¹ç»˜åˆ¶ï¼Œç»˜åˆ¶å±æ€§    canvas.drawArc(rect, part.startAngle, part.sweepAngle, true, paint);    final double data = datas[i];    // è®¡ç®—æ¯éƒ¨åˆ†å æ¯”    final String percent = (data / total * 100).toStringAsFixed(1);    final double radians = part.startAngle + part.sweepAngle / 2;    // ä½¿ç”¨ä¸‰è§’å‡½æ•°è®¡ç®—æ–‡å­—ä½ç½®    double x = math.cos(radians) * radius / 2 + sw / 2 - fontSize * 3;    double y = math.sin(radians) * radius / 2 + sh / 2;    final Offset offset = Offset(x, y);    // ä½¿ç”¨ TextPainter ç»˜åˆ¶æ–‡å­—æ ‡è¯†    TextPainter(      textAlign: TextAlign.start,      text: TextSpan(        text: &#39;$data $percent%&#39;,        style: TextStyle(          fontSize: fontSize,          color: Colors.white,          fontWeight: FontWeight.bold,        ),      ),      textDirection: TextDirection.ltr,    )      ..layout(        minWidth: 0,        maxWidth: size.width,      )      ..paint(canvas, offset);  }}@overridevoid paint(Canvas canvas, Size size) {  drawCircle(canvas, size);  drawLegends(canvas, size);  drawParts(canvas, size);}</code></pre><img src="./images/flutter-pie-chart/part.png" width="520" style="width:260px"><h2 id="æ·»åŠ åŠ¨ç”»"><a href="#æ·»åŠ åŠ¨ç”»" class="headerlink" title="æ·»åŠ åŠ¨ç”»"></a>æ·»åŠ åŠ¨ç”»</h2><p>æœ€åç»™é¥¼å›¾æ·»åŠ ä¸€ä¸ªæ•°æ®ä¸æ–­å¢é•¿çš„åŠ¨ç”»æ•ˆæœï¼Œåœ¨ <code>_PieChartState</code> æ·»åŠ åŠ¨ç”»çš„æ§åˆ¶å™¨ <code>_controller</code> å’Œä¿å­˜åŠ¨ç”»æ•°æ®çš„ <code>_animateDatas</code> æ•°ç»„ã€‚åœ¨ <code>initState</code> ä¸­åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨å’Œå¡«å…… <code>_animateDatas</code> æ•°ç»„ã€‚ç„¶ååˆ›å»ºä¸¤ä¸ª <code>double</code> ç±»å‹çš„è¡¥é—´åŠ¨ç”»ï¼Œå°†åŠ¨ç”»å€¼ä¼ ç»™ <code>PeiChartPainter</code> ä½¿ç”¨å³å¯ã€‚</p><pre><code class="dart">class _PieChartState extends State&lt;PieChart&gt; with TickerProviderStateMixin {  double _total = 0.0;  AnimationController _controller;  List&lt;double&gt; _animateDatas = [];  final List&lt;PiePart&gt; _parts = &lt;PiePart&gt;[];  @override  void initState() {    super.initState();    // åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨    _controller = AnimationController(      duration: Duration(milliseconds: 3000),      vsync: this,    );    List&lt;double&gt; datas = widget.datas;    // è®¡ç®—å‡ºæ•°æ®æ€»å’Œ    _total = datas.reduce((a, b) =&gt; a + b);    // è®¾ç½®ä¸€ä¸ªèµ·å§‹å˜é‡    double startAngle = 0.0;    for (int i = 0; i &lt; datas.length; i++) {      // å¡«å……åŠ¨ç”»æ•°ç»„      _animateDatas.add(0.0);      final data = datas[i];      // è®¡ç®—å‡ºæ¯ä¸ªæ•°æ®æ‰€å çš„å¼§åº¦å€¼      final angle = (data / _total) * -math.pi * 2;      PiePart peiPart;      if (i &gt; 0) {        // ä¸‹ä¸€ä¸ªæ•°æ®çš„èµ·å§‹å¼§åº¦å€¼ç­‰äºä¹‹å‰çš„å¼§åº¦å€¼ç›¸åŠ         double lastSweepAngle = _parts[i - 1].sweepAngle;        startAngle += lastSweepAngle;        peiPart = PiePart(startAngle, angle, colors[i]);      } else {        // ç¬¬ä¸€ä¸ªæ•°æ®çš„èµ·å§‹å¼§åº¦ä¸º 0.0        peiPart = PiePart(0.0, angle, colors[i]);      }      // æ·»åŠ åˆ°æ•°ç»„ä¸­      _parts.add(peiPart);      CurvedAnimation curvedAnimation = CurvedAnimation(        parent: _controller,        curve: Curves.ease,      );      // åˆ›å»ºå¼§å½¢çš„è¡¥é—´åŠ¨ç”»      final partTween = Tween&lt;double&gt;(begin: 0.0, end: peiPart.sweepAngle);      Animation&lt;double&gt; animation = partTween.animate(curvedAnimation);      // åˆ›å»ºæ–‡å­—çš„è¡¥é—´åŠ¨ç”»      final percentTween = Tween&lt;double&gt;(begin: 0.0, end: data);      Animation&lt;double&gt; percentAnimation =          percentTween.animate(curvedAnimation);      // åœ¨åŠ¨ç”»å¯åŠ¨åä¸æ–­æ”¹å˜æ•°æ®å€¼      _controller.addListener(() {        _parts[i].sweepAngle = animation.value;        _animateDatas[i] =            double.parse(percentAnimation.value.toStringAsFixed(1));        setState(() {});      });      // å¼€å§‹åŠ¨ç”»      _controller.forward();    }  }  @override  Widget build(BuildContext context) {    return Column(      mainAxisAlignment: MainAxisAlignment.center,      children: [        Container(          width: 300,          height: 300,          child: CustomPaint(            // å°†æ•°æ®ä¼ ç»™ PeiChartPainter            painter: PeiChartPainter(              total: _total,              parts: _parts,              datas: _animateDatas,              legends: widget.legends,            ),          ),        ),        SizedBox(height: 80),        Container(          decoration: BoxDecoration(            color: Colors.blue,            shape: BoxShape.circle,          ),          child: IconButton(            color: Colors.white,            icon: Icon(Icons.refresh),            onPressed: () {              _controller.reset();              _controller.forward();            },          ),        ),      ],    );  }}</code></pre><p>è‡³æ­¤æ•´ä¸ªé¥¼çŠ¶å›¾çš„ç»˜åˆ¶å°±å®Œæˆäº†ï¼Œä¼ å…¥æ•°æ®å³å¯ä½¿ç”¨ ğŸ‰ğŸ‰ğŸ‰</p><pre><code class="dart">PieChart(  datas: [60.0, 50.0, 40.0, 30.0, 90.0],  legends: [&#39;ä¸€æœˆ&#39;, &#39;äºŒæœˆ&#39;, &#39;ä¸‰æœˆ&#39;, &#39;å››æœˆ&#39;, &#39;äº”æœˆ&#39;],);</code></pre><p>å®Œæ•´ä»£ç åœ°å€ï¼š<a href="https://github.com/xrr2016/flutter-charts/blob/master/lib/charts/pie_chart.dart" target="_blank" rel="noopener">pie_chart.dart</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨ Flutter ç»˜åˆ¶ä¸€ä¸ªé¥¼çŠ¶å›¾ï¼Œä½¿ç”¨äº†ä¸€ç‚¹ä¸‰è§’å‡½æ•°ï¼Œå…³é”®ç‚¹åœ¨äºè®¡ç®—å‡ºæ¯ä¸ªæ•°æ®å æ®æ•´ä¸ªåœ†å½¢çš„å¼§åº¦å€¼ï¼Œä»¥åŠæ•°æ®çš„èµ·å§‹å¼§åº¦å€¼ã€‚<br>æ•°å€¼å¢é•¿çš„åŠ¨ç”»æ•ˆæœä½¿ç”¨ä¸€ä¸ª <code>AnimationController</code> åœ¨å¼€å§‹åŠ¨ç”»åä¸æ–­çš„æ›´æ–°ç»˜åˆ¶ä½¿ç”¨çš„æ•°æ®ï¼Œåœ¨å°†æ•°æ®ä¼ é€’ç»™ <code>PeiChartPainter</code> ä½¿ç”¨å³å¯å®ç°ã€‚</p><h2 id="é™„è¨€"><a href="#é™„è¨€" class="headerlink" title="é™„è¨€"></a>é™„è¨€</h2><p>å‡†å¤‡å†™ä¸€ç³»åˆ—å…³äºç”¨ Flutter ç”»å›¾è¡¨çš„æ–‡ç« ï¼Œç”¨æ¥åˆ†äº«è¿™æ–¹é¢çš„çŸ¥è¯†ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯è¿™ä¸ªç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œé¢„è®¡ 6 ç¯‡ã€‚</p><ol><li><a href="https://coldstone.fun/post/2020/05/31/flutter-bar-chart/">ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆä¸€ï¼‰æŸ±çŠ¶å›¾ğŸ“Š</a></li><li><a href="https://coldstone.fun/post/2020/06/09/flutter-pie-chart/">ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆäºŒï¼‰é¥¼çŠ¶å›¾ğŸª</a>ï¼ˆæœ¬æ–‡ï¼‰</li><li>ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆä¸‰ï¼‰æŠ˜çº¿å›¾ğŸ“ˆ</li><li>ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆå››ï¼‰é›·è¾¾å›¾ğŸ¯</li><li>ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆäº”ï¼‰ç¯çŠ¶å›¾ğŸ©</li><li>ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆå…­ï¼‰æ¡å½¢å›¾ğŸ“</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/flutter-pie-chart/cover.png&quot; alt=&quot;pie&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆä¸€ï¼‰æŸ±çŠ¶å›¾ğŸ“Š</title>
    <link href="https://coldstone.fun/post/2020/05/31/flutter-bar-chart/"/>
    <id>https://coldstone.fun/post/2020/05/31/flutter-bar-chart/</id>
    <published>2020-05-31T14:00:00.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/flutter-bar-chart/cover.png" alt="bar"></p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ <a href="https://flutter.dev/" target="_blank" rel="noopener">Flutter</a> ï¼ˆGoogle å¼€æºçš„ UI å·¥å…·åŒ…ï¼Œå¸®åŠ©å¼€å‘è€…é€šè¿‡ä¸€å¥—ä»£ç åº“é«˜æ•ˆæ„å»ºå¤šå¹³å°ç²¾ç¾åº”ç”¨ï¼Œæ”¯æŒç§»åŠ¨ã€Webã€æ¡Œé¢å’ŒåµŒå…¥å¼å¹³å°ï¼‰ ç»˜åˆ¶ä¸€ä¸ªå¸¦æœ‰åŠ¨ç”»æ•ˆæœçš„æŸ±çŠ¶å›¾è¡¨ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾ã€‚</p><img src="./images/flutter-bar-chart/bar-chart.gif" width="568" style="width:260px"><p>è¦ç»˜åˆ¶è¿™æ ·çš„å›¾è¡¨æ™®é€šçš„ Widget éš¾ä»¥å®ç°ï¼Œè¿™æ—¶å°±éœ€è¦ <code>CustomPaint</code> å’Œ <code>CustomPainter</code> å‡ºåœºäº†ï¼Œå®ƒä»¬ç±»ä¼¼äº Web é‡Œé¢çš„ <code>&lt;canvas&gt;</code> å…ƒç´ ï¼Œ<code>CustomPaint</code> æä¾›äº†ä¸€ä¸ªç»˜åˆ¶åŒºåŸŸï¼Œè€Œ <code>CustomPainter</code> æ‹¥æœ‰å…·ä½“çš„ç»˜åˆ¶æ–¹æ³•ã€‚</p><h2 id="CustomPaint-æ˜¯ä»€ä¹ˆ"><a href="#CustomPaint-æ˜¯ä»€ä¹ˆ" class="headerlink" title="CustomPaint æ˜¯ä»€ä¹ˆ"></a>CustomPaint æ˜¯ä»€ä¹ˆ</h2><p><code>CustomPaint</code> æ˜¯ç”¨æ¥æä¾›ç”»å¸ƒçš„æ§ä»¶ï¼Œå®ƒä½¿ç”¨ä¼ å…¥ç”»ç¬” <code>painter</code> åœ¨ <code>child</code> æ§ä»¶åé¢ç»˜åˆ¶å›¾å½¢, ï¼Œ<code>foregroundPainter</code> ç”»ç¬”ç»˜åˆ¶åœ¨ <code>child</code> æ§ä»¶ä¹‹å‰ã€‚<code>size</code> å±æ€§æ§åˆ¶ç”»å¸ƒçš„å¤§å°ï¼Œå‡å¦‚å®šä¹‰äº†å­æ§ä»¶ <code>child</code>ï¼Œé‚£ä¹ˆç”»å¸ƒçš„å¤§å°å°†ç”±å­æ§ä»¶çš„å¤§å°å†³å®šï¼Œ<code>size</code> å±æ€§è¢«å¿½ç•¥ã€‚</p><pre><code class="dart">class CustomPaint extends SingleChildRenderObjectWidget {  const CustomPaint({    Key key,    this.painter,    this.foregroundPainter,    this.size = Size.zero,    this.isComplex = false,    this.willChange = false,    Widget child,  })}</code></pre><p>è€Œ <code>CustomPainter</code> æ˜¯å®ç°ç»˜åˆ¶å›¾å½¢çš„æ§ä»¶ï¼Œè¦åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶å›¾å½¢éœ€è¦å®ç°å®ƒçš„ <code>paint</code> æ–¹æ³•ã€‚<code>paint</code> æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ<code>Canvas canvas</code> å’Œ <code>Size size</code>ã€‚<code>Size</code> å¯¹è±¡è¡¨ç¤ºç”»å¸ƒçš„å°ºå¯¸ï¼Œ<code>Canvas</code> å¯¹è±¡ä¸Šæ˜¯å…·ä½“çš„ç»˜åˆ¶å›¾å½¢çš„æ–¹æ³•ã€‚</p><pre><code class="dart">abstract class CustomPainter extends Listenable {  void paint(Canvas canvas, Size size);  bool shouldRepaint(covariant CustomPainter oldDelegate);}</code></pre><p><code>Canvas canvas</code> å¯¹è±¡ä¸»è¦çš„ç»˜åˆ¶å›¾å½¢æ–¹æ³•æœ‰</p><table><thead><tr><th align="left">æ–¹æ³•å</th><th align="left">å‚æ•°</th><th align="left">æ•ˆæœ</th></tr></thead><tbody><tr><td align="left"><code>drawColor</code></td><td align="left"><code>Color color</code>, <code>BlendMode blendMode</code></td><td align="left">ç»˜åˆ¶é¢œè‰²åˆ°ç”»å¸ƒä¸Š</td></tr><tr><td align="left"><code>drawLine</code></td><td align="left"><code>Offset p1</code>, <code>Offset p2</code>, <code>Paint paint</code></td><td align="left">ä¸¤ç‚¹ä¹‹é—´ç”»çº¿</td></tr><tr><td align="left"><code>drawPaint</code></td><td align="left"><code>Paint paint</code></td><td align="left">ä½¿ç”¨ [Paint] å¡«å……ç”»å¸ƒ</td></tr><tr><td align="left"><code>drawRect</code></td><td align="left"><code>Rect rect</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶çŸ©å½¢</td></tr><tr><td align="left"><code>drawRRect</code></td><td align="left"><code>RRect rrect</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶å¸¦åœ†è§’çš„çŸ©å½¢</td></tr><tr><td align="left"><code>drawOval</code></td><td align="left"><code>Rect rect</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶æ¤­åœ†</td></tr><tr><td align="left"><code>drawCircle</code></td><td align="left"><code>Offset c</code>, <code>double radius</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶åœ†å½¢</td></tr><tr><td align="left"><code>drawArc</code></td><td align="left"><code>Rect rect</code>, <code>double startAngle</code>, <code>double sweepAngle</code>, <code>bool useCenter</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶å¼§å½¢</td></tr><tr><td align="left"><code>drawPath</code></td><td align="left"><code>Path path</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶è·¯å¾„</td></tr><tr><td align="left"><code>drawImage</code></td><td align="left"><code>Image image</code>, <code>Offset p</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶å›¾åƒ</td></tr><tr><td align="left"><code>drawPoints</code></td><td align="left"><code>PointMode pointMode</code>, <code>List&lt;Offset&gt; points</code>, <code>Paint paint</code></td><td align="left">ç»˜åˆ¶å¤šä¸ªç‚¹</td></tr></tbody></table><p>è¦å°†å›¾å½¢ç»˜åˆ¶åˆ°ç”»å¸ƒä¸Šéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡³ <code>CustomPainter</code> çš„è‡ªå®šä¹‰ç”»ç¬”ï¼Œä¾‹å¦‚ç»˜åˆ¶ä¸€ä¸ªçŸ©å½¢éœ€è¦å®ç°ä¸€ä¸ªç»˜åˆ¶çŸ©å½¢çš„ç”»ç¬” <code>RectanglePainter</code>ï¼Œç„¶ååœ¨ç”»å¸ƒ <code>CustomPaint</code> ä¸Šåº”ç”¨å®ƒã€‚</p><pre><code class="dart">class RectanglePainter extends CustomPainter {  @override  void paint(Canvas canvas, Size size) {    // å®šä¹‰ä¸€ä¸ªçŸ©å½¢    final Rect rect = Rect.fromLTWH(50.0, 50.0, 100.0, 100.0);    // æŒ‡å®šç»˜åˆ¶çš„æ ·å¼    final Paint paint = Paint()      ..color = Colors.orange      ..strokeWidth = 4.0      ..style = PaintingStyle.stroke      ..isAntiAlias = true;    // ä½¿ç”¨ drawRect ç»˜åˆ¶çŸ©å½¢    canvas.drawRect(rect, paint);  }  @override  bool shouldRepaint(RectanglePainter oldDelegate) =&gt; false;}class Rectangle extends StatelessWidget {  @override  Widget build(BuildContext context) {    return Center(      child: CustomPaint(        // ä½¿ç”¨ RectanglePainter åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶        painter: RectanglePainter(),        child: Container(          width: 300,          height: 300,          decoration: BoxDecoration(            border: Border.all(              width: 1.0,              color: Colors.grey[300],            ),          ),        ),      ),    );  }}</code></pre><p>æ•ˆæœå¦‚å›¾</p><img src="./images/flutter-bar-chart/rect.png" width="520" style="width:260px"><h2 id="ç»˜åˆ¶æŸ±çŠ¶å›¾è¡¨"><a href="#ç»˜åˆ¶æŸ±çŠ¶å›¾è¡¨" class="headerlink" title="ç»˜åˆ¶æŸ±çŠ¶å›¾è¡¨"></a>ç»˜åˆ¶æŸ±çŠ¶å›¾è¡¨</h2><p>ä»‹ç»å®Œæ¯•ï¼Œä¸‹é¢å¼€å§‹ç»˜åˆ¶æŸ±çŠ¶å›¾è¡¨ï¼Œç¬¬ä¸€æ­¥åˆ›å»º <code>BarChart</code> æ§ä»¶ä»£è¡¨æŸ±çŠ¶å›¾ï¼Œå®ƒæœ‰ä¸¤ä¸ªæ„é€ å‚æ•°ä¸€ä¸ªæ˜¯ <code>data</code> ç”¨æ¥æ¥æ”¶å›¾è¡¨æ•°æ®ï¼Œä»¥åŠ <code>xAxis</code> è¡¨ç¤ºå›¾è¡¨æ¨ªè½´æ ‡è¯†ã€‚</p><pre><code class="dart">class BarChart extends StatefulWidget {  final List&lt;double&gt; data;  final List&lt;String&gt; xAxis;  const BarChart({    @required this.data,    @required this.xAxis,  });  @override  _BarChartState createState() =&gt; _BarChartState();}class _BarChartState extends State&lt;BarChart&gt; with TickerProviderStateMixin {  @override  Widget build(BuildContext context) {    return Column(      mainAxisAlignment: MainAxisAlignment.center,      children: [        CustomPaint(          painter: BarChartPainter(            datas: widget.data,            xAxis: widget.xAxis,          ),          child: Container(width: 300, height: 300),        ),      ],    );  }}</code></pre><p>ç„¶ååˆ›å»ºä¸€ä¸ªç”¨æ¥ç»˜åˆ¶çš„è‡ªå®šä¹‰ç”»ç¬” <code>BarChartPainter</code>ã€‚</p><pre><code class="dart">class BarChartPainter extends CustomPainter {  final List&lt;double&gt; datas;  final List&lt;String&gt; xAxis;  BarChartPainter({    @required this.xAxis,    @required this.datas,  });   @override  void paint(Canvas canvas, Size size) {    // TODO  }  @override  bool shouldRepaint(BarChartPainter oldDelegate) =&gt; true;  @override  bool shouldRebuildSemantics(BarChartPainter oldDelegate) =&gt; false;}</code></pre><h3 id="ç»˜åˆ¶åæ ‡è½´"><a href="#ç»˜åˆ¶åæ ‡è½´" class="headerlink" title="ç»˜åˆ¶åæ ‡è½´"></a>ç»˜åˆ¶åæ ‡è½´</h3><p>åœ¨ <code>BarChartPainter</code> ä¸Šå®šä¹‰ä¸€ä¸ª <code>_drawAxis</code> æ–¹æ³•ç”¨äºç»˜åˆ¶æ¨ªåæ ‡è½´ï¼Œä½¿ç”¨ä¸€ä¸ªç”±å·¦ä¸Šï¼Œå·¦ä¸‹ï¼Œå³ä¸‹ä¸‰ä¸ªç‚¹æ§åˆ¶çš„ <code>Path</code> è·¯å¾„ç»˜åˆ¶ã€‚</p><pre><code class="dart">void _drawAxis(Canvas canvas, Size size) {  final double sw = size.width;  final double sh = size.height;  // ä½¿ç”¨ Paint å®šä¹‰è·¯å¾„çš„æ ·å¼  final Paint paint = Paint()    ..color = Colors.black87    ..style = PaintingStyle.stroke    ..strokeWidth = 1.0;  // ä½¿ç”¨ Path å®šä¹‰ç»˜åˆ¶çš„è·¯å¾„ï¼Œä»ç”»å¸ƒçš„å·¦ä¸Šè§’åˆ°å·¦ä¸‹è§’åœ¨åˆ°å³ä¸‹è§’  final Path path = Path()    ..moveTo(0, 0)    ..lineTo(0, sh)    ..lineTo(sw, sh);  // ä½¿ç”¨ drawPath æ–¹æ³•ç»˜åˆ¶è·¯å¾„  canvas.drawPath(path, paint);}@overridevoid paint(Canvas canvas, Size size) {  _drawAxis(canvas, size);}</code></pre><p>æ•ˆæœå¦‚ä¸‹</p><img src="./images/flutter-bar-chart/chart-axis.png" width="508" style="width:260px" alt="chart-axis"><h3 id="ç»˜åˆ¶æ ‡è¯†"><a href="#ç»˜åˆ¶æ ‡è¯†" class="headerlink" title="ç»˜åˆ¶æ ‡è¯†"></a>ç»˜åˆ¶æ ‡è¯†</h3><p>åœ¨ <code>BarChartPainter</code> ä¸Šå®šä¹‰ä¸€ä¸ª <code>_drawLabels</code> æ–¹æ³•ç»˜åˆ¶çºµè½´æ ‡è¯†ã€‚</p><pre><code class="dart">void _drawLabels(Canvas canvas, Size size) {  final double gap = 50.0;  final double sh = size.height;  final List&lt;double&gt; yAxisLabels = [];  Paint paint = Paint()    ..color = Colors.black87    ..strokeWidth = 2.0;  // ä½¿ç”¨ 50.0 ä¸ºé—´éš”ç»˜åˆ¶æ¯”ä¼ å…¥æ•°æ®å¤šä¸€ä¸ªçš„æ ‡è¯†  for (int i = 0; i &lt;= datas.length; i++) {    yAxisLabels.add(gap * i);  }  yAxisLabels.asMap().forEach(    (index, label) {      // æ ‡è¯†çš„é«˜åº¦ä¸ºç”»å¸ƒé«˜åº¦å‡å»æ ‡è¯†çš„å€¼      final double top = sh - label;      final rect = Rect.fromLTWH(0, top, 4, 1);      final Offset textOffset = Offset(        0 - labelFontSize * 3,        top - labelFontSize / 2,      );      // ç»˜åˆ¶ Y è½´å³è¾¹çš„çº¿æ¡      canvas.drawRect(rect, paint);      // ç»˜åˆ¶æ–‡å­—éœ€è¦ç”¨ `TextPainter`ï¼Œæœ€åè°ƒç”¨ paint æ–¹æ³•ç»˜åˆ¶æ–‡å­—      TextPainter(        text: TextSpan(          text: label.toStringAsFixed(0),          style: TextStyle(fontSize: labelFontSize, color: Colors.black87),        ),        textAlign: TextAlign.right,        textDirection: TextDirection.ltr,        textWidthBasis: TextWidthBasis.longestLine,      )        ..layout(minWidth: 0, maxWidth: 24)        ..paint(canvas, textOffset);    },  );}@overridevoid paint(Canvas canvas, Size size) {  _drawAxis(canvas, size);  _drawLabels(canvas, size);}</code></pre><p>æ•ˆæœå¦‚ä¸‹</p><img src="./images/flutter-bar-chart/chart-yaxis.png" width="520" style="width:260px" alt="chart-yaxis"><h3 id="ç»˜åˆ¶æ•°æ®çŸ©å½¢"><a href="#ç»˜åˆ¶æ•°æ®çŸ©å½¢" class="headerlink" title="ç»˜åˆ¶æ•°æ®çŸ©å½¢"></a>ç»˜åˆ¶æ•°æ®çŸ©å½¢</h3><p>ç„¶åå®šä¹‰ä¸€ä¸ª <code>_darwBars</code> æ–¹æ³•å°†å…·ä½“çŸ©å½¢å’Œæ¨ªè½´æ ‡è¯†ç»˜åˆ¶å‡ºæ¥ã€‚</p><pre><code class="dart">List&lt;Color&gt; colors = [  Color(0xff8e43e7),  Color(0xffff4f81),  Color(0xff1cc7d0),  Color(0xff00aeff),  Color(0xff3369e7),  Color(0xffb84592),  Color(0xff2dde98),  Color(0xffff6c5f),  Color(0xff003666),  Color(0xffffc168),  Color(0xff050f2c),];void _darwBars(Canvas canvas, Size size) {  final sh = size.height;  final paint = Paint()..style = PaintingStyle.fill;  for (int i = 0; i &lt; datas.length; i++) {    // æ¯ä¸ªçŸ©å½¢ä½¿ç”¨é¢„è®¾çš„ colors æ•°ç»„é‡Œé¢çš„é¢œè‰²    paint.color = colors[i];    final double textFontSize = 14.0;    final double data = datas[i];    // çŸ©å½¢çš„ä¸Šè¾¹ç¼˜ä¸ºç”»å¸ƒé«˜åº¦å‡å»æ•°æ®å€¼    final double top = sh - data;    // çŸ©å½¢çš„å·¦è¾¹ç¼˜ä¸ºå½“å‰ç´¢å¼•å€¼ä¹˜ä»¥çŸ©å½¢å®½åº¦åŠ ä¸ŠçŸ©å½¢ä¹‹é—´çš„é—´è·    final double left = i * _barWidth + (i * _barGap) + _barGap;    // ä½¿ç”¨ Rect.fromLTWH æ–¹æ³•åˆ›å»ºè¦ç»˜åˆ¶çš„çŸ©å½¢    final rect = Rect.fromLTWH(left, top, _barWidth, data);    // ä½¿ç”¨ drawRect æ–¹æ³•ç»˜åˆ¶çŸ©å½¢    canvas.drawRect(rect, paint);    final offset = Offset(      left + _barWidth / 2 - textFontSize * 1.2,      top - textFontSize * 2,    );    // ä½¿ç”¨ TextPainter ç»˜åˆ¶çŸ©å½¢ä¸Šæ”¾çš„æ•°å€¼    TextPainter(      text: TextSpan(        text: data.toStringAsFixed(1),        style: TextStyle(fontSize: textFontSize, color: paint.color),      ),      textAlign: TextAlign.center,      textDirection: TextDirection.ltr,    )      ..layout(        minWidth: 0,        maxWidth: textFontSize * data.toString().length,      )      ..paint(canvas, offset);    final xData = xAxis[i];    final xOffset = Offset(left + _barWidth / 2 - textFontSize, sh + 12);    // ç»˜åˆ¶æ¨ªè½´æ ‡è¯†    TextPainter(      textAlign: TextAlign.center,      text: TextSpan(        text: &#39;$xData&#39;,        style: TextStyle(fontSize: 12, color: Colors.black87),      ),      textDirection: TextDirection.ltr,    )      ..layout(        minWidth: 0,        maxWidth: size.width,      )      ..paint(canvas, xOffset);  }}@overridevoid paint(Canvas canvas, Size size) {  _drawAxis(canvas, size);  _drawLabels(canvas, size);  _darwBars(canvas, size);}</code></pre><p>æ•ˆæœå¦‚ä¸‹</p><img src="./images/flutter-bar-chart/chart-data.png" width="520" style="width:260px" alt="chart-data"><h3 id="æ·»åŠ è¿åŠ¨åŠ¨ç”»"><a href="#æ·»åŠ è¿åŠ¨åŠ¨ç”»" class="headerlink" title="æ·»åŠ è¿åŠ¨åŠ¨ç”»"></a>æ·»åŠ è¿åŠ¨åŠ¨ç”»</h3><p>æœ€ååœ¨ <code>_BarChartState</code> é‡Œä½¿ç”¨ä¸€ä¸ª <code>AnimationController</code> åˆ›å»ºæŸ±çŠ¶å›¾è¿åŠ¨çš„åŠ¨ç”»ï¼Œå…³äºåŠ¨ç”»æ–¹é¢çš„çŸ¥è¯†å¯ä»¥æŸ¥é˜… <a href="https://coldstone.fun/post/2020/04/26/flutter-animation-from-zero/">ä»é›¶å¼€å§‹çš„ Flutter åŠ¨ç”»</a> è¿™ç¯‡æ–‡ç« ã€‚</p><pre><code class="dart">class _BarChartState extends State&lt;BarChart&gt; with TickerProviderStateMixin {  AnimationController _controller;  final _animations = &lt;double&gt;[];  @override  void initState() {    super.initState();    double begin = 0.0;    List&lt;double&gt; datas = widget.data;    // åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨ï¼Œå¹¶è°ƒç”¨ forward æ–¹æ³•å¯åŠ¨åŠ¨ç”»    _controller = AnimationController(      vsync: this,      duration: Duration(milliseconds: 3000),    )..forward();    for (int i = 0; i &lt; datas.length; i++) {      final double end = datas[i];      // ä½¿ç”¨ä¸€ä¸ªè¡¥é—´å€¼ Tween åˆ›å»ºæ¯ä¸ªçŸ©å½¢çš„åŠ¨ç”»å€¼      final Tween&lt;double&gt; tween = Tween(begin: begin, end: end);      // åˆå§‹åŒ–æ•°ç»„é‡Œé¢çš„å€¼      _animations.add(begin);      // åˆ›å»ºè¡¥é—´åŠ¨ç”»      Animation&lt;double&gt; animation = tween.animate(        CurvedAnimation(          parent: _controller,          curve: Curves.ease,        ),      );      _controller.addListener(() {        // ä½¿ç”¨ setState æ›´æ–° _animations æ•°ç»„é‡Œé¢çš„åŠ¨ç”»å€¼        setState(() {          _animations[i] = animation.value;        });      });    }  }  @override  Widget build(BuildContext context) {    return Column(      mainAxisAlignment: MainAxisAlignment.center,      children: [        CustomPaint(          // æœ€åå‘ BarChartPainter ä¼ å…¥ _animations æ•°ç»„ï¼Œå®ç°åŠ¨ç”»          painter: BarChartPainter(            datas: _animations,            xAxis: widget.xAxis,            animation: _controller,          ),          child: Container(width: 300, height: 300),        ),      ],    );  }}</code></pre><p>è‡³æ­¤æ•´ä¸ªæŸ±çŠ¶å›¾çš„ç»˜åˆ¶å°±å®Œæˆäº†ï¼Œä¼ å…¥æ•°æ®å³å¯ä½¿ç”¨ ğŸ‰ğŸ‰ğŸ‰</p><pre><code class="dart">BarChart(  data: [180.0, 98.0, 126.0, 64.0, 118.0],  xAxis: [&#39;ä¸€æœˆ&#39;, &#39;äºŒæœˆ&#39;, &#39;ä¸‰æœˆ&#39;, &#39;å››æœˆ&#39;, &#39;äº”æœˆ&#39;],);</code></pre><p>å®Œæ•´ä»£ç åœ°å€ï¼š<a href="https://github.com/xrr2016/flutter-charts/blob/master/lib/charts/bar_chart.dart" target="_blank" rel="noopener">bar_chart.dart</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡è¯´æ˜äº†ä»€ä¹ˆæ˜¯ <code>CustomPaint</code> å’Œ <code>CustomPainter</code>ã€‚ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ç»˜åˆ¶ä¸€ä¸ªå¸¦æœ‰åŠ¨ç”»çš„æŸ±çŠ¶å›¾è¡¨ã€‚</p><h2 id="é™„è¨€"><a href="#é™„è¨€" class="headerlink" title="é™„è¨€"></a>é™„è¨€</h2><p>å‡†å¤‡å†™ä¸€ç³»åˆ—å…³äºç”¨ Flutter ç”»å›¾è¡¨çš„æ–‡ç« ï¼Œç”¨æ¥åˆ†äº«è¿™æ–¹é¢çš„çŸ¥è¯†ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯è¿™ä¸ªç³»åˆ—çš„å¼€ç¯‡ï¼Œé¢„è®¡ä¸€å…±ä¼šå†™ 6 ç¯‡ã€‚</p><ol><li><a href="https://coldstone.fun/post/2020/05/31/flutter-bar-chart/">ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆä¸€ï¼‰æŸ±çŠ¶å›¾ğŸ“Š</a>ï¼ˆæœ¬æ–‡ï¼‰</li><li>ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆäºŒï¼‰é¥¼çŠ¶å›¾ğŸª</li><li>ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆä¸‰ï¼‰æŠ˜çº¿å›¾ğŸ“ˆ</li><li>ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆå››ï¼‰é›·è¾¾å›¾ğŸ¯</li><li>ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆäº”ï¼‰ç¯çŠ¶å›¾ğŸ©</li><li>ä½¿ç”¨ Flutter ç»˜åˆ¶å›¾è¡¨ï¼ˆå…­ï¼‰æ¡å½¢å›¾ğŸ“</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/flutter-bar-chart/cover.png&quot; alt=&quot;bar&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>é€‰æ‹©é€‚åˆçš„ Flutter åŠ¨ç”»æ§ä»¶</title>
    <link href="https://coldstone.fun/post/2020/05/07/flutter-animation-decision/"/>
    <id>https://coldstone.fun/post/2020/05/07/flutter-animation-decision/</id>
    <published>2020-05-07T02:04:58.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/flutter-animation-decision/level.png" alt="level"></p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Flutter å›¢é˜Ÿæ¨å‡ºäº†ä¸€ä¸ªå…³äº <a href="https://www.youtube.com/watch?v=GXIJJkq_H8g" target="_blank" rel="noopener">å¦‚ä½•åœ¨ Flutter ä¸­é€‰æ‹©åˆé€‚çš„åŠ¨ç”» Widget</a> çš„è§†é¢‘ä»¥åŠé…å¥—çš„æ–‡ç«  <a href="https://medium.com/flutter/how-to-choose-which-flutter-animation-widget-is-right-for-you-79ecfb7e72b5" target="_blank" rel="noopener">How to Choose Which Flutter Animation Widget is Right for You? </a>éƒ½æŒºæœ‰å¥½çš„ï¼Œæ‰€ä»¥å°†æ–‡ä¸­çš„é€‰æ‹©å›¾ç¿»è¯‘å‡ºæ¥ã€‚</p><h2 id="è‹±æ–‡ç‰ˆ"><a href="#è‹±æ–‡ç‰ˆ" class="headerlink" title="è‹±æ–‡ç‰ˆ"></a>è‹±æ–‡ç‰ˆ</h2><p><img src="./images/flutter-animation-decision/animation-decision-tree.png" alt="animation-decision-tree"></p><h2 id="ä¸­æ–‡ç‰ˆ"><a href="#ä¸­æ–‡ç‰ˆ" class="headerlink" title="ä¸­æ–‡ç‰ˆ"></a>ä¸­æ–‡ç‰ˆ</h2><p><img src="./images/flutter-animation-decision/animation-decision-tree-zh.png" alt="animation-decision-tree-zh"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://medium.com/flutter/how-to-choose-which-flutter-animation-widget-is-right-for-you-79ecfb7e72b5" target="_blank" rel="noopener">How to Choose Which Flutter Animation Widget is Right for You?</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/flutter-animation-decision/level.png&quot; alt=&quot;level&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Animation" scheme="https://coldstone.fun/tags/Animation/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹çš„ Flutter åŠ¨ç”»</title>
    <link href="https://coldstone.fun/post/2020/04/26/flutter-animation-from-zero/"/>
    <id>https://coldstone.fun/post/2020/04/26/flutter-animation-from-zero/</id>
    <published>2020-04-26T12:00:00.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/flutter-animation-from-zero/cover.png" alt="cover"></p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åŠ¨ç”»æœ¬è´¨æ˜¯åœ¨ä¸€æ®µæ—¶é—´å†…ä¸æ–­æ”¹å˜å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹ï¼Œä»è€Œäº§ç”Ÿ<a href="https://zh.wikipedia.org/wiki/%E8%A6%96%E8%A6%BA%E6%9A%AB%E7%95%99" target="_blank" rel="noopener">è§†è§‰æš‚ç•™</a>ç°è±¡ã€‚</p><p>åŠ¨ç”»ä¸€èˆ¬å¯åˆ†ä¸ºä¸¤ç±»ï¼š</p><p><strong>è¡¥é—´åŠ¨ç”»</strong>ï¼šè¡¥é—´åŠ¨ç”»æ˜¯ä¸€ç§é¢„å…ˆå®šä¹‰ç‰©ä½“è¿åŠ¨çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œç‰©ä½“çš„è¿åŠ¨æ–¹å¼ï¼Œè¿åŠ¨æ—¶é—´ï¼Œæ—¶é—´æ›²çº¿ï¼Œç„¶åä»èµ·ç‚¹è¿‡æ¸¡åˆ°ç»ˆç‚¹çš„åŠ¨ç”»ã€‚</p><p><strong>åŸºäºç‰©ç†çš„åŠ¨ç”»</strong>ï¼šåŸºäºç‰©ç†çš„åŠ¨ç”»æ˜¯ä¸€ç§æ¨¡æ‹Ÿç°å®ä¸–ç•Œè¿åŠ¨çš„åŠ¨ç”»ï¼Œé€šè¿‡å»ºç«‹è¿åŠ¨æ¨¡å‹æ¥å®ç°ã€‚ä¾‹å¦‚ä¸€ä¸ªç¯®çƒğŸ€ä»é«˜å¤„è½ä¸‹ï¼Œéœ€è¦æ ¹æ®å…¶ä¸‹è½é«˜åº¦ï¼Œé‡åŠ›åŠ é€Ÿåº¦ï¼Œåœ°é¢åå¼¹åŠ›ç­‰å½±å“å› ç´ æ¥å»ºç«‹è¿åŠ¨æ¨¡å‹ã€‚</p><h2 id="Flutter-ä¸­çš„åŠ¨ç”»"><a href="#Flutter-ä¸­çš„åŠ¨ç”»" class="headerlink" title="Flutter ä¸­çš„åŠ¨ç”»"></a>Flutter ä¸­çš„åŠ¨ç”»</h2><p>Flutter ä¸­æœ‰å¤šç§ç±»å‹çš„åŠ¨ç”»ï¼Œå…ˆä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œä½¿ç”¨ä¸€ä¸ª <code>AnimatedContainer</code> æ§ä»¶ï¼Œç„¶åè®¾ç½®åŠ¨ç”»æ—¶é•¿ <code>duration</code>ï¼Œæœ€åè°ƒç”¨ <code>setState</code> æ–¹æ³•æ”¹å˜éœ€è¦å˜åŒ–çš„å±æ€§å€¼ï¼Œä¸€ä¸ªåŠ¨ç”»å°±åˆ›å»ºäº†ã€‚</p><img src="./images/flutter-animation-from-zero/animated-container.gif" alt="animated-container" style="width:240px" width="240"><p>ä»£ç å¦‚ä¸‹</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;class AnimatedContainerPage extends StatefulWidget {  @override  _AnimatedContainerPageState createState() =&gt; _AnimatedContainerPageState();}class _AnimatedContainerPageState extends State&lt;AnimatedContainerPage&gt; {  // åˆå§‹çš„å±æ€§å€¼  double size = 100;  double raidus = 25;  Color color = Colors.yellow;  void _animate() {    // æ”¹å˜å±æ€§å€¼    setState(() {      size = size == 100 ? 200 : 100;      raidus = raidus == 25 ? 100 : 25;      color = color == Colors.yellow ? Colors.greenAccent : Colors.yellow;    });  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(title: Text(&#39;Animated Container&#39;)),      body: Center(        child: Column(          mainAxisAlignment: MainAxisAlignment.center,          children: [            // åœ¨ AnimatedContainer ä¸Šåº”ç”¨å±æ€§å€¼            AnimatedContainer(              width: size,              height: size,              curve: Curves.easeIn,              padding: const EdgeInsets.all(20.0),              decoration: BoxDecoration(                color: color,                borderRadius: BorderRadius.circular(raidus),              ),              duration: Duration(seconds: 1),              child: FlutterLogo(),            )          ],        ),      ),      floatingActionButton: FloatingActionButton(        onPressed: _animate,        child: Icon(Icons.refresh),      ),    );  }}</code></pre><p>è¿™æ˜¯ä¸€ä¸ªéšå¼åŠ¨ç”»ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰æ˜¾å¼åŠ¨ç”»ï¼ŒHreo åŠ¨ç”»ï¼Œäº¤ç»‡åŠ¨ç”»ã€‚</p><h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><p>Flutter åŠ¨ç”»æ˜¯å»ºç«‹åœ¨ä»¥ä¸‹çš„æ¦‚å¿µä¹‹ä¸Šã€‚</p><p><code>Animation</code></p><p>Flutter ä¸­çš„åŠ¨ç”»ç³»ç»ŸåŸºäº <code>Animation</code> å¯¹è±¡ï¼Œ å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¿å­˜äº†å½“å‰åŠ¨ç”»çš„å€¼å’ŒçŠ¶æ€ï¼ˆå¼€å§‹ã€æš‚åœã€å‰è¿›ã€å€’é€€ï¼‰ï¼Œä½†ä¸è®°å½•å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹ã€‚UI å…ƒç´ é€šè¿‡è¯»å– <code>Animation</code> å¯¹è±¡çš„å€¼å’Œç›‘å¬çŠ¶æ€å˜åŒ–è¿è¡Œ <code>build</code> å‡½æ•°ï¼Œç„¶åæ¸²æŸ“åˆ°å±å¹•ä¸Šå½¢æˆåŠ¨ç”»æ•ˆæœã€‚</p><p>ä¸€ä¸ª <code>Animation</code> å¯¹è±¡åœ¨ä¸€æ®µæ—¶é—´å†…ä¼šæŒç»­ç”Ÿæˆä»‹äºä¸¤ä¸ªå€¼ä¹‹é—´çš„å€¼ï¼Œæ¯”è¾ƒå¸¸è§çš„ç±»å‹æ˜¯ <code>Animation&lt;double&gt;</code>ï¼Œé™¤ <code>double</code> ç±»å‹ä¹‹å¤–è¿˜æœ‰ <code>Animation&lt;Color&gt;</code> æˆ–è€… <code>Animation&lt;Size&gt;</code> ç­‰ã€‚</p><pre><code class="dart">abstract class Animation&lt;T&gt; extends Listenable implements ValueListenable&lt;T&gt; {  /// ...}</code></pre><p><code>AnimationController</code></p><p>å¸¦æœ‰æ§åˆ¶æ–¹æ³•çš„ <code>Animation</code> å¯¹è±¡ï¼Œç”¨æ¥æ§åˆ¶åŠ¨ç”»çš„å¯åŠ¨ï¼Œæš‚åœï¼Œç»“æŸï¼Œè®¾å®šåŠ¨ç”»è¿è¡Œæ—¶é—´ç­‰ã€‚</p><pre><code class="dart">class AnimationController extends Animation&lt;double&gt;  with AnimationEagerListenerMixin, AnimationLocalListenersMixin, AnimationLocalStatusListenersMixin {  /// ...}AnimationController controller = AnimationController(  vsync: this,  duration: Duration(seconds: 10),);</code></pre><p><code>Tween</code></p><p>ç”¨æ¥ç”Ÿæˆä¸åŒç±»å‹å’ŒèŒƒå›´çš„åŠ¨ç”»å–å€¼ã€‚</p><pre><code class="dart">class Tween&lt;T extends dynamic&gt; extends Animatable&lt;T&gt; {  Tween({ this.begin, this.end });  /// ...}// double ç±»å‹Tween&lt;double&gt; tween = Tween&lt;double&gt;(begin: -200, end: 200);// color ç±»å‹ColorTween colorTween = ColorTween(begin: Colors.blue, end: Colors.yellow);// border radius ç±»å‹BorderRadiusTween radiusTween = BorderRadiusTween(  begin: BorderRadius.circular(0.0),  end: BorderRadius.circular(150.0),);</code></pre><p><code>Curve</code></p><p>Flutter åŠ¨ç”»çš„é»˜è®¤åŠ¨ç”»è¿‡ç¨‹æ˜¯åŒ€é€Ÿçš„ï¼Œä½¿ç”¨ <code>CurvedAnimation</code> å¯ä»¥å°†æ—¶é—´æ›²çº¿å®šä¹‰ä¸ºéçº¿æ€§æ›²çº¿ã€‚</p><pre><code class="dart">class CurvedAnimation extends Animation&lt;double&gt; with AnimationWithParentMixin&lt;double&gt; {  /// ...}Animation animation = CurvedAnimation(parent: controller, curve: Curves.easeIn);</code></pre><p><code>Ticker</code></p><p><code>Ticker</code> ç”¨æ¥æ·»åŠ æ¯æ¬¡å±å¹•åˆ·æ–°çš„å›è°ƒå‡½æ•° <code>TickerCallback</code>ï¼Œæ¯æ¬¡å±å¹•åˆ·æ–°éƒ½ä¼šè°ƒç”¨ã€‚ç±»ä¼¼äº Web é‡Œé¢çš„ <code>requestAnimationFrame</code> æ–¹æ³•ã€‚</p><pre><code class="dart">class Ticker {  /// ...}Ticker ticker = Ticker(callback);</code></pre><h2 id="éšå¼åŠ¨ç”»"><a href="#éšå¼åŠ¨ç”»" class="headerlink" title="éšå¼åŠ¨ç”»"></a>éšå¼åŠ¨ç”»</h2><p>éšå¼åŠ¨ç”»ä½¿ç”¨ Flutter æ¡†æ¶å†…ç½®çš„åŠ¨ç”»éƒ¨ä»¶åˆ›å»ºï¼Œé€šè¿‡è®¾ç½®åŠ¨ç”»çš„èµ·å§‹å€¼å’Œæœ€ç»ˆå€¼æ¥è§¦å‘ã€‚å½“ä½¿ç”¨ <code>setState</code> æ–¹æ³•æ”¹å˜éƒ¨ä»¶çš„åŠ¨ç”»å±æ€§å€¼æ—¶ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨è®¡ç®—å‡ºä¸€ä¸ªä»æ—§å€¼è¿‡æ¸¡åˆ°æ–°å€¼çš„åŠ¨ç”»ã€‚</p><p>æ¯”å¦‚ <code>AnimatedOpacity</code> éƒ¨ä»¶ï¼Œæ”¹å˜å®ƒçš„ <code>opacity</code> å€¼å°±å¯ä»¥è§¦å‘åŠ¨ç”»ã€‚</p><img src="./images/flutter-animation-from-zero/opacity-toggle.gif" alt="opacity-toggle" style="width:240px" width="240"><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;class OpacityChangePage extends StatefulWidget {  @override  _OpacityChangePageState createState() =&gt; _OpacityChangePageState();}class _OpacityChangePageState extends State&lt;OpacityChangePage&gt; {  double _opacity = 1.0;  // æ”¹å˜ç›®æ ‡å€¼  void _toggle() {    _opacity = _opacity &gt; 0 ? 0.0 : 1.0;    setState(() {});  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(title: Text(&#39;éšå¼åŠ¨ç”»&#39;)),      body: Center(        child: AnimatedOpacity(          // ä¼ å…¥ç›®æ ‡å€¼          opacity: _opacity,          duration: Duration(seconds: 1),          child: Container(            width: 200,            height: 200,            color: Colors.blue,          ),        ),      ),      floatingActionButton: FloatingActionButton(        onPressed: _toggle,        child: Icon(Icons.play_arrow),      ),    );  }}</code></pre><p>é™¤äº† <code>AnimatedOpacity</code> å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„å†…ç½®éšå¼åŠ¨ç”»éƒ¨ä»¶å¦‚ï¼š<code>AnimatedContainer</code>, <code>AnimatedPadding</code>, <code>AnimatedPositioned</code>, <code>AnimatedSwitcher</code>ï¼Œ <code>AnimatedAlign</code> ç­‰ã€‚</p><h2 id="æ˜¾å¼åŠ¨ç”»"><a href="#æ˜¾å¼åŠ¨ç”»" class="headerlink" title="æ˜¾å¼åŠ¨ç”»"></a>æ˜¾å¼åŠ¨ç”»</h2><p>æ˜¾å¼åŠ¨ç”»æŒ‡çš„æ˜¯éœ€è¦æ‰‹åŠ¨è®¾ç½®åŠ¨ç”»çš„æ—¶é—´ï¼Œè¿åŠ¨æ›²çº¿ï¼Œå–å€¼èŒƒå›´çš„åŠ¨ç”»ã€‚å°†å€¼ä¼ é€’ç»™åŠ¨ç”»éƒ¨ä»¶å¦‚: <code>RotationTransition</code>ï¼Œæœ€åä½¿ç”¨ä¸€ä¸ª<code>AnimationController</code> æ§åˆ¶åŠ¨ç”»çš„å¼€å§‹å’Œç»“æŸã€‚</p><img src="./images/flutter-animation-from-zero/explicit-animation.gif" alt="explicit-animation" style="width:240px" width="240"><pre><code class="dart">import &#39;dart:math&#39;;import &#39;package:flutter/material.dart&#39;;class RotationAinmationPage extends StatefulWidget {  @override  _RotationAinmationPageState createState() =&gt; _RotationAinmationPageState();}class _RotationAinmationPageState extends State&lt;RotationAinmationPage&gt;    with SingleTickerProviderStateMixin {  AnimationController _controller;  Animation&lt;double&gt; _turns;  bool _playing = false;  // æ§åˆ¶åŠ¨ç”»è¿è¡ŒçŠ¶æ€  void _toggle() {    if (_playing) {      _playing = false;      _controller.stop();    } else {      _controller.forward()..whenComplete(() =&gt; _controller.reverse());      _playing = true;    }    setState(() {});  }  @override  void initState() {    super.initState();    // åˆå§‹åŒ–åŠ¨ç”»æ§åˆ¶å™¨ï¼Œè®¾ç½®åŠ¨ç”»æ—¶é—´    _controller = AnimationController(      vsync: this,      duration: Duration(seconds: 10),    );    // è®¾ç½®åŠ¨ç”»å–å€¼èŒƒå›´å’Œæ—¶é—´æ›²çº¿    _turns = Tween(begin: 0.0, end: pi * 2).animate(      CurvedAnimation(parent: _controller, curve: Curves.easeIn),    );  }  @override  void dispose() {    super.dispose();    _controller.dispose();  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(title: Text(&#39;æ˜¾ç¤ºåŠ¨ç”»&#39;)),      body: Center(        child: RotationTransition(          // ä¼ å…¥åŠ¨ç”»å€¼          turns: _turns,          child: Container(            width: 200,            height: 200,            child: Image.asset(              &#39;assets/images/fan.png&#39;,              fit: BoxFit.cover,            ),          ),        ),      ),      floatingActionButton: FloatingActionButton(        onPressed: _toggle,        child: Icon(_playing ? Icons.pause : Icons.play_arrow),      ),    );  }}</code></pre><p>é™¤äº† <code>RotationTransition</code> å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„æ˜¾ç¤ºåŠ¨ç”»éƒ¨ä»¶å¦‚ï¼š<code>FadeTransition</code>, <code>ScaleTransition</code>, <code>SizeTransition</code>, <code>SlideTransition</code> ç­‰ã€‚</p><h2 id="Hero-åŠ¨ç”»"><a href="#Hero-åŠ¨ç”»" class="headerlink" title="Hero åŠ¨ç”»"></a>Hero åŠ¨ç”»</h2><p>Hero åŠ¨ç”»æŒ‡çš„æ˜¯åœ¨é¡µé¢åˆ‡æ¢æ—¶ä¸€ä¸ªå…ƒç´ ä»æ—§é¡µé¢è¿åŠ¨åˆ°æ–°é¡µé¢çš„åŠ¨ç”»ã€‚Hero åŠ¨ç”»éœ€è¦ä½¿ç”¨ä¸¤ä¸ª <code>Hero</code> æ§ä»¶å®ç°ï¼šä¸€ä¸ªç”¨æ¥åœ¨æ—§é¡µé¢ä¸­ï¼Œå¦ä¸€ä¸ªåœ¨æ–°é¡µé¢ã€‚ä¸¤ä¸ª <code>Hero</code> æ§ä»¶éœ€è¦ä½¿ç”¨ç›¸åŒçš„ <code>tag</code> å±æ€§ï¼Œå¹¶ä¸”ä¸èƒ½ä¸å…¶ä»–<code>tag</code>é‡å¤ã€‚</p><img src="./images/flutter-animation-from-zero/hero-animation.gif" alt="hero-animation" style="width:240px" width="240"><pre><code class="dart">// é¡µé¢ 1import &#39;package:flutter/material.dart&#39;;import &#39;hero_animation_page2.dart&#39;;String cake1 = &#39;assets/images/cake01.jpg&#39;;String cake2 = &#39;assets/images/cake02.jpg&#39;;class HeroAnimationPage1 extends StatelessWidget {  GestureDetector buildRowItem(context, String image) {    return GestureDetector(      onTap: () {        // è·³è½¬åˆ°é¡µé¢ 2        Navigator.of(context).push(          MaterialPageRoute(builder: (ctx) {            return HeroAnimationPage2(image: image);          }),        );      },      child: Container(        width: 100,        height: 100,        child: Hero(          // è®¾ç½® Hero çš„ tag å±æ€§          tag: image,          child: ClipOval(child: Image.asset(image)),        ),      ),    );  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(title: Text(&#39;é¡µé¢ 1&#39;)),      body: Column(        children: &lt;Widget&gt;[          SizedBox(height: 40.0),          Row(            mainAxisAlignment: MainAxisAlignment.spaceAround,            children: &lt;Widget&gt;[              buildRowItem(context, cake1),              buildRowItem(context, cake2),            ],          ),        ],      ),    );  }}// é¡µé¢ 2import &#39;package:flutter/material.dart&#39;;class HeroAnimationPage2 extends StatelessWidget {  final String image;  const HeroAnimationPage2({@required this.image});  @override  Widget build(BuildContext context) {    return Scaffold(      body: CustomScrollView(        slivers: &lt;Widget&gt;[          SliverAppBar(            expandedHeight: 400.0,            title: Text(&#39;é¡µé¢ 2&#39;),            backgroundColor: Colors.grey[200],            flexibleSpace: FlexibleSpaceBar(              collapseMode: CollapseMode.parallax,              background: Hero(                // ä½¿ç”¨ä»é¡µé¢ 1 ä¼ å…¥çš„ tag å€¼                tag: image,                child: Container(                  decoration: BoxDecoration(                    image: DecorationImage(                      image: AssetImage(image),                      fit: BoxFit.cover,                    ),                  ),                ),              ),            ),          ),          SliverList(            delegate: SliverChildListDelegate(              &lt;Widget&gt;[                Container(height: 600.0, color: Colors.grey[200]),              ],            ),          ),        ],      ),    );  }}</code></pre><h2 id="äº¤ç»‡åŠ¨ç”»"><a href="#äº¤ç»‡åŠ¨ç”»" class="headerlink" title="äº¤ç»‡åŠ¨ç”»"></a>äº¤ç»‡åŠ¨ç”»</h2><p>äº¤ç»‡åŠ¨ç”»æ˜¯ç”±ä¸€ç³»åˆ—çš„å°åŠ¨ç”»ç»„æˆçš„åŠ¨ç”»ã€‚æ¯ä¸ªå°åŠ¨ç”»å¯ä»¥æ˜¯è¿ç»­æˆ–é—´æ–­çš„ï¼Œä¹Ÿå¯ä»¥ç›¸äº’é‡å ã€‚å…¶å…³é”®ç‚¹åœ¨äºä½¿ç”¨ <code>Interval</code> éƒ¨ä»¶ç»™æ¯ä¸ªå°åŠ¨ç”»è®¾ç½®ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œä»¥åŠä¸ºæ¯ä¸ªåŠ¨ç”»çš„è®¾ç½®ä¸€ä¸ªå–å€¼èŒƒå›´ <code>Tween</code>ï¼Œæœ€åä½¿ç”¨ä¸€ä¸ª <code>AnimationController</code> æ§åˆ¶æ€»ä½“çš„åŠ¨ç”»çŠ¶æ€ã€‚</p><p><code>Interval</code> ç»§æ‰¿è‡³ <code>Curve</code> ç±»ï¼Œé€šè¿‡è®¾ç½®å±æ€§ <code>begin</code> å’Œ <code>end</code> æ¥ç¡®å®šè¿™ä¸ªå°åŠ¨ç”»çš„è¿è¡ŒèŒƒå›´ã€‚</p><pre><code class="dart">class Interval extends Curve {  /// ...  /// åŠ¨ç”»èµ·å§‹ç‚¹  final double begin;  /// åŠ¨ç”»ç»“æŸç‚¹  final double end;  /// åŠ¨ç”»ç¼“åŠ¨æ›²çº¿  final Curve curve;  /// ...}</code></pre><img src="./images/flutter-animation-from-zero/staggered-animation.gif" alt="staggered-animation" style="width:240px" width="240"><p>è¿™æ˜¯ä¸€ä¸ªç”± 5 ä¸ªå°åŠ¨ç”»ç»„æˆçš„äº¤ç»‡åŠ¨ç”»ï¼Œå®½åº¦ï¼Œé«˜åº¦ï¼Œé¢œè‰²ï¼Œåœ†è§’ï¼Œè¾¹æ¡†ï¼Œæ¯ä¸ªåŠ¨ç”»éƒ½æœ‰è‡ªå·±çš„åŠ¨ç”»åŒºé—´ã€‚</p><p><img src="./images/flutter-animation-from-zero/staggered-animation-timeline.png" alt="staggered-animation-timeline"></p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;class StaggeredAnimationPage extends StatefulWidget {  @override  _StaggeredAnimationPageState createState() =&gt; _StaggeredAnimationPageState();}class _StaggeredAnimationPageState extends State&lt;StaggeredAnimationPage&gt;    with SingleTickerProviderStateMixin {  AnimationController _controller;  Animation&lt;double&gt; _width;  Animation&lt;double&gt; _height;  Animation&lt;Color&gt; _color;  Animation&lt;double&gt; _border;  Animation&lt;BorderRadius&gt; _borderRadius;  void _play() {    if (_controller.isCompleted) {      _controller.reverse();    } else {      _controller.forward();    }  }  @override  void initState() {    super.initState();    _controller = AnimationController(      vsync: this,      duration: Duration(seconds: 5),    );    _width = Tween&lt;double&gt;(      begin: 100,      end: 300,    ).animate(      CurvedAnimation(        parent: _controller,        curve: Interval(          0.0,          0.2,          curve: Curves.ease,        ),      ),    );    _height = Tween&lt;double&gt;(      begin: 100,      end: 300,    ).animate(      CurvedAnimation(        parent: _controller,        curve: Interval(          0.2,          0.4,          curve: Curves.ease,        ),      ),    );    _color = ColorTween(      begin: Colors.blue,      end: Colors.yellow,    ).animate(      CurvedAnimation(        parent: _controller,        curve: Interval(          0.4,          0.6,          curve: Curves.ease,        ),      ),    );    _borderRadius = BorderRadiusTween(      begin: BorderRadius.circular(0.0),      end: BorderRadius.circular(150.0),    ).animate(      CurvedAnimation(        parent: _controller,        curve: Interval(          0.6,          0.8,          curve: Curves.ease,        ),      ),    );    _border = Tween&lt;double&gt;(      begin: 0,      end: 25,    ).animate(      CurvedAnimation(        parent: _controller,        curve: Interval(0.8, 1.0),      ),    );  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(title: Text(&#39;äº¤ç»‡åŠ¨ç”»&#39;)),      body: Center(        child: AnimatedBuilder(          animation: _controller,          builder: (BuildContext context, Widget child) {            return Container(              width: _width.value,              height: _height.value,              decoration: BoxDecoration(                color: _color.value,                borderRadius: _borderRadius.value,                border: Border.all(                  width: _border.value,                  color: Colors.orange,                ),              ),            );          },        ),      ),      floatingActionButton: FloatingActionButton(        onPressed: _play,        child: Icon(Icons.refresh),      ),    );  }}</code></pre><h2 id="ç‰©ç†åŠ¨ç”»"><a href="#ç‰©ç†åŠ¨ç”»" class="headerlink" title="ç‰©ç†åŠ¨ç”»"></a>ç‰©ç†åŠ¨ç”»</h2><p>ç‰©ç†åŠ¨ç”»æ˜¯ä¸€ç§æ¨¡æ‹Ÿç°å®ä¸–ç•Œç‰©ä½“è¿åŠ¨çš„åŠ¨ç”»ã€‚éœ€è¦å»ºç«‹ç‰©ä½“çš„è¿åŠ¨æ¨¡å‹ï¼Œä»¥ä¸€ä¸ªç‰©ä½“ä¸‹è½ä¸ºä¾‹ï¼Œè¿™ä¸ªè¿åŠ¨å—åˆ°ç‰©ä½“çš„ä¸‹è½é«˜åº¦ï¼Œé‡åŠ›åŠ é€Ÿåº¦ï¼Œåœ°é¢çš„åä½œç”¨åŠ›ç­‰å› ç´ çš„å½±å“ã€‚</p><img src="./images/flutter-animation-from-zero/throw-animation.gif" alt="throw-animation" style="width:240px" width="240"><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;import &#39;package:flutter/scheduler.dart&#39;;class ThrowAnimationPage extends StatefulWidget {  @override  _ThrowAnimationPageState createState() =&gt; _ThrowAnimationPageState();}class _ThrowAnimationPageState extends State&lt;ThrowAnimationPage&gt; {  // çƒå¿ƒé«˜åº¦  double y = 70.0;  // Y è½´é€Ÿåº¦  double vy = -10.0;  // é‡åŠ›  double gravity = 0.1;  // åœ°é¢åå¼¹åŠ›  double bounce = -0.5;  // çƒçš„åŠå¾„  double radius = 50.0;  // åœ°é¢é«˜åº¦  final double height = 700;  // ä¸‹è½æ–¹æ³•  void _fall(_) {    y += vy;    vy += gravity;    // å¦‚æœçƒä½“æ¥è§¦åˆ°åœ°é¢ï¼Œæ ¹æ®åœ°é¢åå¼¹åŠ›æ”¹å˜çƒä½“çš„ Y è½´é€Ÿåº¦    if (y + radius &gt; height) {      y = height - radius;      vy *= bounce;    } else if (y - radius &lt; 0) {      y = 0 + radius;      vy *= bounce;    }    setState(() {});  }  @override  void initState() {    super.initState();    // ä½¿ç”¨ä¸€ä¸ª Ticker åœ¨æ¯æ¬¡æ›´æ–°ç•Œé¢æ—¶è¿è¡Œçƒä½“ä¸‹è½æ–¹æ³•    Ticker(_fall)..start();  }  @override  Widget build(BuildContext context) {    double screenWidth = MediaQuery.of(context).size.width;    return Scaffold(      appBar: AppBar(title: Text(&#39;ç‰©ç†åŠ¨ç”»&#39;)),      body: Column(        children: &lt;Widget&gt;[          Container(            height: height,            child: Stack(              children: &lt;Widget&gt;[                Positioned(                  top: y - radius,                  left: screenWidth / 2 - radius,                  child: Container(                    width: radius * 2,                    height: radius * 2,                    decoration: BoxDecoration(                      color: Colors.blue,                      shape: BoxShape.circle,                    ),                  ),                ),              ],            ),          ),          Expanded(child: Container(color: Colors.blue)),        ],      ),    );  }}</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº† Flutter ä¸­å¤šç§ç±»å‹çš„åŠ¨ç”»ï¼Œåˆ†åˆ«æ˜¯</p><ul><li>éšå¼åŠ¨ç”»</li><li>æ˜¾å¼åŠ¨ç”»</li><li>Hero åŠ¨ç”»</li><li>äº¤ç»‡åŠ¨ç”»</li><li>åŸºäºç‰©ç†çš„åŠ¨ç”»</li></ul><p>ä¸€ä¸ªåŠ¨ç”»çš„ä¸»è¦å› ç´ æœ‰</p><ul><li><code>Animation</code> åŠ¨ç”»å¯¹è±¡</li><li><code>AnimationController</code> åŠ¨ç”»æ§åˆ¶å™¨</li><li><code>Tween</code> åŠ¨ç”»å–å€¼èŒƒå›´</li><li><code>Curve</code> åŠ¨ç”»è¿åŠ¨æ›²çº¿</li></ul><p>Flutter åŠ¨ç”»åŸºäºç±»å‹åŒ–çš„ <code>Animation</code> å¯¹è±¡ï¼Œ<code>Widgets</code> é€šè¿‡è¯»å–åŠ¨ç”»å¯¹è±¡çš„å½“å‰å€¼å’Œç›‘å¬çŠ¶æ€å˜åŒ–é‡æ–°è¿è¡Œ <code>build</code> å‡½æ•°ï¼Œä¸æ–­å˜åŒ– UI å½¢æˆåŠ¨ç”»æ•ˆæœã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://medium.com/flutter/flutter-animation-basics-with-implicit-animations-95db481c5916" target="_blank" rel="noopener">Flutter animation basics with implicit animations</a></p><p><a href="https://medium.com/flutter/directional-animations-with-built-in-explicit-animations-3e7c5e6fbbd7" target="_blank" rel="noopener">Directional animations with built-in explicit animations</a></p><p><a href="https://flutter.cn/docs/development/ui/animations" target="_blank" rel="noopener">åŠ¨ç”»æ•ˆæœä»‹ç»</a></p><p><a href="https://book.flutterchina.club/chapter9/intro.html" target="_blank" rel="noopener">FlutteråŠ¨ç”»ç®€ä»‹</a></p><p><a href="https://flutter.cn/docs/development/ui/animations/tutorial" target="_blank" rel="noopener">åœ¨ Flutter åº”ç”¨é‡Œå®ç°åŠ¨ç”»æ•ˆæœ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/flutter-animation-from-zero/cover.png&quot; alt=&quot;cover&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Animation" scheme="https://coldstone.fun/tags/Animation/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Flutter é‡Œä½¿ç”¨ Stream</title>
    <link href="https://coldstone.fun/post/2020/04/13/flutter-stream/"/>
    <id>https://coldstone.fun/post/2020/04/13/flutter-stream/</id>
    <published>2020-04-13T04:07:56.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/flutter-stream/stream.png" alt="stream"></p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ Flutter ä¸­æœ‰ä¸¤ç§å¤„ç†å¼‚æ­¥æ“ä½œçš„æ–¹å¼ <code>Future</code> å’Œ <code>Stream</code>ï¼Œ<code>Future</code> ç”¨äºå¤„ç†å•ä¸ªå¼‚æ­¥æ“ä½œï¼Œ<code>Stream</code> ç”¨æ¥å¤„ç†è¿ç»­çš„å¼‚æ­¥æ“ä½œã€‚æ¯”å¦‚å¾€æ°´æ¯å€’æ°´ï¼Œå°†ä¸€ä¸ªæ°´æ¯å€’æ»¡ä¸ºä¸€ä¸ª <code>Future</code>ï¼Œè¿ç»­çš„å°†å¤šä¸ªæ°´æ¯å€’æ»¡å°±æ˜¯ <code>Stream</code>ã€‚</p><p><img src="./images/flutter-stream/water-fill.png" alt="water-fill"></p><h2 id="Stream-è¯¦è§£"><a href="#Stream-è¯¦è§£" class="headerlink" title="Stream è¯¦è§£"></a>Stream è¯¦è§£</h2><p><code>Stream</code> æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”¨äºè¡¨ç¤ºä¸€åºåˆ—å¼‚æ­¥æ•°æ®çš„æºã€‚å®ƒæ˜¯ä¸€ç§äº§ç”Ÿè¿ç»­äº‹ä»¶çš„æ–¹å¼ï¼Œå¯ä»¥ç”Ÿæˆæ•°æ®äº‹ä»¶æˆ–è€…é”™è¯¯äº‹ä»¶ï¼Œä»¥åŠæµç»“æŸæ—¶çš„å®Œæˆäº‹ä»¶ã€‚</p><pre><code class="dart">abstract class Stream&lt;T&gt; {  Stream();}</code></pre><p><code>Stream</code> åˆ†å•è®¢é˜…æµå’Œå¹¿æ’­æµã€‚</p><p>å•è®¢é˜…æµåœ¨å‘é€å®Œæˆäº‹ä»¶ä¹‹å‰åªå…è®¸è®¾ç½®ä¸€ä¸ªç›‘å¬å™¨ï¼Œå¹¶ä¸”åªæœ‰åœ¨æµä¸Šè®¾ç½®ç›‘å¬å™¨åæ‰å¼€å§‹äº§ç”Ÿäº‹ä»¶ï¼Œå–æ¶ˆç›‘å¬å™¨åå°†åœæ­¢å‘é€äº‹ä»¶ã€‚å³ä½¿å–æ¶ˆäº†ç¬¬ä¸€ä¸ªç›‘å¬å™¨ï¼Œä¹Ÿä¸å…è®¸åœ¨å•è®¢é˜…æµä¸Šè®¾ç½®å…¶ä»–çš„ç›‘å¬å™¨ã€‚å¹¿æ’­æµåˆ™å…è®¸è®¾ç½®å¤šä¸ªç›‘å¬å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨å–æ¶ˆä¸Šä¸€ä¸ªç›‘å¬å™¨åå†æ¬¡æ·»åŠ æ–°çš„ç›‘å¬å™¨ã€‚</p><p><code>Stream</code> æœ‰åŒæ­¥æµå’Œå¼‚æ­¥æµä¹‹åˆ†ã€‚</p><p>å®ƒä»¬çš„åŒºåˆ«åœ¨äºåŒæ­¥æµä¼šåœ¨æ‰§è¡Œ <code>add</code>ï¼Œ<code>addError</code> æˆ– <code>close</code> æ–¹æ³•æ—¶ç«‹å³å‘æµçš„ç›‘å¬å™¨ <code>StreamSubscription</code> å‘é€äº‹ä»¶ï¼Œè€Œå¼‚æ­¥æµæ€»æ˜¯åœ¨äº‹ä»¶é˜Ÿåˆ—ä¸­çš„ä»£ç æ‰§è¡Œå®Œæˆååœ¨å‘é€äº‹ä»¶ã€‚</p><h2 id="Stream-å®¶æ—"><a href="#Stream-å®¶æ—" class="headerlink" title="Stream å®¶æ—"></a><code>Stream</code> å®¶æ—</h2><p><code>StreamController</code></p><p>å¸¦æœ‰æ§åˆ¶æµæ–¹æ³•çš„æµã€‚ å¯ä»¥å‘å®ƒçš„æµå‘é€æ•°æ®ï¼Œé”™è¯¯å’Œå®Œæˆäº‹ä»¶ï¼Œä¹Ÿå¯ä»¥æ£€æŸ¥æ•°æ®æµæ˜¯å¦å·²æš‚åœï¼Œæ˜¯å¦æœ‰ç›‘å¬å™¨ã€‚<code>sync</code> å‚æ•°å†³å®šè¿™ä¸ªæµæ˜¯åŒæ­¥æµè¿˜æ˜¯å¼‚æ­¥æµã€‚</p><pre><code class="dart">abstract class StreamController&lt;T&gt; implements StreamSink&lt;T&gt; {  Stream&lt;T&gt; get stream;  /// ...}StreamController _streamController = StreamController(  onCancel: () {},  onListen: () {},  onPause: () {},  onResume: () {},  sync: false,);</code></pre><p><code>StreamSink</code></p><p>æµäº‹ä»¶çš„å…¥å£ã€‚æä¾› <code>add</code>ï¼Œ<code>addError</code>ï¼Œ<code>addStream</code> æ–¹æ³•å‘æµå‘é€äº‹ä»¶ã€‚</p><pre><code class="dart">abstract class StreamSink&lt;S&gt; implements EventSink&lt;S&gt;, StreamConsumer&lt;S&gt; {  Future close();  /// ...  Future get done;}</code></pre><p><code>StreamSubscription</code></p><p>æµçš„ç›‘å¬å™¨ã€‚æä¾› <code>cacenl</code>ã€<code>pause</code>, <code>resume</code> ç­‰æ–¹æ³•ç®¡ç†ã€‚</p><pre><code class="dart">abstract class StreamSubscription&lt;T&gt; {  /// ...}StreamSubscription subscription = StreamController().stream.listen(print);subscription.onDone(() =&gt; print(&#39;done&#39;));</code></pre><p><code>StreamBuilder</code></p><p>ä½¿ç”¨æµæ•°æ®æ¸²æŸ“ UI ç•Œé¢çš„éƒ¨ä»¶ã€‚</p><pre><code class="dart">StreamBuilder(  // æ•°æ®æµ  stream: stream,  // åˆå§‹æ•°æ®  initialData: &#39;loading...&#39;,  builder: (context, AsyncSnapshot snapshot) {    // AsyncSnapshot å¯¹è±¡ä¸ºæ•°æ®å¿«ç…§ï¼Œç¼“å­˜äº†å½“å‰æ•°æ®å’ŒçŠ¶æ€    // snapshot.connectionState    // snapshot.data    if (snapshot.hasData) {      Map data = snapshot.data;      return Text(data),    }    return CircularProgressIndicator();  },)</code></pre><h2 id="åˆ›å»º-Stream"><a href="#åˆ›å»º-Stream" class="headerlink" title="åˆ›å»º Stream"></a>åˆ›å»º Stream</h2><p>åœ¨ Dart æœ‰å‡ ç§æ–¹å¼åˆ›å»º <code>Stream</code></p><ol><li>ä»ç°æœ‰çš„ç”Ÿæˆä¸€ä¸ªæ–°çš„æµ <code>Stream</code>ï¼Œä½¿ç”¨ <code>map</code>ï¼Œ<code>where</code>ï¼Œ<code>takeWhile</code> ç­‰æ–¹æ³•ã€‚</li></ol><pre><code class="dart">// æ•´æ•°æµStream&lt;int&gt; intStream = StreamController&lt;int&gt;().stream;// å¶æ•°æµStream&lt;int&gt; evenStream = intStream.where((int n) =&gt; n.isEven);// ä¸¤å€æµStream&lt;int&gt; doubleStream = intStream.map((int n) =&gt; n * 2);// æ•°å­—å¤§äº 10 çš„æµStream&lt;int&gt; biggerStream = intStream.takeWhile((int n) =&gt; n &gt; 10);</code></pre><ol start="2"><li>ä½¿ç”¨ <code>async*</code> å‡½æ•°ã€‚</li></ol><pre><code class="dart">Stream&lt;int&gt; countStream(int to) async* {  for (int i = 1; i &lt;= to; i++) {    yield i;  }}Stream stream = countStream(10);stream.listen(print);</code></pre><ol start="3"><li>ä½¿ç”¨ <code>StreamController</code>ã€‚</li></ol><pre><code class="dart">StreamController&lt;Map&gt; _streamController = StreamController(  onCancel: () {},  onListen: () {},  onPause: () {},  onResume: () {},  sync: false,);Stream _stream = _streamController.stream;</code></pre><ol start="4"><li>ä½¿ç”¨ <code>Future</code> å¯¹è±¡ç”Ÿæˆ</li></ol><pre><code class="dart">Future&lt;int&gt; _delay(int seconds) async {  await Future.delayed(Duration(seconds: seconds));  return seconds;}List&lt;Future&gt; futures = [];for (int i = 0; i &lt; 10; i++) {  futures.add(_delay(3));}Stream _futuresStream = Stream.fromFutures(futures);</code></pre><h2 id="åº”ç”¨-Stream"><a href="#åº”ç”¨-Stream" class="headerlink" title="åº”ç”¨ Stream"></a>åº”ç”¨ Stream</h2><p><em>Stream Counter</em></p><p>æŠŠ Flutter çš„é»˜è®¤é¡¹ç›®æ”¹ç”¨ <code>Stream</code> å®ç°</p><img src="./images/flutter-stream/stream-counter.gif" width="320" style="width:320px"><pre><code class="dart">import &#39;dart:async&#39;;import &#39;package:flutter/material.dart&#39;;class StreamCounter extends StatefulWidget {  @override  _StreamCounterState createState() =&gt; _StreamCounterState();}class _StreamCounterState extends State&lt;StreamCounter&gt; {  // åˆ›å»ºä¸€ä¸ª StreamController  StreamController&lt;int&gt; _counterStreamController = StreamController&lt;int&gt;(    onCancel: () {      print(&#39;cancel&#39;);    },    onListen: () {      print(&#39;listen&#39;);    },  );  int _counter = 0;  Stream _counterStream;  StreamSink _counterSink;  // ä½¿ç”¨ StreamSink å‘ Stream å‘é€äº‹ä»¶ï¼Œå½“ _counter å¤§äº 9 æ—¶è°ƒç”¨ close æ–¹æ³•å…³é—­æµã€‚  void _incrementCounter() {    if (_counter &gt; 9) {      _counterSink.close();      return;    }    _counter++;    _counterSink.add(_counter);  }  // ä¸»åŠ¨å…³é—­æµ  void _closeStream() {    _counterStreamController.close();  }  @override  void initState() {    super.initState();    _counterSink = _counterStreamController.sink;    _counterStream = _counterStreamController.stream;  }  @override  void dispose() {    super.dispose();    _counterSink.close();    _counterStreamController.close();  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        title: Text(&#39;Stream Counter&#39;),      ),      body: Center(        child: Column(          mainAxisAlignment: MainAxisAlignment.center,          children: &lt;Widget&gt;[            Text(&#39;You have pushed the button this many times:&#39;),            // ä½¿ç”¨ StreamBuilder æ˜¾ç¤ºå’Œæ›´æ–° UI            StreamBuilder&lt;int&gt;(              stream: _counterStream,              initialData: _counter,              builder: (context, snapshot) {                if (snapshot.connectionState == ConnectionState.done) {                  return Text(                    &#39;Done&#39;,                    style: Theme.of(context).textTheme.bodyText2,                  );                }                int number = snapshot.data;                return Text(                  &#39;$number&#39;,                  style: Theme.of(context).textTheme.bodyText2,                );              },            ),          ],        ),      ),      floatingActionButton: Row(        mainAxisAlignment: MainAxisAlignment.center,        children: &lt;Widget&gt;[          FloatingActionButton(            onPressed: _incrementCounter,            tooltip: &#39;Increment&#39;,            child: Icon(Icons.add),          ),          SizedBox(width: 24.0),          FloatingActionButton(            onPressed: _closeStream,            tooltip: &#39;Close&#39;,            child: Icon(Icons.close),          ),        ],      ),    );  }}</code></pre><p><em>NetWork Status</em></p><p>ç›‘å¬æ‰‹æœºçš„ç½‘ç»œé“¾æ¥çŠ¶æ€ï¼Œé¦–å…ˆæ·»åŠ  <code>connectivity</code> æ’ä»¶</p><pre><code class="yml">dependencies:  connectivity: ^0.4.8+2</code></pre><img src="./images/flutter-stream/network-status.gif" width="320" style="width:320px"><pre><code class="dart">import &#39;dart:async&#39;;import &#39;package:connectivity/connectivity.dart&#39;;import &#39;package:flutter/material.dart&#39;;class NetWorkStatus extends StatefulWidget {  @override  _NetWorkStatusState createState() =&gt; _NetWorkStatusState();}class _NetWorkStatusState extends State&lt;NetWorkStatus&gt; {  StreamController&lt;ConnectivityResult&gt; _streamController = StreamController();  StreamSink _streamSink;  Stream _stream;  String _result;  void _checkStatus() async {    final ConnectivityResult result = await Connectivity().checkConnectivity();    if (result == ConnectivityResult.mobile) {      _result = &#39;mobile&#39;;    } else if (result == ConnectivityResult.wifi) {      _result = &#39;wifi&#39;;    } else if (result == ConnectivityResult.none) {      _result = &#39;none&#39;;    }    setState(() {});  }  @override  void initState() {    super.initState();    _stream = _streamController.stream;    _streamSink = _streamController.sink;    _checkStatus();    Connectivity().onConnectivityChanged.listen(      (ConnectivityResult result) {        _streamSink.add(result);      },    );  }  @override  dispose() {    super.dispose();    _streamSink.close();    _streamController.close();  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        title: Text(&#39;Network Status&#39;),      ),      body: Center(        child: StreamBuilder&lt;ConnectivityResult&gt;(          stream: _stream,          builder: (context, AsyncSnapshot snapshot) {            if (snapshot.hasData) {              if (snapshot.data == ConnectivityResult.mobile) {                _result = &#39;mobile&#39;;              } else if (snapshot.data == ConnectivityResult.wifi) {                _result = &#39;wifi&#39;;              } else if (snapshot.data == ConnectivityResult.none) {                return Text(&#39;è¿˜æ²¡æœ‰é“¾æ¥ç½‘ç»œ&#39;);              }            }            if (_result == null) {              return CircularProgressIndicator();            }            return ResultText(_result);          },        ),      ),    );  }}class ResultText extends StatelessWidget {  final String result;  const ResultText(this.result);  @override  Widget build(BuildContext context) {    return RichText(      text: TextSpan(        style: TextStyle(color: Colors.black),        text: &#39;æ­£åœ¨ä½¿ç”¨&#39;,        children: [          TextSpan(            text: &#39; $result &#39;,            style: TextStyle(              color: Colors.red,              fontSize: 20.0,              fontWeight: FontWeight.bold,            ),          ),          TextSpan(text: &#39;é“¾æ¥ç½‘ç»œ&#39;),        ],      ),    );  }}</code></pre><p><code>Random Article</code></p><p>è¯·æ±‚ç½‘ç»œæ•°æ®åˆ›å»ºæµ</p><pre><code class="yml">dependencies:  dio: ^3.0.9  flutter_html: ^0.11.1</code></pre><img src="./images/flutter-stream/random-article.gif" width="320" style="width:320px"><pre><code class="dart">import &#39;dart:async&#39;;import &#39;package:dio/dio.dart&#39;;import &#39;package:flutter/material.dart&#39;;import &#39;package:flutter_html/flutter_html.dart&#39;;class RandomArticle extends StatefulWidget {  @override  _RandomArticleState createState() =&gt; _RandomArticleState();}class _RandomArticleState extends State&lt;RandomArticle&gt; {  static Dio _dio = Dio(    BaseOptions(baseUrl: &#39;https://interface.meiriyiwen.com&#39;),  );  static Future&lt;Map&gt; _getArticle() async {    Response response = await _dio.get(      &#39;/article/random&#39;,      queryParameters: {&quot;dev&quot;: 1},    );    final data = response.data[&#39;data&#39;];    return data;  }  Stream&lt;Map&gt; _futuresStream;  @override  void initState() {    List&lt;Future&lt;Map&gt;&gt; futures = [];    for (int i = 0; i &lt; 10; i++) {      // æ·»åŠ  Future      futures.add(_getArticle());    }    // ç”Ÿæˆ Stream    _futuresStream = Stream&lt;Map&gt;.fromFutures(futures);    super.initState();  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(title: Text(&#39;Random Article&#39;)),      body: SingleChildScrollView(        child: Center(          child: StreamBuilder&lt;Map&gt;(            stream: _futuresStream,            builder: (context, AsyncSnapshot snapshot) {              if (snapshot.hasData) {                Map article = snapshot.data;                return Container(                  child: Column(                    children: &lt;Widget&gt;[                      SizedBox(height: 24.0),                      Text(                        article[&#39;title&#39;],                        style: TextStyle(fontSize: 24.0),                      ),                      Padding(                        padding: const EdgeInsets.only(                          top: 12.0,                          left: 12.0,                          right: 12.0,                          bottom: 60.0,                        ),                        child: Html(                          data: article[&#39;content&#39;],                        ),                      ),                    ],                  ),                );              }              return CircularProgressIndicator();            },          ),        ),      ),    );  }}</code></pre><p><code>Broadcast Stream</code></p><p>ä½¿ç”¨å¹¿æ’­æµ</p><img src="./images/flutter-stream/broadcast-stream.gif" width="320" style="width:320px"><pre><code class="dart">import &#39;dart:async&#39;;import &#39;package:flutter/material.dart&#39;;class BroadcastStream extends StatefulWidget {  @override  _BroadcastStreamState createState() =&gt; _BroadcastStreamState();}class _BroadcastStreamState extends State&lt;BroadcastStream&gt; {  StreamController&lt;int&gt; _streamController = StreamController&lt;int&gt;.broadcast();  StreamSubscription _subscription1;  StreamSubscription _subscription2;  StreamSubscription _subscription3;  int _count = 0;  int _s1 = 0;  int _s2 = 0;  int _s3 = 0;  @override  void initState() {    _subscription1 = _streamController.stream.listen((n) {      setState(() {        _s1 += 1;      });    });    _subscription2 = _streamController.stream.listen((n) {      setState(() {        _s2 += 2;      });    });    _subscription3 = _streamController.stream.listen((n) {      setState(() {        _s3 -= 1;      });    });    super.initState();  }  void _add() {    if (_count &gt; 10) {      // å¤§äº 10 æ—¶åœæ­¢ç¬¬ä¸€ä¸ªè®¢é˜…      _subscription1.cancel();    }    _count++;    _streamController.add(_count);  }  @override  void dispose() {    super.dispose();    _streamController.close();    _subscription1.cancel();    _subscription2.cancel();    _subscription3.cancel();  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        title: Text(&#39;Broadcast Stream&#39;),      ),      body: Container(        width: double.infinity,        height: MediaQuery.of(context).size.height,        child: Column(          mainAxisAlignment: MainAxisAlignment.center,          crossAxisAlignment: CrossAxisAlignment.center,          children: [            Text(&#39;Count: $_count&#39;),            SizedBox(height: 12.0),            Text(&#39;S1: $_s1&#39;),            SizedBox(height: 12.0),            Text(&#39;S2: $_s2&#39;),            SizedBox(height: 12.0),            Text(&#39;S3: $_s3&#39;),            SizedBox(height: 12.0),            FloatingActionButton(              onPressed: _add,              child: Icon(Icons.plus_one),            ),          ],        ),      ),    );  }}</code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>Stream</code> æ˜¯å¤„ç†å¼‚æ­¥ç¼–ç¨‹çš„æ–¹å¼ä¹‹ä¸€ï¼Œå®ƒæä¾›ä¸€ä¸ªäº†å¼‚æ­¥çš„äº‹ä»¶åºåˆ—ï¼Œå¹¶åœ¨ä½ å‡†å¤‡å¥½æ¥å—æ—¶å‘é€ã€‚åœ¨ Dart ä¸­æµåˆ†ä¸ºåŒæ­¥æµå’Œå¼‚æ­¥æµï¼Œä»¥åŠå•è®¢é˜…æµå’Œå¹¿æ’­æµï¼Œæœ‰å¤šç§æ–¹å¼åˆ›å»º <code>Stream</code>ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://dart.cn/tutorials/language/streams" target="_blank" rel="noopener">å¼‚æ­¥ç¼–ç¨‹ï¼šä½¿ç”¨ stream</a></p><p><a href="https://dart.cn/articles/libraries/creating-streams" target="_blank" rel="noopener">åœ¨ Dart é‡Œä½¿ç”¨ Stream</a></p><p><a href="https://guoshuyu.cn/home/wx/Flutter-11.html" target="_blank" rel="noopener">å…¨é¢æ·±å…¥ç†è§£Stream</a></p><p><a href="https://codingwithjoe.com/flutter-building-a-widget-with-streambuilder/" target="_blank" rel="noopener">Building a Widget with StreamBuilder</a></p><p><a href="https://youtu.be/MkKEWHfy99Y" target="_blank" rel="noopener">StreamBuilder (Flutter æœ¬å‘¨å°éƒ¨ä»¶)</a></p><p><a href="https://youtu.be/nQBpOIHE4eE" target="_blank" rel="noopener">Dart Streams - èšç„¦ Flutter</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/flutter-stream/stream.png&quot; alt=&quot;stream&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼Ÿ</title>
    <link href="https://coldstone.fun/post/2020/04/03/how-flutter-render/"/>
    <id>https://coldstone.fun/post/2020/04/03/how-flutter-render/</id>
    <published>2020-04-03T04:40:04.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/how-flutter-render/cover.jpg" alt="cover"></p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä½¿ç”¨ Flutter å¼€å‘ç§»åŠ¨ç«¯æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæ€»ç»“ä¸€ä¸‹å…³äº UI æ¸²æŸ“æ–¹é¢çš„çŸ¥è¯†ã€‚äº†è§£å…³äº Flutter æ¸²æŸ“æ–¹é¢çš„çŸ¥è¯†è¿˜æ˜¯æœ‰å¿…è¦çš„ï¼Œå¯ä»¥å¸®åŠ©ä½ å¼€å‘æ›´ç¨³å®šï¼Œæ€§èƒ½æ›´é«˜çš„åº”ç”¨ã€‚</p><p>è¦è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆéœ€è¦è®¤è¯†åˆ° Flutter ä¸­æœ‰ä¸‰æ£µæ ‘ï¼š<code>Widget</code> æ ‘ï¼Œ<code>Element</code> æ ‘å’Œ <code>RenderObject</code> æ ‘ã€‚</p><p>å½“åº”ç”¨å¯åŠ¨æ—¶ Flutter ä¼šéå†å¹¶åˆ›å»ºæ‰€æœ‰çš„ <code>Widget</code> å½¢æˆ <code>Widget Tree</code>ï¼ŒåŒæ—¶ä¸ <code>Widget Tree</code> ç›¸å¯¹åº”ï¼Œé€šè¿‡è°ƒç”¨ <code>Widget</code> ä¸Šçš„ <code>createElement()</code> æ–¹æ³•åˆ›å»ºæ¯ä¸ª <code>Element</code> å¯¹è±¡ï¼Œå½¢æˆ <code>Element Tree</code>ã€‚</p><p>æœ€åè°ƒç”¨ <code>Element</code> çš„ <code>createRenderObject()</code> æ–¹æ³•åˆ›å»ºæ¯ä¸ªæ¸²æŸ“å¯¹è±¡ï¼Œå½¢æˆä¸€ä¸ª <code>Render Tree</code>ã€‚</p><p>ç„¶åéœ€è¦çŸ¥é“ <code>Widget</code>ï¼Œ<code>Element</code> å’Œ <code>RenderObject</code> åˆ°åº•æ˜¯å•¥ä»¥åŠå®ƒä»¬æ˜¯å¹²ä»€ä¹ˆçš„ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Widget"><a href="#ä»€ä¹ˆæ˜¯-Widget" class="headerlink" title="ä»€ä¹ˆæ˜¯ Widget"></a>ä»€ä¹ˆæ˜¯ Widget</h2><p><code>Widget</code> æ˜¯ Flutter çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæ˜¯ç”¨æˆ·ç•Œé¢çš„ä¸å¯å˜æè¿°ä¿¡æ¯ã€‚æ­£å¦‚ Flutter çš„å£å· <code>Everythingâ€™s a widget</code>, ç”¨ Flutter å¼€å‘åº”ç”¨å°±æ˜¯åœ¨å†™ <code>Widget</code> ğŸ¶ã€‚</p><p>Flutter çš„ <code>Widget</code> ä¸åªè¡¨ç¤º UI æ§ä»¶ï¼Œè¿˜è¡¨ç¤ºä¸€äº›åŠŸèƒ½æ€§çš„ç»„ä»¶ï¼Œå¦‚è·¯ç”±è·³è½¬ <code>Navigator</code>ï¼Œæ‰‹åŠ¿æ£€æµ‹ <code>GestureDetector</code> ç»„ä»¶ç­‰ã€‚</p><pre><code class="dart">@immutableabstract class Widget extends DiagnosticableTree {  /// Initializes [key] for subclasses.  const Widget({ this.key });  final Key key;  /// ...  @protected  Element createElement();  /// ...  static bool canUpdate(Widget oldWidget, Widget newWidget) {    return oldWidget.runtimeType == newWidget.runtimeType      &amp;&amp; oldWidget.key == newWidget.key;  }}</code></pre><p><code>Widget</code> çš„ <code>canUpdate</code> æ–¹æ³•é€šè¿‡æ¯”è¾ƒæ–°éƒ¨ä»¶å’Œæ—§éƒ¨ä»¶çš„ <code>runtimeType</code> å’Œ <code>key</code> å±æ€§æ˜¯å¦ç›¸åŒæ¥å†³å®šæ›´æ–°éƒ¨ä»¶å¯¹åº”çš„ <code>Element</code>ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Element"><a href="#ä»€ä¹ˆæ˜¯-Element" class="headerlink" title="ä»€ä¹ˆæ˜¯ Element"></a>ä»€ä¹ˆæ˜¯ Element</h2><p><code>Element</code> æ˜¯å®ä¾‹åŒ–çš„ <code>Widget</code> å¯¹è±¡ï¼Œé€šè¿‡ <code>Widget</code> çš„ <code>createElement()</code> æ–¹æ³•ï¼Œåœ¨ç‰¹å®šä½ç½®ä½¿ç”¨ <code>Widget</code> é…ç½®æ•°æ®ç”Ÿæˆã€‚</p><p><code>Element</code> ç”¨äºç®¡ç†åº”ç”¨ UI çš„æ›´æ–°å’Œæ›´æ”¹ï¼Œç®¡ç†éƒ¨ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯ä¸ª <code>Element</code> éƒ½åŒ…å«å¯¹ <code>Widget</code> å’Œ <code>RenderObject</code> çš„å¼•ç”¨ã€‚</p><p><img src="./images/how-flutter-render/relationship.png" alt="relationship"></p><p>å½“ <code>Widget</code> å˜åŒ–æ—¶ï¼Œå¦‚æœä¸¤ä¸ª <code>Widget</code> çš„ <code>runtimeType</code> å’Œ <code>key</code> å±æ€§ç›¸åŒçš„ï¼Œé‚£ä¹ˆæ–°çš„ <code>Element</code> ä¼šé€šè¿‡ <code>Element.update()</code> æ›´æ–°æ—§çš„ <code>Element</code>ï¼Œå¦åˆ™æ—§çš„ <code>Element</code> ä¼šè¢«åˆ é™¤ï¼Œæ–°ç”Ÿæˆçš„ <code>Element</code> æ’å…¥åˆ°æ ‘ä¸­ã€‚</p><pre><code class="dart">abstract class Element extends DiagnosticableTree implements BuildContext {  /// Creates an element that uses the given widget as its configuration.  ///  /// Typically called by an override of [Widget.createElement].  Element(Widget widget)    : assert(widget != null),      _widget = widget;  /// Change the widget used to configure this element.  ///  /// The framework calls this function when the parent wishes to use a  /// different widget to configure this element. The new widget is guaranteed  /// to have the same [runtimeType] as the old widget.  ///  /// This function is called only during the &quot;active&quot; lifecycle state.  @mustCallSuper  void update(covariant Widget newWidget) {    /// ...  }  /// Creates an instance of the [RenderObject] class that this  /// [RenderObjectWidget] represents, using the configuration described by this  /// [RenderObjectWidget].  ///  /// This method should not do anything with the children of the render object.  /// That should instead be handled by the method that overrides  /// [RenderObjectElement.mount] in the object rendered by this object&#39;s  /// [createElement] method. See, for example,  /// [SingleChildRenderObjectElement.mount].  @protected  RenderObject createRenderObject(BuildContext context);}</code></pre><h2 id="ä»€ä¹ˆæ˜¯-RenderObject"><a href="#ä»€ä¹ˆæ˜¯-RenderObject" class="headerlink" title="ä»€ä¹ˆæ˜¯ RenderObject"></a>ä»€ä¹ˆæ˜¯ RenderObject</h2><p><code>RenderObject</code> ç”¨äºåº”ç”¨ç•Œé¢çš„å¸ƒå±€å’Œç»˜åˆ¶ï¼Œä¿å­˜äº†å…ƒç´ çš„å¤§å°ï¼Œå¸ƒå±€ç­‰ä¿¡æ¯ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª <code>RenderObject</code> æ˜¯éå¸¸è€—èƒ½çš„ã€‚</p><p>å½“åº”ç”¨è¿è¡Œæ—¶ Flutter ä½¿ç”¨ <code>RenderObject</code> çš„æ•°æ®ç»˜åˆ¶åº”ç”¨ç•Œé¢ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ª <code>Render Tree</code>ã€‚</p><pre><code class="dart">abstract class RenderObject extends AbstractNode with DiagnosticableTreeMixin implements HitTestTarget {  /// Initializes internal fields for subclasses.  RenderObject() {    _needsCompositing = isRepaintBoundary || alwaysNeedsCompositing;  }  /// The render object at (or below) this location in the tree.  ///  /// If this object is a [RenderObjectElement], the render object is the one at  /// this location in the tree. Otherwise, this getter will walk down the tree  /// until it finds a [RenderObjectElement].  RenderObject get renderObject {    RenderObject result;    void visit(Element element) {      assert(result == null); // this verifies that there&#39;s only one child      if (element is RenderObjectElement)        result = element.renderObject;      else        element.visitChildren(visit);    }    visit(this);    return result;  }  void layout(Constraints constraints, { bool parentUsesSize = false }) {    /// ...  }  /// ...  void paint(PaintingContext context, Offset offset) {    /// ...  }}</code></pre><h2 id="ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ£µæ ‘"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ£µæ ‘" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ£µæ ‘"></a>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ£µæ ‘</h2><p>ä½¿ç”¨ä¸‰æ£µæ ‘çš„ç›®çš„æ˜¯å°½å¯èƒ½å¤ç”¨ <code>Element</code>ã€‚</p><p>å¤ç”¨ <code>Element</code> å¯¹æ€§èƒ½éå¸¸é‡è¦ï¼Œå› ä¸º <code>Element</code> æ‹¥æœ‰ä¸¤ä»½å…³é”®æ•°æ®ï¼š<code>Stateful widget</code> çš„çŠ¶æ€å¯¹è±¡åŠåº•å±‚çš„<br><code>RenderObject</code>ã€‚</p><p>å½“åº”ç”¨çš„ç»“æ„å¾ˆç®€å•æ—¶ï¼Œæˆ–è®¸ä½“ç°ä¸å‡ºè¿™ç§ä¼˜åŠ¿ï¼Œä¸€æ—¦åº”ç”¨å¤æ‚èµ·æ¥ï¼Œæ„æˆé¡µé¢çš„å…ƒç´ è¶Šæ¥è¶Šå¤šï¼Œé‡æ–°åˆ›å»º 3 æ£µæ ‘çš„ä»£ä»·æ˜¯å¾ˆé«˜çš„ï¼Œæ‰€ä»¥éœ€è¦æœ€å°åŒ–æ›´æ–°æ“ä½œã€‚</p><p>å½“ Flutter èƒ½å¤Ÿå¤ç”¨ <code>Element</code> æ—¶ï¼Œç”¨æˆ·ç•Œé¢çš„é€»è¾‘çŠ¶æ€ä¿¡æ¯æ˜¯ä¸å˜çš„ï¼Œå¹¶ä¸”å¯ä»¥é‡ç”¨ä¹‹å‰è®¡ç®—çš„å¸ƒå±€ä¿¡æ¯ï¼Œé¿å…éå†æ•´æ£µæ ‘ã€‚</p><h2 id="ä¸¾ä¸ªä¾‹å­è¯´æ˜"><a href="#ä¸¾ä¸ªä¾‹å­è¯´æ˜" class="headerlink" title="ä¸¾ä¸ªä¾‹å­è¯´æ˜"></a>ä¸¾ä¸ªä¾‹å­è¯´æ˜</h2><p>åˆ›å»ºä¸€ä¸ªç®€å•çš„ Flutter åº”ç”¨ï¼Œä»£ç å¦‚ä¸‹</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;void main() {  runApp(    MaterialApp(      color: Colors.white,      debugShowCheckedModeBanner: false,      builder: (context, child) =&gt; HomePage(),    ),  );}class HomePage extends StatefulWidget {  @override  _HomePageState createState() =&gt; _HomePageState();}class _HomePageState extends State&lt;HomePage&gt; {  bool _isWorld = true;  Widget _buildWorld() {    return RichText(      text: TextSpan(        text: &#39;Hello world&#39;,        style: TextStyle(color: Colors.black),      ),    );  }  Widget _buildFlutter() {    return RichText(      text: TextSpan(        text: &#39;Hello flutter&#39;,        style: TextStyle(color: Colors.black),      ),    );  }  void changeText() {    setState(() {      _isWorld = !_isWorld;    });  }  @override  Widget build(BuildContext context) {    return Scaffold(      body: Column(        mainAxisAlignment: MainAxisAlignment.center,        children: &lt;Widget&gt;[          Center(            child: _isWorld ? _buildWorld() : _buildFlutter(),          ),          SizedBox(height: 20.0),          // Padding(padding: EdgeInsets.only(top: 20.0)),          IconButton(icon: Icon(Icons.refresh), onPressed: changeText)        ],      ),    );  }}</code></pre><p>æ˜¾ç¤ºæ•ˆæœ</p><img src="./images/how-flutter-render/simulator-world.png" style="width:320px"><p>æ‰“å¼€ <a href="http://127.0.0.1:9100" target="_blank" rel="noopener">Dart DevTools</a>ï¼Œå¯ä»¥çœ‹åˆ°åº”ç”¨çš„ <code>Widget Tree</code>ï¼Œæ­¤æ—¶ <code>RichText</code> æ§ä»¶çš„ <code>RenderObject</code> çš„ ID æ˜¯ <code>#6276a</code></p><p><img src="./images/how-flutter-render/world-id.png" alt="world-id"></p><p>ç‚¹å‡»å›¾æ ‡å°†æ–‡å­—å˜æˆ <code>Hello flutter</code> æ—¶</p><img src="./images/how-flutter-render/simulator-flutter.png" style="width:320px"><p>åˆ·æ–°æµè§ˆå™¨é¡µé¢å†æ¬¡æŸ¥çœ‹ <code>RichText</code> çš„ <code>RenderObject</code> çš„ ID ä¾ç„¶æ˜¯ <code>#6276a</code></p><p><img src="./images/how-flutter-render/flutter-id.png" alt="flutter-id"></p><p>å¯ä»¥å‘ç° Flutter åªæ˜¯æ›´æ–°äº†æ–‡å­—æ•°æ®ï¼Œå¤ç”¨äº† <code>RichText</code> å¯¹åº”çš„ <code>Element</code> å’Œ <code>RenderObject</code>ã€‚</p><p>è€Œä½¿ç”¨ <code>SizedBox</code> éƒ¨ä»¶å–ä»£ <code>Padding</code> éƒ¨ä»¶æ—¶ã€‚</p><pre><code class="dart">@overrideWidget build(BuildContext context) {  return Scaffold(    body: Column(      mainAxisAlignment: MainAxisAlignment.center,      children: &lt;Widget&gt;[        Center(          child: RichText(            text: TextSpan(              text: &#39;Hello $text&#39;,              style: TextStyle(color: Colors.black),            ),          ),        ),        SizedBox(height: 20.0),        // Padding(padding: EdgeInsets.only(top: 20.0)),        IconButton(icon: Icon(Icons.refresh), onPressed: changeText)      ],    ),  );}</code></pre><p><img src="./images/how-flutter-render/padding.png" alt="padding"></p><p><code>Padding</code> éƒ¨ä»¶å¯¹åº”çš„ <code>Element</code> å’Œ <code>RenderObject</code> éƒ½ä¼šè¢«ä»æ ‘ä¸­ç§»é™¤ï¼Œä½¿ç”¨ <code>SizedBox</code> æ–°ç”Ÿæˆçš„æ›¿ä»£ã€‚</p><p><img src="./images/how-flutter-render/sizeedbox.png" alt="sizeedbox"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>Widget</code> æ˜¯åº”ç”¨ç•Œé¢çš„å£°æ˜ä¿¡æ¯ã€‚<br><code>Element</code> é“¾æ¥ <code>Widget</code> å’Œ <code>RenderObject</code>ï¼Œç®¡ç†ç•Œé¢çš„æ›´æ–°å’Œä¿®æ”¹ã€‚<br><code>RenderObject</code> ä¿å­˜å…·ä½“çš„å¸ƒå±€ä¿¡æ¯ï¼Œè´Ÿè´£ç»˜åˆ¶ UIã€‚</p><p><img src="./images/how-flutter-render/widget-element-render-object.png" alt="widget-element-render-object"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://youtu.be/996ZgFRENMs" target="_blank" rel="noopener">How Flutter renders Widgets</a> (Video)</p><p><a href="https://medium.com/manabie/how-flutter-renders-widgets-fd6eca945a04" target="_blank" rel="noopener">How Flutter renders Widgets</a></p><p><a href="https://book.flutterchina.club/chapter14/flutter_ui_system.html" target="_blank" rel="noopener">Flutter UIç³»ç»Ÿ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/how-flutter-render/cover.jpg&quot; alt=&quot;cover&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>PlantUML ç±»å›¾åŠ Flowchart æµç¨‹å›¾ç»˜åˆ¶å…¥é—¨</title>
    <link href="https://coldstone.fun/post/2020/03/26/learn-classchart-flowchart/"/>
    <id>https://coldstone.fun/post/2020/03/26/learn-classchart-flowchart/</id>
    <published>2020-03-26T02:00:00.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/draw.jpg" alt="draw"></p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰æ®µæ—¶é—´è®¾è®¡åç«¯è¡¨ç»“æ„çš„æ—¶å€™æ¥è§¦äº† <code>PlantUML</code>ï¼Œå®ƒèƒ½å¤Ÿç›´è§‚è¡¨ç°å‡ºç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œååº”å‡ºç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»ã€‚ä¹‹å‰æœ‰åŒäº‹å°±æ˜¯ç”¨ <code>PlantUML</code> æ¥åšåç«¯æ•°æ®è¡¨è®¾è®¡å·¥ä½œçš„ï¼Œæ‰€ä»¥æœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹ã€‚</p><p>æµç¨‹å›¾ <code>Flowchart</code> æ˜¯ç”¨æ¥å±•ç¤ºæ“ä½œè¿‡ç¨‹æˆ–é€»è¾‘æµç¨‹çš„ä¸€ç§å›¾è¡¨ï¼Œè¯­æ³•æ¯”è¾ƒç®€å•ï¼Œæ–¹ä¾¿æ˜“ç”¨ï¼Œä¸€äº›æ¯”è¾ƒå¤æ‚çš„åˆ¤æ–­éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæµç¨‹å›¾æ¥ç›´è§‚è¡¨ç°ã€‚</p><h2 id="PlantUML"><a href="#PlantUML" class="headerlink" title="PlantUML"></a>PlantUML</h2><p><a href="https://plantuml.com/zh/" target="_blank" rel="noopener">PlantUML</a> æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ”¯æŒå¿«é€Ÿç»˜åˆ¶æ—¶åºå›¾ã€ç”¨ä¾‹å›¾ã€ç±»å›¾ã€æ´»åŠ¨å›¾ã€ç»„ä»¶å›¾ã€çŠ¶æ€å›¾ã€å¯¹è±¡å›¾ã€éƒ¨ç½²å›¾ç­‰ã€‚åŒæ—¶è¿˜æ”¯æŒé UML å›¾çš„ç”˜ç‰¹å›¾ã€æ¶æ„å›¾ç­‰ã€‚</p><p><code>PlantUML</code> æœ‰ä¸€äº›é€šç”¨è¯­æ³•</p><ul><li>å•è¡Œæ³¨é‡Šï¼šä»¥å•å¼•å· <code>&#39;</code> å¼€å¤´çš„è¯­å¥ã€‚</li><li>å¤šè¡Œæ³¨é‡Šï¼šä»¥ <code>/&#39;</code> å’Œ <code>&#39;/</code> ä½œä¸ºæ³¨é‡Šçš„å¼€å§‹å’Œç»“æŸã€‚</li><li>é¡µçœ‰ï¼šä½¿ç”¨ <code>header</code> å‘½ä»¤åœ¨ç”Ÿæˆçš„å›¾ä¸­å¢åŠ é¡µçœ‰ï¼Œç”¨ <code>center</code>, <code>left</code> æˆ– <code>right</code> å®ç°å±…ä¸­ã€å·¦å¯¹é½å’Œå³å¯¹é½ã€‚</li><li>é¡µè„šï¼šä½¿ç”¨ <code>footer</code> å‘½ä»¤åœ¨ç”Ÿæˆçš„å›¾ä¸­å¢åŠ é¡µçœ‰ï¼Œç”¨ <code>center</code>, <code>left</code> æˆ– <code>right</code> å®ç°å±…ä¸­ã€å·¦å¯¹é½å’Œå³å¯¹é½ã€‚</li><li>ç¼©æ”¾ï¼šä½¿ç”¨ <code>scale</code> å‘½ä»¤ç¼©æ”¾ç”Ÿæˆçš„å›¾åƒã€‚</li><li>æ ‡é¢˜ï¼šä½¿ç”¨ <code>title</code> å…³é”®å­—æ·»åŠ æ ‡é¢˜ã€‚</li><li>å›¾ç‰‡æ ‡é¢˜ï¼šä½¿ç”¨ <code>caption</code> å…³é”®å­—åœ¨å›¾åƒä¸‹æ”¾ç½®ä¸€ä¸ªæ ‡é¢˜.</li><li>å›¾ä¾‹è¯´æ˜: <code>legend</code> å’Œ <code>endlegend</code> ä½œä¸ºå…³é”®è¯ï¼Œä½¿ç”¨ <code>left</code>, <code>right</code>, <code>center</code> ä¸ºè¿™ä¸ªå›¾ä¾‹æŒ‡å®šå¯¹é½æ–¹å¼ã€‚</li></ul><p>ä¸€ä¸ªğŸŒ° <a href="http://www.plantuml.com/plantuml/uml/FO_D2i8m48JlynHxAmZI8eBYGIhU12_Y2uHsRHVo8ytMvtVHj8V0DxERcQJDwYQTWqVkd6Swx9hD_jW0rOMonC4iBv6fIo5mLA2kGFGS9PDae_liLRomuRMiL3M0peWd6jdrFA7iBv9ZNmWgQXNB_AViidkhfBZQHGEF53ZHzaotsJgLJkJJXwtEys2XQu-ZOjWfX5TAzg8ryo_Hsin-_mK0" target="_blank" rel="noopener">æŸ¥çœ‹</a></p><pre><code class="uml">@startumlscale 720*480&#39;A single line comment/&#39;  This is  Multilie  Comment&#39;/center headerThis is headerendheadertitle This is titlecaption This is captionRomeo -&gt; Juliet : lovelegendThis is a legendendlegendfooter This is footer@enduml</code></pre><img style="width:320px" alt="base" src="http://www.plantuml.com/plantuml/png/HP3D2i8m48JlynHxAmZI8eBYGIhU12_Y2uHsRHVo8ytMvtUnFrwIRoQp6TWwgnjq31wvSPxfiAis-sC551VA4Zkpl4Ic9eN0KO6o0D6pbqoIZUwZL_72XjSvKfG06YCUg6VNseLvODKSsma15RMI9V1JDkxUAYckzgo1HmgSQ7kcssYjIYVowSC0F7VswR_9qUBOCI7mIacjVibC4hMzsGQ-"><h3 id="ç±»å›¾"><a href="#ç±»å›¾" class="headerlink" title="ç±»å›¾"></a>ç±»å›¾</h3><p>ç”»ç±»å›¾éœ€è¦äº†è§£ç±»ä¸ç±»ä¹‹é—´çš„å‡ ç§ä¸åŒçš„å…³ç³»</p><table><thead><tr><th align="left">å…³ç³»</th><th align="left">æ„æ€</th><th align="left">æ ‡è®°</th></tr></thead><tbody><tr><td align="left">Association å…³ç³»</td><td align="left">ä¸¤ä¸ªç±»ä¹‹é—´æœ‰ç›¸äº’å…³ç³»</td><td align="left"><code>&lt;--</code></td></tr><tr><td align="left">Inheritance ç»§æ‰¿</td><td align="left">å­ç±»ç»§æ‰¿çˆ¶ç±»</td><td align="left"><code>&lt;|--</code></td></tr><tr><td align="left">Composition ç»„åˆ</td><td align="left">ä¸¤ä¸ªç±»ä¹‹é—´ç›¸äº’ä¾èµ–</td><td align="left"><code>*--</code></td></tr><tr><td align="left">Aggregation èšåˆ</td><td align="left">ä¸€ä¸ªç±»å±äºå¦ä¸€ä¸ªç±»</td><td align="left"><code>o--</code></td></tr><tr><td align="left">Implementation å®ç°</td><td align="left">ä¸€ä¸ªç±»å®ç°å¦ä¸€ä¸ªç±»çš„æ–¹æ³•</td><td align="left"><code>&lt;|..</code></td></tr><tr><td align="left">Dependency ä¾èµ–</td><td align="left">ä¸€ä¸ªç±»ä¾èµ–äºå¦ä¸€ä¸ªç±»</td><td align="left"><code>&lt;..</code></td></tr></tbody></table><p><img src="https://miro.medium.com/max/1180/1*EUvDMA1vr0DiucONPzK9kA.png" alt="å…³ç³»å›¾"></p><p>è®¾è®¡ä¸€ä¸ªåšå®¢ç³»ç»ŸğŸ˜œ <a href="http://www.plantuml.com/plantuml/umla/XPBHwjCm58VlynJdSdDs3lL2YiZ4Hn2zh-t11TeKaenTw63Wc5CSSwB3JS4v54MXkn2nEFLfbgQ-XUiQszaXV-X5slFzlfoSj2samsKty8bm7H_XyfNMkKiNMyH59f531nqFETd5WrtyIKS3DNcXbqCrMQfehRzizVODGUOPYX3NTuI0srHG6NAuH-0E3ti2QtNIBwhNkQIkZrcr0TIpWJAPBPskx8IyU7L39f596uJabDqz4jmIU713mwIp9NC2jE5cpWBi7mjwd4eqszKgllg1SCCWG2R_o_IBfhs0icnJ2ppqiTIQ5kfbvKRk_AU27fMLnFdoXCTK9LsXeEp8W2U3g9mX-tGqsIn_cD_L-vPbJcK3wEYjVZfIivV9wqTglFgzU7T1_vYdlsR9_A7-l5BFdgIROHfztzzz-k2dUlpAI9hDuZfjqCy_9kDlQhhPRT-hqIAFbg1f-1JCrUIloBAk5N-G3KaSgsYTiydNQVfXRBn6ToPkx6raNZVm_m00" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹</a></p><pre><code class="uml">@startumlcenter headerä¸€ä¸ªç®€å•çš„åšå®¢ç³»ç»Ÿendheaderclass Visitor { browse()}class Article { + id: int + author: int + content: string}class User {  +id: int  +name: String  - writeArticle(content: string)  - commentArticle(content: string)}class Admin { - deleteArticle(id: int) - deleteComment(id: int) - editArticle(id: int, content: int) - editComment(id: int, content: int)}class Comment {  +id: int  +content: string  +author: int}User &lt;|-- Admin : ç®¡ç†å‘˜æœ‰åˆ é™¤/ç¼–è¾‘æ–‡ç« å’Œè¯„è®ºçš„èƒ½åŠ›User &lt;.. Article : ç”¨æˆ·å¯ä»¥å†™æ–‡ç« User &lt;.. Comment : ç”¨æˆ·å¯ä»¥å†™è¯„è®ºArticle --&gt; Visitor : æ¸¸å®¢å¯ä»¥æµè§ˆæ–‡ç« Comment --&gt; Visitor : æ¸¸å®¢å¯ä»¥æµè§ˆè¯„è®º@enduml</code></pre><p><img src="./images/learn-chart/class.png" alt="blog"></p><h2 id="Flowchart"><a href="#Flowchart" class="headerlink" title="Flowchart"></a>Flowchart</h2><p>æµç¨‹å›¾ä½¿ç”¨ <a href="http://flowchart.js.org/" target="_blank" rel="noopener">Flowchart</a> ç»˜åˆ¶ï¼Œè¯­æ³•æ¯”è¾ƒç®€å•ã€‚</p><p>å®šä¹‰ä¸€ä¸ªæµç¨‹å›¾å…ƒç´  <code>name=&gt;type: content:&gt;url</code></p><ul><li>name: å…ƒç´ çš„åç§°</li><li>typeï¼šç±»å‹ï¼ŒåŒ…æ‹¬å¦‚ä¸‹ç±»åˆ«ï¼š<ul><li>start</li><li>end</li><li>operation</li><li>subroutine</li><li>condition</li><li>inputoutput</li><li>parallel</li></ul></li><li>contentï¼šæ–‡æœ¬å†…å®¹</li><li>urlï¼šè¿æ¥</li></ul><p>ç¤ºä¾‹å¦‚ä¸‹</p><pre><code class="ts">st=&gt;start: è‰°éš¾çš„å¼€å§‹ge=&gt;end: ä½ æˆåŠŸäº†:&gt;https://www.zhihu.com/hotbe=&gt;end: ä½ å¤±è´¥äº†:&gt;https://bbs.hupu.com/bxjskill=&gt;condition: æœ‰æŠ€èƒ½å—money=&gt;condition: æœ‰é’±å—handsome=&gt;condition: é•¿å¾—å¸…å—dream=&gt;operation: åšæ¢¦imp=&gt;operation: åŠªåŠ›æé«˜è‡ªå·±work=&gt;operation: å·¥ä½œ/è¯»ä¹¦make=&gt;operation: æŠ•èµ„ç†è´¢rich=&gt;operation: æ‰¾å¯Œå©†st-&gt;skillskill(yes)-&gt;work-&gt;geskill(no)-&gt;moneymoney(yes)-&gt;make-&gt;gemoney(no)-&gt;handsomehandsome(yes)-&gt;rich-&gt;gehandsome(no)-&gt;be</code></pre><p><img src="./images/learn-chart/flow.png" alt="start"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://plantuml.com/zh/" target="_blank" rel="noopener">PlantUML</a></p><p><a href="https://github.com/adrai/flowchart.js" target="_blank" rel="noopener">Flowchart</a></p><p><a href="https://medium.com/@smagid_allThings/uml-class-diagrams-tutorial-step-by-step-520fd83b300b" target="_blank" rel="noopener">UML Class Diagrams Tutorial, Step by Step</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/draw.jpg&quot; alt=&quot;draw&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="å­¦ä¹ " scheme="https://coldstone.fun/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="PlantUML" scheme="https://coldstone.fun/tags/PlantUML/"/>
    
      <category term="Flowchart" scheme="https://coldstone.fun/tags/Flowchart/"/>
    
  </entry>
  
  <entry>
    <title>è®°å½•ä¸¤ä¸ªä½¿ç”¨ Flutter çš„ DropdownButton é—®é¢˜</title>
    <link href="https://coldstone.fun/post/2020/03/24/flutter-dropdown-problem/"/>
    <id>https://coldstone.fun/post/2020/03/24/flutter-dropdown-problem/</id>
    <published>2020-03-24T08:08:27.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™å‡ å¤©åœ¨ä½¿ç”¨ <code>Flutter</code> å¼€å‘åº”ç”¨è¿‡ç¨‹ä¸­é‡åˆ°å…³äº <code>DropdownButton</code> ä¸¤ä¸ªé—®é¢˜ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><p>é—®é¢˜ä¸€ï¼šåœ¨ <code>showModalBottomSheet</code> é‡Œé¢ä½¿ç”¨ <code>DropdownButton</code> æ”¹å˜é€‰æ‹©åç•Œé¢ä¸å˜åŒ–ã€‚</p><p><img src="./images/flutter-dropdown-problem/dropdown-no-change.gif" alt="no-change"></p><p>ä½†æ˜¯ <code>onChanged</code> äº‹ä»¶å·²ç»è§¦å‘</p><p><img src="./images/flutter-dropdown-problem/console.png" alt="console"></p><p>ä»£ç å¦‚ä¸‹</p><pre><code class="dart">int _type = 0;...IconButton(  icon: Icon(Icons.filter_list),  onPressed: () {    showModalBottomSheet(      context: context,      builder: (BuildContext context) {        return Column(          crossAxisAlignment: CrossAxisAlignment.start,          children: &lt;Widget&gt;[            Padding(              padding: const EdgeInsets.all(12.0),              child: Row(                children: &lt;Widget&gt;[                  SizedBox(                    width: 80.0,                    child: Text(&#39;ç±»å‹: &#39;),                  ),                  DropdownButton&lt;int&gt;(                    value: _type,                    onChanged: (int newValue) {                      setState(() {                        _type = newValue;                      });                      print(newValue.toString());                    },                    items: [                      DropdownMenuItem&lt;int&gt;(                        value: 0,                        child: Text(&#39;ç±»å‹ 1&#39;),                      ),                      DropdownMenuItem&lt;int&gt;(                        value: 1,                        child: Text(&#39;ç±»å‹ 2&#39;),                      ),                    ],                  ),                ],              ),            ),          ],        );      },    );  },),</code></pre><p>è§£å†³æ–¹æ³•ï¼šæ·»åŠ ä¸€ä¸ª <code>StatefulBuilder</code> éƒ¨ä»¶åœ¨æœ€å¤–å±‚å³å¯</p><pre><code class="dart">showModalBottomSheet(  context: context,  builder: (BuildContext context) {    return StatefulBuilder(      builder: (context, StateSetter setState) {        return Column(          crossAxisAlignment: CrossAxisAlignment.start,          children: &lt;Widget&gt;[            Padding(              padding: const EdgeInsets.all(12.0),              child: Row(                children: &lt;Widget&gt;[                  SizedBox(                    width: 80.0,                    child: Text(&#39;ç±»å‹: &#39;),                  ),                  DropdownButton&lt;int&gt;(                    value: _type,                    onChanged: (int newValue) {                      setState(() {                        _type = newValue;                      });                      print(newValue.toString());                    },                    items: [                      DropdownMenuItem&lt;int&gt;(                        value: 0,                        child: Text(&#39;ç±»å‹ 1&#39;),                      ),                      DropdownMenuItem&lt;int&gt;(                        value: 1,                        child: Text(&#39;ç±»å‹ 2&#39;),                      ),                    ],                  ),                ],              ),            ),          ],        );      },    );  },);</code></pre><p>é—®é¢˜äºŒï¼šå½“å¤šä¸ª <code>DropdownMenuItem</code> å€¼ç›¸åŒæ—¶ä¼šæŠ¥é”™</p><p><img src="./images/flutter-dropdown-problem/crash.png" alt="crash"></p><p>è¿™ä¸ªæŠ¥é”™äº§ç”Ÿçš„åŸå› æ˜¯è¿™é‡Œçš„ <code>DropdownMenuItem</code> æ˜¯è¯·æ±‚åç«¯æ¥å£åä¼šç”Ÿæˆå¾ˆå¤šé€‰é¡¹ï¼Œå¦‚æœè®¾ç½®äº† <code>DropdownButton</code> çš„ <code>value</code> å€¼ï¼Œé‚£ä¹ˆ <code>DropdownMenuItem</code> å°±ä¼šæœ‰ç›¸åŒçš„å€¼ï¼Œå‡ºç°è¿™ä¸ªé”™è¯¯ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šä¸è®¾ç½® <code>DropdownButton</code> çš„åˆå§‹ <code>value</code> å€¼</p><pre><code class="dart">DropdownButton&lt;int&gt;(  // value: 0,  onChanged: (int newValue) {    setState(() {});  },  items: types.map(    (item) {      return DropdownMenuItem&lt;int&gt;(        value: item[&quot;value&quot;],        child: Text(item[&quot;label&quot;]),      );    },  ).toList(),);</code></pre><p>psï¼šè¿™ä¸¤ä¸ªé—®é¢˜å¡äº†æˆ‘ä¸¤å¤©ğŸ˜”</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;è¿™å‡ å¤©åœ¨ä½¿ç”¨ &lt;code&gt;Flutter&lt;/code&gt; å¼€å‘åº”ç”¨è¿‡ç¨‹ä¸­é‡åˆ°å…³äº &lt;code&gt;DropdownButton&lt;/code&gt; ä¸¤ä¸ªé—®é¢˜ï¼Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;&lt;p&gt;é—®é¢˜ä¸€ï¼šåœ¨ &lt;code&gt;showModalBottomSheet&lt;/code&gt; é‡Œé¢ä½¿ç”¨
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹äºŒå‰æ ‘</title>
    <link href="https://coldstone.fun/post/2020/03/15/das-tree/"/>
    <id>https://coldstone.fun/post/2020/03/15/das-tree/</id>
    <published>2020-03-15T03:05:00.000Z</published>
    <updated>2020-06-18T09:46:58.872Z</updated>
    
    <content type="html"><![CDATA[<p>äºŒå‰æ ‘æ˜¯ä¸€ç§éçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œä»¥åˆ†å±‚çš„æ–¹å¼å­˜å‚¨æ•°æ®ã€‚åœ¨äºŒå‰æ ‘ä¸Šè¿›è¡Œæ·»åŠ ï¼ŒæŸ¥æ‰¾å’Œåˆ é™¤æ•°æ®éå¸¸å¿«ã€‚</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>äºŒå‰æ ‘æ˜¯ä¸€ç§éçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œä»¥åˆ†å±‚çš„æ–¹å¼å­˜å‚¨æ•°æ®ã€‚ç”¨äºå­˜å‚¨æœ‰å±‚çº§å…³ç³»çš„æ•°æ®ï¼Œå¦‚è®¡ç®—æœºæ–‡ä»¶ï¼Œå…¬å¸ç»„ç»‡ç»“æ„ç­‰æ•°æ®ã€‚åœ¨äºŒå‰æ ‘ä¸Šè¿›è¡Œæ·»åŠ ï¼ŒæŸ¥æ‰¾å’Œåˆ é™¤æ•°æ®éå¸¸å¿«ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>è¦å®ç°æ ‘ç»“æ„é¦–å…ˆéœ€è¦ <code>Node</code> èŠ‚ç‚¹ç±»ï¼ŒèŠ‚ç‚¹ä¿å­˜æ•°æ®å’Œå®ƒå·¦å³èŠ‚ç‚¹çš„é“¾æ¥ï¼Œ<code>show</code> æ–¹æ³•è¿”å›èŠ‚ç‚¹æ•°æ®ã€‚</p><pre><code class="ts">class Node {  data: number  left: Node = null  right: Node = null  constructor(data: number) {    this.data = data  }  show() {    return this.data  }}</code></pre><p>å®ç°äºŒå‰æ ‘ï¼Œé¦–å…ˆéœ€è¦å‘æ ‘ä¸­æ’å…¥èŠ‚ç‚¹çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å…ˆåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ¤æ–­æ ‘æ˜¯å¦æœ‰æ ¹èŠ‚ç‚¹ï¼Œæ²¡æœ‰çš„è¯å°†æ–°èŠ‚ç‚¹ä½œä¸ºæ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥ï¼›</p><ol><li>è®¾å½“å‰èŠ‚ç‚¹ä¸ºæ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå¼€å§‹å¾ªç¯</li><li>å¦‚æœæ’å…¥èŠ‚ç‚¹çš„æ•°æ®å°äºå½“å‰èŠ‚ç‚¹çš„æ•°æ®ï¼Œå°†æ–°å½“å‰èŠ‚ç‚¹è®¾ä¸ºåŸå½“å‰èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼Œå¦åˆ™æ‰§è¡Œç¬¬ 4 æ­¥</li><li>å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ä¸º <code>null</code> ï¼Œå°±å°†æ–°çš„èŠ‚ç‚¹æ’å…¥è¿™ä¸ªä½ç½®ï¼Œé€€å‡ºå¾ªç¯ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯</li><li>å°†æ–°å½“å‰èŠ‚ç‚¹è®¾ä¸ºåŸå½“å‰èŠ‚ç‚¹çš„å³èŠ‚ç‚¹</li><li>å¦‚æœå½“å‰èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ä¸º <code>null</code> ï¼Œå°±å°†æ–°çš„èŠ‚ç‚¹æ’å…¥è¿™ä¸ªä½ç½®ï¼Œé€€å‡ºå¾ªç¯ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯</li></ol><pre><code class="ts">class BST {  root: Node = null  length: number = 0  // æ’å…¥èŠ‚ç‚¹  insert(data: number) {    // å…ˆåˆ›å»ºæ–°çš„èŠ‚ç‚¹    const node = new Node(data)    if (this.root === null) {      this.root = node      return;    } else {      let originNode      // å°†å½“å‰èŠ‚ç‚¹è®¾ä¸ºæ ‘æ ¹èŠ‚ç‚¹      let currentNode = this.root      // å¼€å§‹å¾ªç¯      while (true) {        // ä¿å­˜åŸèŠ‚ç‚¹å¼•ç”¨        originNode = currentNode        //  å¦‚æœæ’å…¥èŠ‚ç‚¹çš„æ•°æ®å°äºå½“å‰èŠ‚ç‚¹çš„æ•°æ®        if (data &lt; currentNode.data) {          // å°†æ–°å½“å‰èŠ‚ç‚¹è®¾ä¸ºåŸå½“å‰èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹          currentNode = currentNode.left          // å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ä¸º `null` ï¼Œå°±å°†æ–°çš„èŠ‚ç‚¹æ’å…¥è¿™ä¸ªä½ç½®ï¼Œé€€å‡ºå¾ªç¯ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯          if (currentNode === null) {            originNode.left = node            break          }        } else {          // å°†æ–°å½“å‰èŠ‚ç‚¹è®¾ä¸ºåŸå½“å‰èŠ‚ç‚¹çš„å³èŠ‚ç‚¹          currentNode = currentNode.right          // å¦‚æœå½“å‰èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ä¸º `null` ï¼Œå°±å°†æ–°çš„èŠ‚ç‚¹æ’å…¥è¿™ä¸ªä½ç½®ï¼Œé€€å‡ºå¾ªç¯ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯          if (currentNode === null) {            originNode.right = node            break          }        }      }    }  }}</code></pre><p>éå†äºŒå‰æ ‘ï¼Œä¸­åºï¼Œå…ˆåºï¼Œååº</p><pre><code class="ts"> // ä¸­åºéå†inOrder(node: Node) {  if (node !== null) {    this.inOrder(node.left)    node.show()    this.inOrder(node.right)  }}// å…ˆåºéå†preOrder(node: Node) {  if (node !== null) {    node.show()    this.preOrder(node.left)    this.preOrder(node.right)  }}// ååºéå†postOrder(node: Node) {  if (node !== null) {    this.postOrder(node.left)    this.postOrder(node.right)    node.show()  }}</code></pre><p>æŸ¥æ‰¾èŠ‚ç‚¹</p><pre><code class="js">find(data: number): Node {  let currentNode = this.root  while (currentNode !== null) {    if (currentNode.data === data) {      return currentNode    } else if (currentNode.data &gt; data) {      currentNode = currentNode.left    } else {      currentNode = currentNode.right    }  }  return null}</code></pre><p>åˆ é™¤èŠ‚ç‚¹</p><pre><code class="ts">  remove(data: number) {    this.root = this.removeNode(this.root, data)  }  removeNode(node: Node, data: number): Node {    if (node === null) {      return null    }    if (data === node.data) {      // æ²¡æœ‰å­èŠ‚ç‚¹      if (node.left === null &amp;&amp; node.right === null) {        return null      }      // æ²¡æœ‰å·¦å­èŠ‚ç‚¹      if (node.left === null) {        return node.right      }      // æ²¡æœ‰å³å­èŠ‚ç‚¹      if (node.right === null) {        return node.left      }      // æœ‰å·¦å³ä¸¤ä¸ªèŠ‚ç‚¹      const tempNode = this.min(node.right)      node.data = tempNode.data      node.right = this.removeNode(node.right, tempNode.data)      return node    } else if (node.data &gt; data) {      node.left = this.removeNode(node.left, data)      return node    } else {      node.right = this.removeNode(node.right, data)      return node    }  }</code></pre><p>æœ€å¤§å€¼ï¼Œæœ€å°å€¼</p><pre><code class="ts">// æœ€å°å€¼èŠ‚ç‚¹min(node: Node = this.root): Node {  let currentNode = node  while (currentNode.left !== null) {    currentNode = currentNode.left  }  return currentNode}// æœ€å¤§å€¼èŠ‚ç‚¹max(node: Node = this.root): Node {  let currentNode = node  while (currentNode.right !== null) {    currentNode = currentNode.right  }  return currentNode}</code></pre><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><p><code>BST</code> å¯ä»¥ç”¨æ¥è®°å½•ä¸€ç»„æ•°æ®ä¸­æ•°æ®å‡ºç°çš„æ¬¡æ•°ï¼Œé¦–å…ˆåœ¨ <code>Node</code> ç±»ä¸Šæ·»åŠ  <code>count</code> å±æ€§</p><pre><code class="ts">class Node {  data: number  left: Node = null  right: Node = null  count: number = 0  constructor(data: number) {    this.data = data  }  show() {    return this.data  }}</code></pre><p>åœ¨ <code>BST</code> ç±»ä¸Šæ·»åŠ  <code>update</code> æ–¹æ³•ï¼Œå½“æ’å…¥æ•°æ®ä¸ºæ–°å€¼æ—¶ä½¿ç”¨ <code>insert</code> æ–¹æ³•ï¼Œå½“æ’å…¥å·²ç»å­˜åœ¨çš„å€¼æ—¶ä½¿ç”¨ <code>update</code> æ–¹æ³•</p><pre><code class="ts">update(data: number): Node {  const node = this.find(data)  if(node !== null) {    node.count++    console.log(`${node.data}: `, node.count)    return node  }}</code></pre><p>æµ‹è¯•ä¸€ä¸‹</p><pre><code class="ts">const bst = new BST();const array = [2, 3, 5, 6, 10, 3, 4, 2, 8, 5, 9, 1, 4, 2, 5]for (let index = 0; index &lt; array.length; index++) {    const num = array[index]    if (bst.find(num) !== null) {        bst.update(num);    }    else {        bst.insert(num);    }}// 3:  1// 2:  1// 5:  1// 4:  1// 2:  2// 5:  2</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;äºŒå‰æ ‘æ˜¯ä¸€ç§éçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œä»¥åˆ†å±‚çš„æ–¹å¼å­˜å‚¨æ•°æ®ã€‚åœ¨äºŒå‰æ ‘ä¸Šè¿›è¡Œæ·»åŠ ï¼ŒæŸ¥æ‰¾å’Œåˆ é™¤æ•°æ®éå¸¸å¿«ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="DSA" scheme="https://coldstone.fun/tags/DSA/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ Gitlib æŒç»­å‘å¸ƒ Flutter åº”ç”¨</title>
    <link href="https://coldstone.fun/post/2020/02/27/flutter-gitlab-pineline/"/>
    <id>https://coldstone.fun/post/2020/02/27/flutter-gitlab-pineline/</id>
    <published>2020-02-27T03:01:00.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/samuel-chenard.jpg" alt="action"></p><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Gitlib CI/CD æ„å»ºå‘å¸ƒ Flutter åº”ç”¨</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><a href="https://coldstone.fun/post/2020/02/26/flutter-github-actions/">å‰ä¸€ç¯‡æ–‡ç« </a>ä»‹ç»äº†ä½¿ç”¨ Github Actions æŒç»­å‘å¸ƒ Flutter åº”ç”¨ï¼Œæœ¬æ–‡åˆ†äº«ä¸‹å¦‚ä½•ä½¿ç”¨ Gitlib çš„ CI/CD åŠŸèƒ½åŒæ ·å®ç°å‘å¸ƒ Flutter åº”ç”¨ï¼Œå› ä¸ºæœ‰å¾ˆå¤šå…¬å¸æ˜¯ç”¨è‡ªå·±æ­å»ºçš„ Gitlab æ¥ç®¡ç†ä»£ç çš„ã€‚</p><p>è¦ä½¿ç”¨ Gitlib çš„ CI/CD åŠŸèƒ½é¦–å…ˆéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª yml æ ¼å¼çš„é…ç½®æ–‡ä»¶ <code>.gitlab-ci.yml</code>ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶ä¼šå®šä¹‰ä¸€ä¸ªæµæ°´çº¿ Pipelineã€‚ä¸€ä¸ª Pipeline ç”±å¤šä¸ªä»»åŠ¡ Job ç»„æˆï¼Œä»»åŠ¡å°±æ˜¯å…·ä½“è¦åšçš„äº‹æƒ…ï¼Œå¦‚ä»£ç ç¼–è¯‘æˆ–æµ‹è¯•ï¼› Pipeline é‡Œçš„ stages å†³å®šäº†ä»»åŠ¡ä½•æ—¶ä»¥åŠå¦‚ä½•è¿è¡Œã€‚ä»¥ä¸‹å°±æ˜¯ä¸€ä¸ª Pipeline æœ‰ 3 ä¸ª stageï¼Œä¾æ¬¡æ‰§è¡Œ buildï¼Œtest å’Œ deploy ä»»åŠ¡ã€‚</p><pre><code class="yml">stages:  - build  - test  - deployjob01:  stage: build  script: echo &#39;build job&#39;job02:  stage: build  script: echo &#39;test job&#39;job03:  stage: deploy  script: echo &#39;deploy job&#39;</code></pre><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>è¦åœ¨ Pipeline é‡Œæ„å»ºæ‰“åŒ… Flutter åº”ç”¨çš„ apkï¼Œé¦–å…ˆéœ€è¦åœ¨æµæ°´çº¿é‡Œé…ç½® Android ä»¥åŠ Flutter ç¯å¢ƒï¼Œæœç´¢ä¸€ç•ªåå‘ç°äº†ä¸€ä¸ª Github ä¸Šçš„ Flutter é•œåƒ <a href="https://github.com/cirruslabs/docker-images-flutter" target="_blank" rel="noopener">docker-images-flutter</a> å¾ˆé€‚åˆï¼Œçœ‹è¿™ä¸ªé•œåƒçš„ <a href="https://github.com/cirruslabs/docker-images-flutter/blob/master/sdk/Dockerfile" target="_blank" rel="noopener">Dockerfile</a> å¯ä»¥å‘ç°å®ƒæ˜¯ä» <code>cirrusci/android-sdk:29</code> è¿™ä¸ª Android sdk é•œåƒå¼€å§‹ï¼Œç„¶åä¸‹è½½ Flutter SDKï¼Œè¿™æ ·å°±æœ‰äº†äº† Android å’Œ Flutter ç¯å¢ƒï¼Œæ¥ä¸‹æ¥åªéœ€è¦è¿è¡Œæµ‹è¯•å’Œæ‰“åŒ…å‘½ä»¤å³å¯</p><pre><code class="yaml">stages:  - build  - release// build é˜¶æ®µä½¿ç”¨æ‹¥æœ‰ Android ä»¥åŠ Flutter ç¯å¢ƒçš„é•œåƒï¼Œè¿›è¡Œæµ‹è¯•æ‰“åŒ…build:  stage: build  image: cirrusci/flutter:stable  only:    - tags  script:    // ä¸‹è½½ä¾èµ–åŒ…    - flutter packages get    // æ‰§è¡Œæµ‹è¯•    - flutter test    // æ‰“åŒ… apk    - flutter build apk --release  // è¿™é‡Œå®šä¹‰ä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶  artifacts:    expire_in: 1 hour    paths:      - build/app/outputs/apk/release/*.apk  interruptible: true</code></pre><h2 id="å‘å¸ƒ"><a href="#å‘å¸ƒ" class="headerlink" title="å‘å¸ƒ"></a>å‘å¸ƒ</h2><p>è¦å‘å¸ƒ apk æ–‡ä»¶åˆ°ä»“åº“çš„ release è¿˜éœ€è¦ä½¿ç”¨ <a href="https://github.com/inetprocess/gitlab-release" target="_blank" rel="noopener">gitlab-release</a> è¿™ä¸ªé•œåƒè¿›è¡Œå‘å¸ƒæ“ä½œ</p><pre><code class="yml">stages:  - build  - release// build é˜¶æ®µä½¿ç”¨æ‹¥æœ‰ Android ä»¥åŠ Flutter ç¯å¢ƒçš„é•œåƒï¼Œè¿›è¡Œæµ‹è¯•æ‰“åŒ…build:  stage: build  image: cirrusci/flutter:stable  only:    - tags  script:    - flutter packages get    - flutter test    - flutter build apk --release  artifacts:    expire_in: 1 hour    paths:      - build/app/outputs/apk/release/*.apk  interruptible: true// å‘å¸ƒåˆ°ä»“åº“çš„ releaserelease:  image: inetprocess/gitlab-release  stage: release  only:    - tags  dependencies:    - build  script:    // ä½¿ç”¨æ‰“åŒ…å¥½çš„ apk æ–‡ä»¶è·¯å¾„    - gitlab-release --message &#39;è‡ªåŠ¨å‘å¸ƒ&#39; build/app/outputs/apk/release/*.apk</code></pre><p>å‘å¸ƒè¿˜éœ€è¦ä¸€ä¸ª <code>Personal Access Token</code> ç»™ release ä»»åŠ¡æä¾› api æƒé™ï¼Œæœ‰äº† api æƒé™å°±å¯ä»¥è¯·æ±‚ Gitlab çš„ release æ¥å£ä¸Šä¼  apk äº†</p><p><img src="./images/gitlib-token.jpg" alt="token"></p><p>ä½¿ç”¨åˆšæ‰åˆ›å»ºçš„ token åœ¨é¡¹ç›®ä»“åº“é‡Œé…ç½®æµæ°´çº¿çš„ç¯å¢ƒå˜é‡ <code>GITLAB_ACCESS_TOKEN</code></p><p><img src="./images/gitlab-variable.jpg" alt="var"></p><p>æœ€ååˆ›å»ºä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾æ¨é€åˆ° Gitlab ä»“åº“ï¼Œå°±å¯ä»¥çœ‹åˆ°è¿è¡Œä¸­çš„æµæ°´çº¿äº†</p><pre><code class="sh">git tag v1.0.0git push --tag</code></pre><p><img src="./images/gitlib-pineline.jpg" alt="var"></p><p>æµæ°´çº¿è¿è¡Œå®Œæ¯•ï¼Œä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒæˆåŠŸã€‚</p><p><img src="./images/gitlib-release.jpg" alt="var"></p><h2 id="ä¸Šä¼ "><a href="#ä¸Šä¼ " class="headerlink" title="ä¸Šä¼ "></a>ä¸Šä¼ </h2><p><a href="https://www.pgyer.com/" target="_blank" rel="noopener">è’²å…¬è‹±</a> å¹³å°å¯ä»¥å¯¹åº”ç”¨è¿›è¡Œå†…æµ‹åˆ†å‘ï¼Œä½¿ç”¨è’²å…¬è‹±æä¾›çš„ä¸Šä¼ åº”ç”¨åŒ…çš„æ¥å£ï¼Œå°† <code>CI/CD</code> æ„å»ºå‡ºæ¥çš„åº”ç”¨ <code>apk</code> ç›´æ¥ä¸Šä¼ ï¼Œå…å»æ‰‹åŠ¨å»ç½‘é¡µä¸Šä¸Šä¼ çš„éº»çƒ¦</p><p>æ·»åŠ ä¸€ä¸ª <code>upload</code> ä»»åŠ¡ï¼Œä¾èµ–äº <code>build</code> ä»»åŠ¡ï¼Œå‘è’²å…¬è‹±çš„ä¸Šä¼ æ¥å£å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ<code>$APK_PATH</code> æ˜¯åº”ç”¨æ‰“åŒ…å‡ºæ¥çš„è·¯å¾„ï¼Œå®šä¹‰ä¸ºä¸€ä¸ªå˜é‡æ–¹ä¾¿ä½¿ç”¨;</p><pre><code class="yml">stages:  - build  - release  - upload......upload:  stage: upload  only:    - tags  dependencies:    - build  script:    - curl -S &quot;http://www.pgyer.com/apiv2/app/upload&quot; -F &quot;file=@$APK_PATH&quot; -F &quot;_api_key=$PGY_API_KEY&quot;    - echo uploaded</code></pre><p><code>$PGY_API_KEY</code> æ˜¯è’²å…¬è‹±å¹³å°çš„ <code>API Key</code>ï¼Œéœ€è¦æ·»åŠ åˆ° <code>CI/CD</code> çš„ç¯å¢ƒå˜é‡ä¸­</p><p><img src="./images/pgy-api-key.png" alt="api-key"></p><p>åœ¨ä»“åº“çš„è®¾ç½®é‚£é‡Œæ·»åŠ æ–°çš„ç¯å¢ƒå˜é‡</p><p><img src="./images/gitlab-pgy-variable.png" alt="variable"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>æ·»åŠ æµæ°´çº¿é…ç½® <code>.gitlab-ci.yml</code></li><li>åˆ›å»º <code>Personal Access Token</code></li><li>è®¾ç½®ç¯å¢ƒå˜é‡ <code>GITLAB_ACCESS_TOKEN</code></li><li>æ¨é€ç‰ˆæœ¬æ ‡ç­¾</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/inetprocess/gitlab-release" target="_blank" rel="noopener">Gitlab Release</a></p><p><a href="https://docs.gitlab.com/ee/ci/quick_start/README.html" target="_blank" rel="noopener">Getting started with GitLab CI/CD</a></p><p><a href="https://www.pgyer.com/doc/view/travis_android" target="_blank" rel="noopener">ä½¿ç”¨ Travis CI å®ç°æŒç»­é›†æˆ (Android)</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/samuel-chenard.jpg&quot; alt=&quot;action&quot;&gt;&lt;/p&gt;&lt;p&gt;æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Gitlib CI/CD æ„å»ºå‘å¸ƒ Flutter åº”ç”¨&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Gitlib" scheme="https://coldstone.fun/tags/Gitlib/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Github Actions æŒç»­å‘å¸ƒ Flutter åº”ç”¨</title>
    <link href="https://coldstone.fun/post/2020/02/26/flutter-github-actions/"/>
    <id>https://coldstone.fun/post/2020/02/26/flutter-github-actions/</id>
    <published>2020-02-26T17:59:06.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/flutter-action-sm.jpg" alt="action"></p><p>æœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ Github Actions æ„å»ºå¹¶å‘å¸ƒ Flutter åº”ç”¨</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><a href="https://help.github.com/en/actions" target="_blank" rel="noopener">Github Actions</a> æ˜¯ Github æä¾›çš„ä¸€ç§ CI/CD æœåŠ¡ï¼Œå¦‚æœä½ çš„ Flutter åº”ç”¨ä»£ç æ”¾åœ¨ Github ä¸Šï¼Œé‚£å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæœåŠ¡è‡ªåŠ¨åŒ–è¿›è¡Œåº”ç”¨æµ‹è¯•ï¼Œæ„å»ºï¼Œå‘å¸ƒå·¥ä½œäº†ã€‚</p><p>å…ˆè¯´ä¸‹ Github Actions å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºæ˜“æ‡‚çš„ï¼Œä¸å¾—ä¸è¯´ Github Actions çš„è®¾è®¡å¾ˆå‰å®³ ğŸ˜„</p><p><strong><code>Workflow file</code></strong></p><p>é…ç½®å·¥ä½œæµç¨‹çš„æ–‡ä»¶ï¼ŒYAML æ ¼å¼ï¼Œæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ <code>.github/workflows</code> ç›®å½•å†…</p><p><strong><code>Workflow</code></strong></p><p>ç”±é…ç½®æ–‡ä»¶å®šä¹‰çš„ä¸€ä¸ªå·¥ä½œæµç¨‹ï¼Œç”±ä¸€ç³»åˆ—çš„çš„ä»»åŠ¡ç»„æˆ</p><p><strong><code>Job</code></strong></p><p>å·¥ä½œæµç¨‹ä¸­çš„ä¸€ä¸ªä»»åŠ¡ï¼Œç”±ä¸€ç³»åˆ—çš„æ­¥éª¤ Step ç»„æˆ</p><p><strong><code>Step</code></strong></p><p>ä¸€ä¸ªä»»åŠ¡å…¶ä¸­çš„ä¸€ä¸ªæ‰§è¡Œæ­¥éª¤ï¼Œæ‰§è¡Œä¸€äº›å‘½ä»¤æˆ–è€… Action</p><p><strong><code>Action</code></strong></p><p>ä¸€ä¸ªæ­¥éª¤ä¸­çš„å…·ä½“è¦è¿›è¡Œæ“ä½œï¼Œå¦‚æ‹‰å–ä»£ç ï¼Œå‘é€è¯·æ±‚ç­‰ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå·±æˆ–ç¤¾åŒºå…±äº«çš„ Action</p><p><strong><code>Event</code></strong></p><p>è§¦å‘å·¥ä½œæµç¨‹è¿è¡Œçš„äº‹ä»¶ï¼Œæ¯”å¦‚æ¨é€ä»£ç åˆ°ä»“åº“ pushï¼Œåˆ›å»ºä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾ tag ç­‰</p><p><strong><code>Artifact</code></strong></p><p>å·¥ç¨‹æµç¨‹æ‰§è¡Œæ—¶äº§ç”Ÿçš„ä¸œè¥¿</p><p><strong><code>Runner</code></strong></p><p>å°±æ˜¯å·¥ä½œæµç¨‹è¿è¡Œçš„åœ°æ–¹ï¼ŒGithub æä¾›çš„æœåŠ¡å™¨</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>ä¸‹é¢ç”¨ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ Github Actions å‘å¸ƒ Flutter åº”ç”¨ï¼Œå…ˆæ”¾æˆæœ <a href="https://github.com/xrr2016/flutter-github-gitlab/releases" target="_blank" rel="noopener">åœ°å€</a></p><p><img src="./images/flutter-release.jpg" alt="main.yml"></p><ol><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ª Flutter é¡¹ç›®</li></ol><pre><code class="sh">flutter create flutter_github_actions</code></pre><ol start="2"><li>æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>.github/workflows/main.yml</code></li></ol><p><img src="./images/main-yml.jpg" alt="main.yml"></p><ol start="3"><li>é…ç½®å·¥ä½œæµç¨‹ï¼Œå°†ä»£ç æ¨é€åˆ° Github</li></ol><pre><code class="yml"># main.yml# å·¥ä½œæµç¨‹çš„åå­—name: Test, Build and Release apk# å·¥ä½œæµç¨‹è§¦å‘çš„æ—¶æœºï¼Œè¿™é‡Œæ˜¯å½“ä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾æ¨é€åˆ°ä»“åº“æ—¶è§¦å‘on:  push:    tags:      - v*# è¿™ä¸ªå·¥ä½œæµç¨‹éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡jobs:  process:    name: all process    runs-on: ubuntu-latest    # è¿™ä¸ªä»»åŠ¡çš„æ­¥éª¤    steps:      # æ‹‰å–é¡¹ç›®ä»£ç       - uses: actions/checkout@v2      # å»ºç«‹ java ç¯å¢ƒ      - name: Setup Java JDK        uses: actions/setup-java@v1.3.0        with:          java-version: &quot;12.x&quot;      # å»ºç«‹ Flutter ç¯å¢ƒ      - name: Flutter action        uses: subosito/flutter-action@v1.1.1        with:          channel: &quot;stable&quot;          flutter-version: &quot;1.12.x&quot;      # ä¸‹è½½é¡¹ç›®ä¾èµ–      - run: flutter pub get      # æ‰§è¡Œæµ‹è¯•      - run: flutter test      # æ‰“åŒ… APK      - run: flutter build apk --release      # å‘å¸ƒåˆ° Release      - name: Release apk        uses: ncipollo/release-action@v1.5.0        with:          artifacts: &quot;build/app/outputs/apk/release/*.apk&quot;          token: ${{ secrets.GITHUB_RElEASE_TOKEN }}</code></pre><ol start="4"><li>åˆ›å»º Token</li></ol><p>è¦æŠŠæ„å»ºå‡ºæ¥çš„ apk å‘å¸ƒåˆ°ä»“åº“çš„ Releaseï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª <a href="https://github.com/settings/tokens" target="_blank" rel="noopener">Personal access token</a> æä¾›å‘å¸ƒ action è®¿é—®å’Œæ“ä½œä»£ç ä»“åº“çš„æƒé™ï¼Œæ³¨æ„ä¸è¦å…³é—­æµè§ˆå™¨æ ‡ç­¾ï¼Œå› ä¸ºè¿™ä¸ª token åªæœ‰åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºçš„æ—¶å€™å¯è§ã€‚</p><p><img src="./images/flutter-gtihub-token.jpg" alt="token"></p><ol start="5"><li>æ·»åŠ ç¯å¢ƒå˜é‡</li></ol><p>æœ€åä¸ºäº†èƒ½åœ¨å·¥ä½œæµç¨‹ä¸­åˆ›å»ºçš„ tokenï¼Œéœ€è¦åœ¨ä»“åº“çš„ secrets é‡Œæ·»åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡ <code>GITHUB_RElEASE_TOKEN</code> æ¥å‚¨å­˜ token å€¼</p><p><img src="./images/github-secrets.jpg" alt="secrets"></p><ol start="6"><li>è§¦å‘æ„å»º</li></ol><p>æœ€ååˆ›å»ºä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾ï¼Œæ¨é€åˆ°ä»“åº“è§¦å‘å·¥ä½œæµç¨‹</p><pre><code class="sh">git tag v1.0.0git push --tag</code></pre><p>ç„¶åå°±å¯ä»¥åœ¨ä»“åº“çš„ Actions é‡Œé¢çœ‹åˆ°æ­£åœ¨è¿è¡Œçš„å·¥ä½œæµç¨‹äº†</p><p><img src="./images/github-workflow.jpg" alt="workflow"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ä»¥ä¸‹ 4 ä¸ªæ­¥éª¤</p><ol><li>åˆ›å»ºä¸€ä¸ªå·¥ä½œæµç¨‹çš„é…ç½®æ–‡ä»¶ <code>.github/workflows/main.yml</code></li><li>åˆ›å»ºä¸€ä¸ª Personnal access token</li><li>åœ¨é¡¹ç›®çš„ serect é‡Œé¢æ·»åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡ <code>GITHUB_RElEASE_TOKEN</code></li><li>æ¨é€ä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾ğŸ·ï¸ï¼Œè§¦å‘å·¥ä½œæµç¨‹</li></ol><p>ä¹‹åå°±å¯ä»¥åœ¨æ¯æ¬¡å‘å¸ƒæ ‡ç­¾åè‡ªåŠ¨å‘å¸ƒäº†</p><h2 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h2><p>æ„å»º Web åº”ç”¨ï¼Œå‘å¸ƒåˆ° Gihub Pages</p><pre><code class="yml"># å¯ç”¨ Flutter web- name: Enable flutter web  run: flutter config --enable-web# æ„å»º web åº”ç”¨- name: Build Web App  run: flutter build web# éƒ¨ç½²åˆ° Github Pages- name: deploy  uses: peaceiris/actions-gh-pages@v3  with:    github_token: ${{ secrets.TOKEN }}    publish_dir: ./build/web</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/flutter-action-sm.jpg&quot; alt=&quot;action&quot;&gt;&lt;/p&gt;&lt;p&gt;æœ¬æ–‡è®²è§£å¦‚ä½•ä½¿ç”¨ Github Actions æ„å»ºå¹¶å‘å¸ƒ Flutter åº”ç”¨&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Github Actions" scheme="https://coldstone.fun/tags/Github-Actions/"/>
    
  </entry>
  
  <entry>
    <title>MySQL å…¥é—¨ç¬”è®° ğŸ“’</title>
    <link href="https://coldstone.fun/post/2020/02/12/mysql-getting-start/"/>
    <id>https://coldstone.fun/post/2020/02/12/mysql-getting-start/</id>
    <published>2020-02-12T07:37:26.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://images.unsplash.com/photo-1489875347897-49f64b51c1f8?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2250&q=80" alt="mysql"></p><p>å·¥ä½œéœ€æ±‚å­¦ä¹ ä¸€ä¸‹ MySQL æ•°æ®åº“</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»€ä¹ˆæ˜¯ MySQLï¼Ÿå¼•ç”¨å®˜æ–¹è¯´æ˜</p><blockquote><p>MySQL is the worldâ€™s most popular open source database. Whether you are a fast growing web property, technology ISV or large enterprise, MySQL can cost-effectively help you deliver high performance, scalable database applications.</p><p>MySQL æ˜¯ä¸–ç•Œä¸Šæœ€å—æ¬¢è¿çš„å¼€æºæ•°æ®åº“ã€‚æ— è®ºæ‚¨æ˜¯å¿«é€Ÿå¢é•¿çš„ Web èµ„äº§ï¼ŒæŠ€æœ¯ ISV è¿˜æ˜¯å¤§å‹ä¼ä¸šï¼ŒMySQL éƒ½èƒ½ç»æµé«˜æ•ˆåœ°å¸®åŠ©æ‚¨äº¤ä»˜é«˜æ€§èƒ½ï¼Œå¯æ‰©å±•çš„æ•°æ®åº“åº”ç”¨ç¨‹åºã€‚</p></blockquote><p>MySQL æ˜¯ç›®å‰æœ€æµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ï¼Œå›½å†…å¤–å¾ˆå¤šå…¬å¸éƒ½åœ¨ä½¿ç”¨ï¼Œä½œä¸ºä¸€ä¸ªåº”ç”¨å¼€å‘äººå‘˜è¿˜æ˜¯æœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹ MySQL çš„åŸºæœ¬çŸ¥è¯†çš„ã€‚</p><h2 id="åŸºç¡€æ“ä½œ"><a href="#åŸºç¡€æ“ä½œ" class="headerlink" title="åŸºç¡€æ“ä½œ"></a>åŸºç¡€æ“ä½œ</h2><p>ä½¿ç”¨ Docker è¿è¡Œä¸€ä¸ª MySQL å®¹å™¨</p><pre><code class="s">docker run --name my-mysql -e MYSQL_ROOT_PASSWORD=1234 -d -v volume_folder -p 3306:3306 mysql:5</code></pre><p>å‘½ä»¤è¡Œç™»å½• MySQL</p><pre><code class="s">docker exec -it my-mysql bash</code></pre><pre><code class="s">mysql -u root -p</code></pre><p>åˆ›å»ºæ•°æ®åº“</p><pre><code class="sql">CREATE DATABASE db-name;</code></pre><p>æ˜¾ç¤ºæ•°æ®åº“åˆ—è¡¨</p><pre><code class="sql">show databases;</code></pre><p>é€‰æ‹©æ•°æ®åº“</p><pre><code class="sql">use dbname;</code></pre><p>æ˜¾ç¤ºæ•°æ®è¡¨</p><pre><code class="sql">show tables;</code></pre><p>åˆ›å»ºæ•°æ®è¡¨</p><pre><code class="sql">DROP TABLE IF EXISTS `user`;CREATE TABLE user(    `id`                 bigint(11)   NOT NULL AUTO_INCREMENT,    `user_id`            bigint(11)   NOT NULL COMMENT &#39;ç”¨æˆ·id&#39;,    `username`           varchar(45)  NOT NULL COMMENT &#39;çœŸå®å§“å&#39;,    `email`              varchar(30)  NOT NULL COMMENT &#39;ç”¨æˆ·é‚®ç®±&#39;,    `nickname`           varchar(45)  NOT NULL COMMENT &#39;æ˜µç§°&#39;,    `avatar`             int(11)      NOT NULL COMMENT &#39;å¤´åƒ&#39;,    `birthday`           date         NOT NULL COMMENT &#39;ç”Ÿæ—¥&#39;,    `gender`                tinyint(4)   DEFAULT &#39;0&#39; COMMENT &#39;æ€§åˆ«&#39;,    `bio`    varchar(150) DEFAULT NULL COMMENT &#39;ä¸€å¥è¯ä»‹ç»è‡ªå·±ï¼Œæœ€å¤š150ä¸ªæ±‰å­—&#39;,    `user_resume`        varchar(300) NOT NULL COMMENT &#39;ç”¨æˆ·æäº¤çš„ç®€å†å­˜æ”¾åœ°å€&#39;,    `user_register_ip`   int          NOT NULL COMMENT &#39;ç”¨æˆ·æ³¨å†Œæ—¶çš„æºip&#39;,    `create_time`        timestamp    NOT NULL COMMENT &#39;ç”¨æˆ·è®°å½•åˆ›å»ºçš„æ—¶é—´&#39;,    `update_time`        timestamp    NOT NULL COMMENT &#39;ç”¨æˆ·èµ„æ–™ä¿®æ”¹çš„æ—¶é—´&#39;,    `user_review_status` tinyint      NOT NULL COMMENT &#39;ç”¨æˆ·èµ„æ–™å®¡æ ¸çŠ¶æ€ï¼Œ1ä¸ºé€šè¿‡ï¼Œ2ä¸ºå®¡æ ¸ä¸­ï¼Œ3ä¸ºæœªé€šè¿‡ï¼Œ4ä¸ºè¿˜æœªæäº¤å®¡æ ¸&#39;,    PRIMARY KEY (`id`),    UNIQUE KEY `idx_user_id` (`user_id`),    KEY `idx_username` (`username`),    KEY `idx_create_time` (`create_time`, `user_review_status`)) ENGINE = InnoDB  DEFAULT CHARSET = utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT =&#39;ç½‘ç«™ç”¨æˆ·åŸºæœ¬ä¿¡æ¯&#39;;</code></pre><p>æ’å…¥æ•°æ®</p><pre><code class="sql">INSERT INTO table_name ( field1, field2 ) VALUES ( value1, value2 );INSERT INTO table_name SET field1=1,field2=2;</code></pre><p>æŸ¥è¯¢æ•°æ®</p><pre><code class="sql">SELECT username FROM table_name where id=1 limit 1;</code></pre><p>æ›´æ–°æ•°æ®</p><pre><code class="sql">update table_name set username=&#39;update&#39; where id=1;</code></pre><p>åˆ é™¤æ•°æ®</p><pre><code class="sql">delete from table_name where id=1;</code></pre><p>WHERE æœ‰æ¡ä»¶åœ°ä»è¡¨ä¸­é€‰å–æ•°æ®</p><pre><code class="sql">SELECT field1, field2,...fieldN FROM table_name1, table_name2...[WHERE condition1 [AND [OR]] condition2.....</code></pre><p>LIKE æœ‰æ¡ä»¶åœ°ä»è¡¨ä¸­é€‰å–æ•°æ®</p><pre><code class="sql">SELECT field1, field2,...fieldNFROM table_nameWHERE field1 LIKE condition1 [AND [OR]] filed2 = &#39;somevalue&#39;</code></pre><p>UNION è¿æ¥ SELECT è¯­å¥çš„ç»“æœç»„åˆåˆ°ä¸€ä¸ªç»“æœé›†åˆä¸­</p><pre><code class="sql">SELECT expression1, expression2, ... expression_nFROM tables[WHERE conditions]UNION [ALL | DISTINCT]SELECT expression1, expression2, ... expression_nFROM tables[WHERE conditions];</code></pre><p>JOIN æ ¹æ®ä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­çš„åˆ—ä¹‹é—´çš„å…³ç³»ä»ä¸­æŸ¥è¯¢æ•°æ®</p><pre><code class="sql">SELECT Persons.LastName, Persons.FirstName, Orders.OrderNoFROM PersonsINNER JOIN OrdersON Persons.Id_P = Orders.Id_PORDER BY Persons.LastName;</code></pre><p>æŸ¥æ‰¾è¡¨ä¸­å¤šä½™çš„é‡å¤è®°å½•ï¼Œé‡å¤è®°å½•æ˜¯æ ¹æ®å•ä¸ªå­—æ®µï¼ˆpeopleIdï¼‰æ¥åˆ¤æ–­</p><pre><code class="sql">select * from peoplewhere peopleId in (select peopleId from people group by peopleId having count(peopleId) &gt; 1)</code></pre><p>åˆ é™¤è¡¨ä¸­å¤šä½™çš„é‡å¤è®°å½•ï¼Œé‡å¤è®°å½•æ˜¯æ ¹æ®å•ä¸ªå­—æ®µï¼ˆpeopleIdï¼‰æ¥åˆ¤æ–­</p><pre><code class="sql">delete from peoplewhere peopleId in (select peopleId from people group by peopleId having count(peopleId) &gt; 1)</code></pre><p>æ˜¾ç¤ºæ•°æ®è¡¨çš„ç»“æ„</p><pre><code class="sql">describe table_name;</code></pre><p>æ·»åŠ åˆ—</p><pre><code class="sql">alter table è¡¨å add åˆ—å åˆ—æ•°æ®ç±»å‹ [after æ’å…¥ä½ç½®];</code></pre><p>ä¿®æ”¹åˆ—</p><pre><code class="sql">alter table è¡¨å change åˆ—åç§° åˆ—æ–°åç§° æ–°æ•°æ®ç±»å‹;</code></pre><p>åˆ é™¤åˆ—</p><pre><code class="sql">alter table è¡¨å drop åˆ—åç§°;</code></pre><p>é‡å‘½åè¡¨</p><pre><code class="sql">alter table è¡¨å rename æ–°è¡¨å;</code></pre><p>æ¸…ç©ºæ•°æ®è¡¨</p><pre><code class="sql">delete from table_name;</code></pre><p>åˆ é™¤æ•°æ®è¡¨</p><pre><code class="sql">drop table table_name;</code></pre><p>åˆ é™¤æ•°æ®åº“</p><pre><code class="sql">drop database dbname;</code></pre><p>é€€å‡º MySQL</p><pre><code class="sql">exit</code></pre><h2 id="SQL-æ‰§è¡Œæµç¨‹"><a href="#SQL-æ‰§è¡Œæµç¨‹" class="headerlink" title="SQL æ‰§è¡Œæµç¨‹"></a>SQL æ‰§è¡Œæµç¨‹</h2><ol><li>å½“å®¢æˆ·ç«¯è¿æ¥åˆ°MySQLæœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨å¯¹å…¶è¿›è¡Œè®¤è¯ã€‚å¯ä»¥é€šè¿‡ç”¨æˆ·åä¸å¯†ç è®¤è¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡SSLè¯ä¹¦è¿›è¡Œè®¤è¯ã€‚ç™»å½•è®¤è¯åï¼ŒæœåŠ¡å™¨è¿˜ä¼šéªŒè¯å®¢æˆ·ç«¯æ˜¯å¦æœ‰æ‰§è¡ŒæŸä¸ªæŸ¥è¯¢çš„æ“ä½œæƒé™ã€‚</li><li>åœ¨æ­£å¼æŸ¥è¯¢ä¹‹å‰ï¼ŒæœåŠ¡å™¨ä¼šæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœèƒ½æ‰¾åˆ°å¯¹åº”çš„æŸ¥è¯¢ï¼Œåˆ™ä¸å¿…è¿›è¡ŒæŸ¥è¯¢è§£æï¼Œä¼˜åŒ–ï¼Œæ‰§è¡Œç­‰è¿‡ç¨‹ï¼Œç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„ç»“æœé›†ã€‚</li><li>MySQLçš„è§£æå™¨ä¼šæ ¹æ®æŸ¥è¯¢è¯­å¥ï¼Œæ„é€ å‡ºä¸€ä¸ªè§£ææ ‘ï¼Œä¸»è¦ç”¨äºæ ¹æ®è¯­æ³•è§„åˆ™æ¥éªŒè¯è¯­å¥æ˜¯å¦æ­£ç¡®ï¼Œæ¯”å¦‚SQLçš„å…³é”®å­—æ˜¯å¦æ­£ç¡®ï¼Œå…³é”®å­—çš„é¡ºåºæ˜¯å¦æ­£ç¡®ã€‚è€Œé¢„å¤„ç†å™¨ä¸»è¦æ˜¯è¿›ä¸€æ­¥æ ¡éªŒï¼Œæ¯”å¦‚è¡¨åï¼Œå­—æ®µåæ˜¯å¦æ­£ç¡®ç­‰</li><li>æŸ¥è¯¢ä¼˜åŒ–å™¨å°†è§£ææ ‘è½¬åŒ–ä¸ºæŸ¥è¯¢è®¡åˆ’ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€æ¡æŸ¥è¯¢å¯ä»¥æœ‰å¾ˆå¤šç§æ‰§è¡Œæ–¹å¼ï¼Œæœ€ç»ˆè¿”å›ç›¸åŒçš„ç»“æœï¼Œä¼˜åŒ–å™¨å°±æ˜¯æ ¹æ®æˆæœ¬æ‰¾åˆ°è¿™å…¶ä¸­æœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’</li><li>æ‰§è¡Œè®¡åˆ’è°ƒç”¨æŸ¥è¯¢æ‰§è¡Œå¼•æ“ï¼Œè€ŒæŸ¥è¯¢å¼•æ“é€šè¿‡ä¸€ç³»åˆ—APIæ¥å£æŸ¥è¯¢åˆ°æ•°æ®</li><li>å¾—åˆ°æ•°æ®ä¹‹åï¼Œåœ¨è¿”å›ç»™å®¢æˆ·ç«¯çš„åŒæ—¶ï¼Œä¼šå°†æ•°æ®å­˜åœ¨æŸ¥è¯¢ç¼“å­˜ä¸­</li></ol><h2 id="ä½¿ç”¨-MySQL"><a href="#ä½¿ç”¨-MySQL" class="headerlink" title="ä½¿ç”¨ MySQL"></a>ä½¿ç”¨ MySQL</h2><p>ä½¿ç”¨ DataGrip é“¾æ¥ MySQL</p><p><img src="/images/mysql-datagrip.jpg" alt="folder"></p><p>åœ¨ Egg.js ä¸­ä½¿ç”¨ MySQL æ•°æ®åº“</p><pre><code class="js">module.exports = () =&gt; {  return {    sequelize: {      dialect: &#39;mysql&#39;,      database: &#39;database-name&#39;,      host: &#39;127.0.0.1&#39;,      port: &#39;3306&#39;,      username: &#39;root&#39;,      password: &#39;my-secret-pw&#39;,      pool: {        max: 8, // æœ€å¤§è¿æ¥æ•°        min: 0, // æœ€å°è¿æ¥æ•°        idle: 10000, // connectioné‡Šæ”¾å‰çš„æœ€å¤§ç©ºé—²æ—¶é—´      },      timezone: &#39;+08:00&#39;,    },  };};</code></pre><h2 id="MySQL-ç´¢å¼•"><a href="#MySQL-ç´¢å¼•" class="headerlink" title="MySQL ç´¢å¼•"></a>MySQL ç´¢å¼•</h2><p>MySQL å®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚æ˜¯é’ˆå¯¹è¡¨è€Œå»ºç«‹çš„ï¼Œå®ƒæ˜¯ç”±æ•°æ®é¡µé¢ä»¥å¤–çš„ç´¢å¼•é¡µé¢ç»„æˆï¼Œæ¯ä¸ªç´¢å¼•é¡µä¸­çš„è¡Œéƒ½å«æœ‰é€»è¾‘æŒ‡é’ˆï¼Œä»¥ä¾¿åŠ é€Ÿæ£€ç´¢ç‰©ç†æ•°æ®ï¼Œåˆ›å»ºç´¢å¼•çš„ç›®çš„åœ¨äºæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>MyISAM</p><p>MyISAM å¼•æ“ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ã€‚MyISAM ä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸ºé¦–å…ˆæŒ‰ç…§ B+Tree æœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„ Key å­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶ data åŸŸçš„å€¼ï¼Œç„¶åä»¥ data åŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚MyISAMçš„ç´¢å¼•æ–¹å¼ä¹Ÿå«åšâ€œéèšé›†â€çš„ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç§°å‘¼æ˜¯ä¸ºäº†ä¸InnoDBçš„èšé›†ç´¢å¼•åŒºåˆ†ã€‚</p><p>InnoDB</p><p>åœ¨ InnoDB ä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œè¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚InnoDB çš„è¾…åŠ©ç´¢å¼• data åŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚</p><p>åˆ›å»ºä½¿ç”¨ç´¢å¼•çš„åŸåˆ™</p><p>1ã€ç´¢å¼•å°½é‡å°‘ï¼Œç´¢å¼•è¿‡å¤šï¼Œå½±å“å†™é€Ÿåº¦<br>2ã€å»ºç«‹ç´¢å¼•å°½é‡æ»¡è¶³å·¦åŒ¹é…ï¼Œç´¢å¼•åªèƒ½å‘½ä¸­æœ€å·¦è¾¹çš„èŒƒå›´æŸ¥è¯¢ï¼Œæ¯”å¦‚å­˜åœ¨ç´¢å¼•idx_a_b_c_d, æŸ¥è¯¢å¦‚select * from table where a=1 and b=2 and c&gt;3 and d&lt;4ï¼Œåˆ™åªèƒ½ç”¨åˆ°a,b,c<br>3ã€ä½¿ç”¨explainæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œéœ€æ±‚æ‰€æœ‰çš„æŸ¥è¯¢è‡³å°‘åˆ°è¾¾rangeçº§åˆ«<br>4ã€åŒºåˆ†åº¦ä¸é«˜çš„å­—æ®µä¸å»ºç´¢å¼•ï¼Œæ¯”å¦‚æ€§åˆ«ï¼Œåªæœ‰ç”·å’Œå¥³ï¼Œè¿™ç§å­—æ®µä¸éœ€è¦å»ºç´¢å¼•<br>5ã€è¡¨å¿…é¡»æœ‰ä¸»é”®ç´¢å¼•ï¼ŒPRIMARY KEY (<code>id</code>)<br>6ã€å»ºç«‹ç´¢å¼•æ—¶ï¼ŒæŠŠåŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨å‰é¢</p><h2 id="å»ºè¡¨ä¸‰èŒƒå¼"><a href="#å»ºè¡¨ä¸‰èŒƒå¼" class="headerlink" title="å»ºè¡¨ä¸‰èŒƒå¼"></a>å»ºè¡¨ä¸‰èŒƒå¼</h2><ol><li>è¦æ±‚æœ‰ä¸»é”®ï¼Œå¹¶ä¸”è¦æ±‚æ¯ä¸€ä¸ªå­—æ®µåŸå­æ€§ä¸å¯å†åˆ†</li><li>ç¬¬ä¸€èŒƒå¼åŸºç¡€ä¸Šï¼Œè¦æ±‚æ‰€æœ‰éä¸»é”®å­—æ®µå®Œå…¨ä¾èµ–ä¸»é”®ï¼Œä¸èƒ½äº§ç”Ÿéƒ¨åˆ†ä¾èµ–</li><li>åœ¨ç¬¬äºŒèŒƒå¼åŸºç¡€ä¸Šï¼Œæ‰€æœ‰éä¸»é”®å­—æ®µå’Œä¸»é”®å­—æ®µä¹‹é—´ä¸èƒ½äº§ç”Ÿä¼ é€’ä¾èµ–</li></ol><h2 id="å»ºè¡¨è§„èŒƒ"><a href="#å»ºè¡¨è§„èŒƒ" class="headerlink" title="å»ºè¡¨è§„èŒƒ"></a>å»ºè¡¨è§„èŒƒ</h2><p>å‘½åè§„èŒƒ</p><ul><li>è¡¨åä¸ä½¿ç”¨å¤æ•°åè¯</li><li>åº“åã€è¡¨åã€å­—æ®µåä½¿ç”¨å°å†™å­—æ¯ï¼Œä¸‹åˆ’çº¿ â€œ_â€ åˆ†å‰²</li><li>åº“åã€è¡¨åã€å­—æ®µåä¸è¶…è¿‡ 12 ä¸ªå­—ç¬¦</li><li>è¡¨åä¸ä½¿ç”¨å¤æ•°åè¯</li><li>åº“åã€è¡¨åã€å­—æ®µåè§åçŸ¥æ„, å°½é‡ä½¿ç”¨åè¯ä¸æ˜¯åŠ¨è¯</li><li>ä¸ä½¿ç”¨æ•°æ®åº“ä¿ç•™å­—æ¯”å¦‚ï¼škeyï¼Œdescï¼Œdeleteï¼Œorderâ€¦â€¦</li><li>è¡¨çš„å‘½åä½¿ç”¨ â€œç»Ÿä¸€å‰ç¼€_ä¸šåŠ¡åç§°_è¡¨çš„ä½œç”¨â€ æ¨¡å¼ï¼Œå¦‚ï¼štb_plan, tb_task, tb_target</li></ul><p>è®¾è®¡è§„èŒƒ</p><ul><li>ä½¿ç”¨å¸ƒå°”å€¼ç±»å‹å­˜å‚¨æ˜¯/å¦ç±»å­—æ®µ</li><li>ç¦æ­¢åœ¨è¡¨ä¸­å»ºç«‹é¢„ç•™å­—æ®µ</li><li>æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€æ·»åŠ æ³¨é‡Š</li><li>ç¦æ­¢åœ¨æ•°æ®åº“å­˜å‚¨å›¾ç‰‡ã€æ–‡ä»¶ç­‰äºŒè¿›åˆ¶æ•°æ®</li><li>å­˜å‚¨å¼•æ“é€‰æ‹© InnoDBï¼Œè¡¨å­—ç¬¦é›†é€‰æ‹© utf8mb4</li><li>å°†å¤§å­—æ®µæ‹†åˆ†å€¼å…¶ä»–è¡¨ä¸­</li><li>å­—æ®µå°å†™å‘½åï¼Œç¦æ­¢å‡ºç°å¤§å†™</li><li>å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º NOT NULLï¼Œå› ä¸º NULL åœ¨ MySQL ä¸­å¾—ç‰¹æ®Šå¤„ç†ã€å¾ˆéš¾ä¼˜åŒ–</li><li>ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°æ•°æ®ç±»å‹</li><li>å¯¹äºéè´Ÿæ•´æ•°ï¼Œä¼˜å…ˆä½¿ç”¨æ— ç¬¦å·æ•´å‹å­˜å‚¨ï¼ˆidï¼‰</li><li>é¿å…ä½¿ç”¨ TEXTã€BLOB æ•°æ®ç±»å‹ï¼Œéç”¨ä¸å¯çš„æƒ…å†µï¼Œå¯ä»¥æŠŠ BLOB å’Œ TEXT æ‹†åˆ†åˆ°å•ç‹¬çš„æ‹“å±•è¡¨ä¸­</li><li>ä½¿ç”¨ TIMESTAMP æˆ– DATETIME ç±»å‹å­˜å‚¨æ—¶é—´<ul><li>TIMESTAMPï¼ˆ4BYTEï¼‰1970-01-01 00:00:01 - 2038-01-19 03:14:07</li><li>DATETIMEï¼ˆ8BYTEï¼‰1000-01-01 00:00:00â€™ - 9999-12-31 23:59:59</li></ul></li><li>ç”¨ decimal æ¥å­˜å‚¨é‡‘é¢å­—æ®µï¼Œä¸è¦ç”¨ float å’Œ doubleï¼Œä¼šå‡ºç°æ•°æ®ç²¾åº¦ä¸¢å¤±</li><li>ä½¿ç”¨ INT UNSIGNED å­˜å‚¨ IPï¼ŒIP è½¬æ•°å­—å‡½æ•° inet_aton()ã€æ•°å­—è½¬ IP å‡½æ•° inet_ntoa()</li><li>VARCHAR(N) ä¸­çš„ N è¡¨ç¤ºå­—ç¬¦æ•°(ä¸æ˜¯å­—èŠ‚æ•°ã€æ¯”å¦‚ VARCHAR(N) èƒ½å­˜å‚¨ N ä¸ªæ±‰å­—)ã€æ»¡è¶³éœ€æ±‚çš„æƒ…å†µä¸‹ N è¶Šå°è¶Šå¥½ã€æœ€å¤§é•¿åº¦65535ä¸ªå­—èŠ‚</li><li>å¯¹äºå®šé•¿çš„å­—ç¬¦ç±»å‹ã€æ¯”å¦‚å¯†ç  MD5 å€¼ç­‰ã€å»ºè®®ç”¨ char ç±»å‹ï¼Œæ•ˆç‡å¯ä»¥å¾—åˆ°æå‡</li></ul><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><ul><li>Optimize Your Queries For the Query Cache</li><li>EXPLAIN Your SELECT Queries</li><li>LIMIT 1 When Getting a Unique Row</li><li>Index the Search Fields</li><li>Index and Use Same Column Types for Joins</li><li>Avoid SELECT *</li><li>Almost Always Have an id Field</li><li>Use ENUM over VARCHAR</li><li>Get Suggestions with PROCEDURE ANALYSE()</li><li>Use NOT NULL If You Can</li><li>Prepared Statements</li><li>Unbuffered Queries</li><li>Fixed-length(Static) Tables are Faster</li><li>Vertical Partitioning</li><li>Split the Big DELETE or INSERT Queries</li><li>Smaller Columns Are Faster</li><li>Choose the Right Storage Engine</li><li>Use an Object Relational Mapper</li><li>åœ¨ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„éœ€è¦ï¼Œè¯·æ°¸è¿œä½¿ç”¨ä¸€ä¸ªä¸ä¸šåŠ¡æ— å…³çš„è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®ã€‚</li><li>ç¦æ­¢ä»å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒç›´è¿ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noopener">MySQL æ•™ç¨‹</a></p><p><a href="https://www.kancloud.cn/xuying/sql/269824" target="_blank" rel="noopener">æ•°æ®åº“ç»éªŒå°ç»“</a></p><p><a href="https://github.com/jaywcjlove/mysql-tutorial/blob/master/21-minutes-MySQL-basic-entry.md" target="_blank" rel="noopener">21åˆ†é’ŸMySQLåŸºç¡€å…¥é—¨</a></p><p><a href="https://www.jianshu.com/p/3e97c2a1687b" target="_blank" rel="noopener">MySqlâ€“æ•°æ®åº“è®¾è®¡ä¸‰èŒƒå¼</a></p><p><a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html" target="_blank" rel="noopener">MySQLç´¢å¼•èƒŒåçš„æ•°æ®ç»“æ„åŠç®—æ³•åŸç†</a></p><p><a href="https://www.cnblogs.com/enein/archive/2012/11/29/2794896.html" target="_blank" rel="noopener">Top 20+ MySQL Best Practices(20æ¡MySQLæœ€ä½³å®è·µ)</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://images.unsplash.com/photo-1489875347897-49f64b51c1f8?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=2250&amp;q=80&quot; alt=&quot;mysql&quot;&gt;&lt;/p&gt;&lt;p&gt;å·¥ä½œéœ€æ±‚å­¦ä¹ ä¸€ä¸‹ MySQL æ•°æ®åº“&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="MySQL" scheme="https://coldstone.fun/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Codemagic æŒç»­éƒ¨ç½² Flutter åº”ç”¨</title>
    <link href="https://coldstone.fun/post/2020/02/03/flutter-cicd/"/>
    <id>https://coldstone.fun/post/2020/02/03/flutter-cicd/</id>
    <published>2020-02-03T14:36:16.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<img src="https://blog.codemagic.io/uploads/2019/01/FB-build-test-publish-100.fdfb1baaca70728207ad87f5a7e36350d8c8e0693eff9616cc6758134c5542e0.jpg" alt="Codemagic" width="672"><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²èƒ½å¤Ÿè‡ªåŠ¨åŒ–åº”ç”¨å¼€å‘çš„æµ‹è¯•ï¼Œæ„å»ºå’Œéƒ¨ç½²è¿‡ç¨‹ï¼Œå¦‚æœåœ¨åº”ç”¨å¼€å‘åˆæœŸè§£å†³äº†è¿™ä¸ªé—®é¢˜æ— ç–‘æå‡åº”ç”¨çš„å¼€å‘ï¼Œäº¤ä»˜æ•ˆç‡ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Codemagic"><a href="#ä»€ä¹ˆæ˜¯-Codemagic" class="headerlink" title="ä»€ä¹ˆæ˜¯ Codemagic"></a>ä»€ä¹ˆæ˜¯ <code>Codemagic</code></h2><p><a href="https://codemagic.io" target="_blank" rel="noopener">Codemagic</a> æ˜¯ä¸€ä¸ªä¸º <code>Flutter</code> é¡¹ç›®ä»¥åŠå…¶å®ƒç§»åŠ¨ç«¯é¡¹ç›®æä¾› CI/CD æœåŠ¡çš„å¹³å°ã€‚</p><p>å¯ä»¥ä½¿ç”¨ Github è´¦å·æ³¨å†Œç™»å½•ï¼Œç™»å½•åå®ƒä¼šè¦æ±‚è·å¾—ä½ ä»“åº“çš„è¯»/å†™æƒé™ï¼Œç„¶ååœ¨ <a href="https://codemagic.io/apps" target="_blank" rel="noopener">apps</a> é¡µé¢æ˜¾ç¤ºä½ éœ€è¦è¿›è¡Œæ„å»ºçš„é¡¹ç›®ã€‚</p><p><img src="./images/code-apps.jpg" alt="code-apps"></p><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-Codemagic"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-Codemagic" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ Codemagic"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ <code>Codemagic</code></h2><p>å¥½çš„ <code>CI/CD</code> æœ‰åŠ©äºæ›´å¿«åœ°æ„å»ºï¼Œæµ‹è¯•ä»¥åŠéƒ¨ç½²å‘å¸ƒåº”ç”¨ã€‚åœ¨ <code>Flutter</code> çš„å®˜æ–¹æ–‡æ¡£ <a href="https://flutter.cn/docs/deployment/cd" target="_blank" rel="noopener">Flutter é‡Œçš„æŒç»­éƒ¨ç½²</a> é‡Œä»‹ç»äº†ä½¿ç”¨ <code>fastlane</code> å·¥å…·è¿›è¡Œæœ¬åœ°éƒ¨ç½²ä»¥åŠå¦‚ä½•å°† <code>fastlane</code> æ•´åˆåˆ° <code>Travis</code>ï¼Œ<code>Cirrus</code>ï¼Œ<code>Bitrise</code> ç­‰æŒç»­äº¤ä»˜çš„æœåŠ¡ä¸­ï¼Œä½†æ˜¯å¯¹äº <code>Flutter</code> é¡¹ç›®æ¥è¯´æœ€æ–¹ä¾¿çš„ <code>CI/CD</code> æœåŠ¡åº”è¯¥è¿˜æ˜¯ <code>Codemagic</code>ï¼Œå®ƒå¯ä»¥ç›´æ¥åœ¨ç½‘é¡µä¸Šå°±é…ç½®å‡ºå®Œæ•´çš„åº”ç”¨äº¤ä»˜æµç¨‹ã€‚</p><h2 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h2><p>é€‰æ‹©éœ€è¦æ„å»ºçš„ <code>Fluter</code> é¡¹ç›®ï¼Œç‚¹å‡» <code>Start your first build</code> æŒ‰é’®ï¼Œåˆ›å»ºä¸€ä¸ªå·¥ä½œæµç¨‹ <code>Workflow</code>ã€‚<br>ä¸€ä¸ª <code>Workflow</code> æŒ‡çš„æ˜¯æ¯æ¬¡æ„å»ºè¦åšçš„ä»»åŠ¡ï¼Œå¦‚æ‰§è¡Œæ„å»ºï¼Œæµ‹è¯•ä»¥åŠå‘å¸ƒä»»åŠ¡ã€‚</p><p>å¯¹äº <code>Flutter</code> é¡¹ç›®å¯ä»¥åœ¨ç½‘é¡µä¸Šé…ç½®æˆ–ä½¿ç”¨ <code>codemagic.yaml</code> é…ç½®æ–‡ä»¶ï¼Œå…¶å®ƒé¡¹ç›®åªèƒ½ä½¿ç”¨ <code>codemagic.yaml</code> é…ç½®ã€‚</p><p><img src="./images/workflow.jpg" alt="workflow"></p><p>ä¸€ä¸ª <code>Workflow</code> ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆ</p><ol><li><code>Build triggers</code> â€“&gt; æŒ‡å®šçš„æ„å»ºåˆ†æ”¯å’Œè§¦å‘æ„å»ºçš„æ—¶æœº</li></ol><p><img src="./images/build-triggers.jpg" alt="build-triggers"></p><ol start="2"><li><code>Environment variables</code> â€“&gt; è®¾ç½®æ„å»ºæ—¶çš„ç¯å¢ƒå˜é‡</li></ol><p><img src="https://docs.codemagic.io/uploads/env_vars.PNG" alt="env_vars"></p><ol start="3"><li><code>Dependency caching</code> â€“&gt; è®¾ç½®æ„å»ºæ—¶çš„ä¾èµ–ç¼“å­˜æ–‡ä»¶ç›®å½•ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦</li></ol><p><img src="https://docs.codemagic.io/uploads/2019/04/caching_enabled.PNG" alt="caching"></p><ol start="4"><li><code>Test</code> â€“&gt; æ‰§è¡Œåº”ç”¨çš„å•å…ƒï¼Œé›†æˆå’Œéƒ¨ä»¶æµ‹è¯•ï¼Œä»¥åŠé™æ€ä»£ç åˆ†æ</li></ol><p><img src="./images/code-test.jpg" alt="code-test"></p><ol start="5"><li><code>Build</code> â€“&gt; é…ç½®åº”ç”¨æ„å»ºæ—¶çš„ Flutter ç‰ˆæœ¬ï¼Œæ„å»ºç›®æ ‡ï¼Œæ„å»ºå‚æ•°</li></ol><p><img src="./images/code-build.jpg" alt="code-build"></p><ol start="6"><li><code>Publish</code> â€“&gt; é€‰æ‹©éœ€è¦å‘å¸ƒåº”ç”¨çš„ç›®æ ‡ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº† <code>Google play</code></li></ol><p><img src="./images/code-publish.jpg" alt="code-publish"></p><h2 id="ä»£ç ç­¾å"><a href="#ä»£ç ç­¾å" class="headerlink" title="ä»£ç ç­¾å"></a>ä»£ç ç­¾å</h2><p>è¦å°†åº”ç”¨å‘å¸ƒåˆ° <code>Apple store</code> æˆ–è€… <code>Goople play</code> ä¸Šå°±å¿…é¡»å¯¹ä½ çš„åº”ç”¨è¿›è¡Œä»£ç ç­¾åï¼Œä»£ç ç­¾åç›®çš„æ˜¯ä¸ºäº†è¯†åˆ«è°å¼€å‘äº†è¯¥åº”ç”¨ç¨‹åºï¼Œå¹¶ç¡®ä¿è¯¥åº”ç”¨ç¨‹åºçš„æ‰€æœ‰æ›´æ–°å‡æ¥è‡ªè¿™ä¸ªäººã€‚</p><p>å¯¹äº Android æ¥è¯´æœ‰ä¸¤ç§ç­¾åï¼šå‘å¸ƒç­¾åå’Œä¸Šä¼ ç­¾åã€‚æœ€ç»ˆç”¨æˆ·ä¸‹è½½çš„ <code>.aab/.apk</code> æ–‡ä»¶ä½¿ç”¨å‘å¸ƒç­¾åã€‚ä¸Šä¼ ç­¾åæä¾›ç»™å¼€å‘è€…ä¸Šä¼ åˆ° <code>Google Play</code> å•†åº—çš„è®¤è¯ã€‚ä¸Šä¼ åï¼Œ<code>Google Play</code> ä¼šé‡æ–°ä½¿ç”¨å‘å¸ƒç­¾åå¯¹ <code>.aab/.apk</code> æ–‡ä»¶ç­¾åã€‚</p><p>åœ¨é…ç½® <code>Workflow</code> æ—¶ï¼Œæˆ‘é€‰æ‹©å‘å¸ƒåˆ° <code>Goople play</code> æ‰€ä»¥éœ€è¦å¯¹ Android åº”ç”¨è¿›è¡Œä»£ç ç­¾åï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼è¿›è¡Œç­¾åï¼Œé€‰æ‹©å…¶ä¸€å³å¯ã€‚</p><ol><li>ä½¿ç”¨ <code>Android Studio</code> <a href="https://developer.android.google.cn/studio/publish/app-signing#sign-apk" target="_blank" rel="noopener">ä¸ºæ‚¨çš„åº”ç”¨ç­¾å</a></li><li>ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œç­¾å <a href="https://flutter.cn/docs/deployment/android#signing-the-app" target="_blank" rel="noopener">ä¸º app ç­¾å</a></li></ol><p>ç­¾ååéœ€è¦åšçš„æ˜¯æŠŠç­¾åä¿¡æ¯å­˜åˆ°å·¥ä½œæµç¨‹ <code>Workflow</code> å†…ï¼Œ<a href="https://docs.codemagic.io/code-signing/android-code-signing/" target="_blank" rel="noopener">Android code signing</a>ã€‚</p><h2 id="åˆ›å»º-Service-Account"><a href="#åˆ›å»º-Service-Account" class="headerlink" title="åˆ›å»º Service Account"></a>åˆ›å»º <code>Service Account</code></h2><p><code>Service Account</code> æ˜¯ç»™ <code>CI/CD</code> å¹³å°å‘å¸ƒæ„å»ºååº”ç”¨ç”¨çš„ï¼Œæ ¹æ®æŒ‡å¼•åˆ›å»º <a href="https://docs.codemagic.io/publishing/publishing-to-google-play/#setting-up-a-service-account-in-google-play-console" target="_blank" rel="noopener">Setting up a service account in Google Play Console</a>ï¼Œåˆ›å»ºåéœ€åšçš„ä¸Šä¼ ä½ çš„å‡­è¯ JSON æ–‡ä»¶</p><p><img src="./images/code-google-play.jpg" alt="code-google-play"></p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><ol><li>åœ¨ä½¿ç”¨ <code>CI/CD</code> æœåŠ¡å‰é¦–å…ˆè¦äººå·¥çš„ä¸Šä¼ åº”ç”¨åˆ° <code>Google Play</code> ä¸€æ¬¡ã€‚</li><li>æ¯æ¬¡ä¸Šä¼ åˆ° <code>Google Play</code> çš„åº”ç”¨æ„å»ºç‰ˆæœ¬ä¸èƒ½é‡å¤ï¼Œå¦åˆ™ä¼šé‡åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜</li></ol><pre><code class="sh">Google Play responded with: APK specifies a version code that has already been used.</code></pre><p>æœç´¢ä¸€ç•ªåå‘ç°é—®é¢˜æ˜¯åº”ç”¨æ„å»ºçš„ç‰ˆæœ¬å·é‡å¤ï¼Œéœ€è¦æ›´æ–° <code>pubspec.yaml</code> æ–‡ä»¶çš„ <code>version</code> å­—æ®µçš„å€¼ï¼Œè¯¦ç»†è¯´æ˜å¯ä»¥æŸ¥é˜…è¿™ç¯‡æ–‡ç«  <a href="https://flutter.cn/docs/deployment/android#updating-the-apps-version-number" target="_blank" rel="noopener">æ›´æ–°åº”ç”¨ç‰ˆæœ¬å·</a></p><ol start="3"><li>ä¸Šä¼  <code>Google Play</code> éœ€è¦æ·»åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡ <code>FCI_KEYSTORE_FILE</code>ï¼Œè¿™ä¸ªå˜é‡éœ€è¦ç”¨ base64 encode ä¸€ä¸‹ï¼Œéœ€è¦ç”¨åˆ°çš„å‘½ä»¤æ˜¯<pre><code class="sh">base64 input-file-path -o output.txt</code></pre></li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä½¿ç”¨ <code>Codemagic</code> å‘å¸ƒ Flutter åº”ç”¨çš„æµç¨‹å¤§è‡´å¦‚ä¸‹</p><ol><li>é€‰æ‹©æ„å»ºé¡¹ç›®</li><li>é…ç½®æ„å»ºæµç¨‹</li><li>è¿›è¡Œä»£ç ç­¾å</li><li>åˆ›å»º Service Account</li><li>è§¦å‘æ„å»º</li></ol><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://flutter.cn/docs/deployment/cd" target="_blank" rel="noopener">Flutter é‡Œçš„æŒç»­éƒ¨ç½²</a></p><p><a href="https://docs.codemagic.io/" target="_blank" rel="noopener">Codemagic Documentation</a></p>]]></content>
    
    <summary type="html">
    
      &lt;img src=&quot;https://blog.codemagic.io/uploads/2019/01/FB-build-test-publish-100.fdfb1baaca70728207ad87f5a7e36350d8c8e0693eff9616cc6758134c5542e0.jpg&quot; alt=&quot;Codemagic&quot; width=&quot;672&quot;&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
      <category term="Codemagic" scheme="https://coldstone.fun/tags/Codemagic/"/>
    
      <category term="Google Play" scheme="https://coldstone.fun/tags/Google-Play/"/>
    
  </entry>
  
  <entry>
    <title>ä¸º Flutter åº”ç”¨æ·»åŠ æœç´¢åŠŸèƒ½</title>
    <link href="https://coldstone.fun/post/2020/01/26/flutter-show-search/"/>
    <id>https://coldstone.fun/post/2020/01/26/flutter-show-search/</id>
    <published>2020-01-26T09:34:54.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<img src="images/flutter_show_search.png" height="320" style="height:340px;object-fit:cover"><p>ä½¿ç”¨ <code>SearchDelegate</code> ç»™ Flutter åº”ç”¨æ·»åŠ æœç´¢åŠŸèƒ½</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>SearchDelegate</code> æ˜¯ Flutter æ¡†æ¶æä¾›çš„ä¸€ä¸ªå®ç°æœç´¢åŠŸèƒ½çš„ç±»ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿå®ç°æœç´¢åŠŸèƒ½ï¼Œæœ¬æ–‡è¯´æ˜å¦‚ä½•ä½¿ç”¨å®ƒæ¥å®ç°æœç´¢åŠŸèƒ½ã€‚</p><p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹</p><div><video src="videos/show_search.mov" controls width="240" autoplay muted loop></div><p>åˆ›å»ºæ–°é¡¹ç›®ï¼Œåˆå§‹åŒ–ä»£ç å¦‚ä¸‹</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;void main() {  runApp(MyApp());}class MyApp extends StatelessWidget {  @override  Widget build(BuildContext context) {    return MaterialApp(      title: &#39;Search App&#39;,      home: HomePage(),    );  }}class HomePage extends StatelessWidget {  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        title: Text(&#39;Search App&#39;),      ),    );  }}</code></pre><h2 id="æ˜¾ç¤ºæœç´¢é¡µé¢"><a href="#æ˜¾ç¤ºæœç´¢é¡µé¢" class="headerlink" title="æ˜¾ç¤ºæœç´¢é¡µé¢"></a>æ˜¾ç¤ºæœç´¢é¡µé¢</h2><p><code>showSearch</code> æ–¹æ³•æ˜¯ Flutter é‡Œç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªæœç´¢é¡µé¢çš„æ–¹æ³•ï¼Œè¿™ä¸ªé¡µé¢ç”±ä¸€ä¸ªå¸¦æœ‰æœç´¢æ¡†çš„ <code>AppBar</code> å’Œæ˜¾ç¤ºæœç´¢å»ºè®®æˆ–æœç´¢ç»“æœçš„ <code>body</code> ç»„æˆã€‚å®ƒæœ‰ä¸¤ä¸ªå¿…è¦å‚æ•° <code>context</code> å’Œ <code>delegate</code>ï¼Œ<code>context</code> å³ä¸ºå½“å‰çš„åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œ<code>delegate</code> æ˜¯ä¸€ä¸ªå®ç°äº† <code>SearchDelegate</code> æŠ½è±¡ç±»è‡ªå®šä¹‰çš„éƒ¨ä»¶ï¼Œè¿™ä¸ªè‡ªå®šä¹‰éƒ¨ä»¶å®šä¹‰äº†å¦‚ä½•æ˜¾ç¤ºæœç´¢é¡µé¢ï¼Œå…³é—­æœç´¢é¡µé¢æ—¶è¿”å›ç”¨æˆ·é€‰æ‹©çš„æœç´¢ç»“æœã€‚</p><p>åœ¨ <code>AppBar</code> çš„ <code>actions</code> æ•°ç»„é‡Œé¢æ·»åŠ ä¸€ä¸ª <code>IconButton</code>ï¼ŒæŒ‰ä¸‹æ—¶è°ƒç”¨ <code>showSearch</code> æ–¹æ³•ï¼Œè¿›å…¥æœç´¢é¡µé¢ã€‚</p><pre><code class="dart">class HomePage extends StatelessWidget {  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        title: Text(&#39;Search App&#39;),        actions: &lt;Widget&gt;[          IconButton(            icon: Icon(Icons.search),            onPressed: () {              showSearch(context: context, delegate: CustomSearchDelegate());            },          )        ],      ),    );  }}</code></pre><p>åˆå§‹åŒ–ä¸€ä¸ªç»§æ‰¿äº† <code>SearchDelegate</code> çš„ <code>CustomSearchDelegate</code>ï¼Œç±»çš„åå­—æ˜¯è‡ªå®šä¹‰çš„ã€‚</p><pre><code class="dart">class CustomSearchDelegate extends SearchDelegate {  @override  List&lt;Widget&gt; buildActions(BuildContext context) {    // TODO: implement buildActions    throw UnimplementedError();  }  @override  Widget buildLeading(BuildContext context) {    // TODO: implement buildLeading    throw UnimplementedError();  }  @override  Widget buildResults(BuildContext context) {    // TODO: implement buildResults    throw UnimplementedError();  }  @override  Widget buildSuggestions(BuildContext context) {    // TODO: implement buildSuggestions    throw UnimplementedError();  }}</code></pre><h2 id="å®ç°-CustomSearchDelegate"><a href="#å®ç°-CustomSearchDelegate" class="headerlink" title="å®ç° CustomSearchDelegate"></a>å®ç° <code>CustomSearchDelegate</code></h2><p>è‡ªå®šä¹‰çš„ <code>CustomSearchDelegate</code> éœ€è¦å®ç°å››ä¸ªæ–¹æ³•</p><ul><li><code>buildLeading</code> æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¹‹å‰çš„éƒ¨ä»¶ï¼Œä¸€èˆ¬æ˜¾ç¤ºè¿”å›å‰ä¸€ä¸ªé¡µé¢ç®­å¤´æŒ‰é’®</li><li><code>buildActions</code> æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¹‹åçš„éƒ¨ä»¶</li><li><code>buildResults</code> æ˜¾ç¤ºæœç´¢ç»“æœ</li><li><code>buildSuggestions</code> æ˜¾ç¤ºæœç´¢å»ºè®®</li></ul><p>å…ˆå®ç° <code>buildActions</code> å’Œ <code>buildLeading</code>ï¼Œ<code>buildActions</code> æ˜¾ç¤ºä¸€ä¸ªæ¸…é™¤æŒ‰é’®ï¼Œå¯ä»¥æŠŠå½“å‰çš„ <code>query</code> æŸ¥è¯¢å‚æ•°æ¸…ç©ºï¼Œå¹¶æ˜¾ç¤ºæœç´¢å»ºè®®ã€‚<code>buildLeading</code> æ˜¾ç¤ºä¸€ä¸ªç®­å¤´çš„æŒ‰é’®ï¼Œä½¿ç”¨ <code>close</code> æ–¹æ³•å…³é—­æœç´¢é¡µé¢ï¼Œ<code>close</code> æ–¹æ³•ç¬¬äºŒä¸ªå‚æ•°æ˜¯é€‰å®šçš„æœç´¢ç»“æœï¼Œå¦‚æœä½¿ç”¨ç³»ç»Ÿåé€€æŒ‰é’®å…³é—­æœç´¢é¡µé¢ï¼Œåˆ™è¿”å› <code>null</code> å€¼ã€‚</p><pre><code class="dart">List&lt;Widget&gt; buildActions(BuildContext context) {  return [    IconButton(      tooltip: &#39;Clear&#39;,      icon: const Icon(Icons.clear),      onPressed: () {        query = &#39;&#39;;        showSuggestions(context);      },    )  ];}@overrideWidget buildLeading(BuildContext context) {  return IconButton(    tooltip: &#39;Back&#39;,    icon: AnimatedIcon(      icon: AnimatedIcons.menu_arrow,      progress: transitionAnimation,    ),    onPressed: () {      close(context, null);    },  );}@overrideWidget buildResults(BuildContext context) {  return ListView();}@overrideWidget buildSuggestions(BuildContext context) {  return ListView();}</code></pre><img src="images/search_01.png" width="240" style="width:240px"><p>ç„¶åå®ç° <code>buildResults</code> å’Œ <code>buildSuggestions</code>ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ç”¨æ¥å±•ç¤ºæœç´¢é¡µé¢å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„éƒ¨æ˜¾ç¤ºï¼Œè¿™é‡Œä½¿ç”¨ <code>ListView</code> éƒ¨ä»¶ã€‚</p><pre><code class="dart">@overrideWidget buildResults(BuildContext context) {  return ListView.builder(    itemCount: Random().nextInt(10),    itemBuilder: (context, index) {      return ListTile(        title: Text(&#39;result $index&#39;),      );    },  );}@overrideWidget buildSuggestions(BuildContext context) {  return ListView(    children: &lt;Widget&gt;[      ListTile(title: Text(&#39;Suggest 01&#39;)),      ListTile(title: Text(&#39;Suggest 02&#39;)),      ListTile(title: Text(&#39;Suggest 03&#39;)),      ListTile(title: Text(&#39;Suggest 04&#39;)),      ListTile(title: Text(&#39;Suggest 05&#39;)),    ],  );}</code></pre><p>æœç´¢ç»“æœ</p><img src="images/search_result.png" width="240" style="width:240px"><p>æœç´¢å»ºè®®</p><img src="images/search_suggestion.png" width="240" style="width:240px"><h2 id="è·å–è¿œç¨‹æ•°æ®"><a href="#è·å–è¿œç¨‹æ•°æ®" class="headerlink" title="è·å–è¿œç¨‹æ•°æ®"></a>è·å–è¿œç¨‹æ•°æ®</h2><p>æœç´¢åŠŸèƒ½ä¸€èˆ¬éœ€è¦è¯·æ±‚åç«¯çš„æœç´¢æ¥å£æ¥è·å–æ•°æ®ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ <code>FutureBuilder</code> éƒ¨ä»¶æ¥è¯·æ±‚æ•°æ®ç„¶åæ¸²æŸ“ç»“æœã€‚é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªè¯·æ±‚æ¥å£çš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª <code>Future</code>ï¼Œç„¶ååœ¨ <code>buildResults</code> æ–¹æ³•ä¸­ä½¿ç”¨ <code>FutureBuilder</code> æ¥å±•ç¤ºç»“æœã€‚</p><p>å…ˆæ·»åŠ  <code>http</code> åŒ…ï¼Œç”¨æ¥å‘é€ http è¯·æ±‚ï¼Œç„¶åå¼•å…¥éœ€è¦çš„ä¾èµ–åŒ…</p><pre><code class="yml">dependencies:  http: &lt;latest_version&gt;</code></pre><pre><code class="dart">import &#39;dart:convert&#39;;import &#39;package:http/http.dart&#39; as http;</code></pre><p>å°†é”®ç›˜è¾“å…¥ç±»å‹è®¾ç½®ä¸ºæ•°å­—ï¼Œå®šä¹‰ä¸€ä¸ª <code>_fetchPosts</code> æ–¹æ³•ç”¨æ¥è·å–è¿œç«¯æ•°æ®ï¼Œåœ¨ <code>buildResults</code> æ–¹æ³•é‡Œä½¿ç”¨ <code>FutureBuilder</code> æ¸²æŸ“æœç´¢ç»“æœã€‚</p><pre><code class="dart">@overrideTextInputType get keyboardType =&gt; TextInputType.number;Future _fetchPosts() async {  http.Response response =      await http.get(&#39;https://jsonplaceholder.typicode.com/posts/$query&#39;);  final data = await json.decode(response.body);  return data;}@overrideWidget buildResults(BuildContext context) {  if (int.tryParse(query) &gt;= 100) {    return Center(child: Text(&#39;è¯·è¾“å…¥å°äº 100 çš„æ•°å­—&#39;));  }  return FutureBuilder(    future: _fetchPosts(),    builder: (context, AsyncSnapshot snapshot) {      if (snapshot.hasData) {        final post = snapshot.data;        return ListTile(          title: Text(post[&#39;title&#39;], maxLines: 1),          subtitle: Text(post[&#39;body&#39;], maxLines: 3),        );      }      return Center(child: CircularProgressIndicator());    },  );}</code></pre><img src="images/search_server.png" width="240" style="width:240px"><p>ä½¿ç”¨ <code>FutureBuilder</code> éƒ¨ä»¶è·å–äº†è¿œç¨‹çš„æ•°æ®ï¼Œä½†æ˜¯é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæœç´¢ç»“æœå¯èƒ½æ˜¯åˆ†é¡µæ˜¾ç¤ºçš„ï¼Œä¸€å¼€å§‹åªè·å–äº†ç¬¬ä¸€é¡µçš„æ•°æ®ï¼Œæƒ³è¿½åŠ ä¸‹ä¸€é¡µæ•°æ®æ—¶éœ€è¦åƒ <code>stateFullWidget</code> é‚£æ ·ä½¿ç”¨ <code>setState</code> æ–¹æ³•æ›´æ–°é¡µé¢ï¼Œä½†æ˜¯åœ¨ <code>SearchDelegate</code> é‡Œæ— æ³•ä½¿ç”¨â€¦æš‚æ—¶æ²¡æƒ³åˆ°è§£å†³æ–¹æ³•ã€‚</p><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><pre><code class="dart">import &#39;dart:convert&#39;;import &#39;package:flutter/material.dart&#39;;import &#39;package:http/http.dart&#39; as http;void main() {  runApp(MyApp());}class MyApp extends StatelessWidget {  @override  Widget build(BuildContext context) {    return MaterialApp(      title: &#39;Search App&#39;,      home: HomePage(),    );  }}class HomePage extends StatelessWidget {  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        title: Text(&#39;Search App&#39;),        actions: &lt;Widget&gt;[          IconButton(            icon: Icon(Icons.search),            onPressed: () {              showSearch(context: context, delegate: CustomSearchDelegate());            },          )        ],      ),    );  }}class CustomSearchDelegate extends SearchDelegate {  @override  List&lt;Widget&gt; buildActions(BuildContext context) {    return [      IconButton(        tooltip: &#39;Clear&#39;,        icon: const Icon(Icons.clear),        onPressed: () {          query = &#39;&#39;;          showSuggestions(context);        },      )    ];  }  @override  Widget buildLeading(BuildContext context) {    return IconButton(      tooltip: &#39;Back&#39;,      icon: AnimatedIcon(        icon: AnimatedIcons.menu_arrow,        progress: transitionAnimation,      ),      onPressed: () {        this.close(context, null);      },    );  }  @override  TextInputType get keyboardType =&gt; TextInputType.number;  Future _fetchPosts() async {    http.Response response =        await http.get(&#39;https://jsonplaceholder.typicode.com/posts/$query&#39;);    final data = await json.decode(response.body);    return data;  }  @override  Widget buildResults(BuildContext context) {    if (int.parse(query) &gt;= 100) {      return Center(child: Text(&#39;è¯·è¾“å…¥å°äº 100 çš„æ•°å­—&#39;));    }    return FutureBuilder(      future: _fetchPosts(),      builder: (context, AsyncSnapshot snapshot) {        if (snapshot.hasData) {          final post = snapshot.data;          return ListTile(            title: Text(post[&#39;title&#39;], maxLines: 1),            subtitle: Text(post[&#39;body&#39;], maxLines: 3),          );        }        return Center(child: CircularProgressIndicator());      },    );  }  @override  Widget buildSuggestions(BuildContext context) {    return ListView(      children: &lt;Widget&gt;[        ListTile(title: Text(&#39;Suggest 01&#39;)),        ListTile(title: Text(&#39;Suggest 02&#39;)),        ListTile(title: Text(&#39;Suggest 03&#39;)),        ListTile(title: Text(&#39;Suggest 04&#39;)),        ListTile(title: Text(&#39;Suggest 05&#39;)),      ],    );  }}</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;img src=&quot;images/flutter_show_search.png&quot; height=&quot;320&quot; style=&quot;height:340px;object-fit:cover&quot;&gt;&lt;p&gt;ä½¿ç”¨ &lt;code&gt;SearchDelegate&lt;/code&gt; ç»™ Flutter åº”ç”¨æ·»åŠ æœç´¢åŠŸèƒ½&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±è¿‡æ¸¡åŠ¨ç”»</title>
    <link href="https://coldstone.fun/post/2019/12/10/flutter-route-transition/"/>
    <id>https://coldstone.fun/post/2019/12/10/flutter-route-transition/</id>
    <published>2019-12-10T08:37:52.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/transition.jpg" alt="flutter-routes"></p><p>Flutter åº”ç”¨è¿›è¡Œè·¯ç”±è·³è½¬çš„æ—¶å€™æœ‰é»˜è®¤çš„è¿‡æ¸¡åŠ¨ç”»ï¼Œä½†æ˜¯è‡ªå®šä¹‰çš„è·³è½¬åŠ¨ç”»ä¼šè®©åº”ç”¨æ›´å…·ç‰¹è‰²</p><a id="more"></a><h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ol><li>ä½¿ç”¨ <code>PageRouteBuilder</code> åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±</li><li>åœ¨ <code>transitionsBuilder</code> æ–¹æ³•é‡Œåˆ›å»ºè¿‡æ¸¡åŠ¨ç”»</li><li>è¿‡æ¸¡åŠ¨ç”»ç¤ºä¾‹</li><li>å®šä¹‰å…¨å±€è·¯ç”±è¿‡æ¸¡åŠ¨ç”»</li><li>å°è£…è‡ªå®šä¹‰è·¯ç”±</li></ol><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ <code>Flutter</code> ä¸­ä½¿ç”¨ <code>Navigator.of(context).push(Route route);</code> æ–¹æ³•è¿›è¡Œè·¯ç”±è·³è½¬æ—¶å°±éœ€è¦ä¼ ä¸€ä¸ª <code>Route</code> å¯¹è±¡ï¼Œé€šå¸¸ä½¿ç”¨ <code>MaterialPageRoute(builder: () {});</code> åˆ›å»ºï¼Œä½¿ç”¨æ—¶ä¼šåœ¨è·¯ç”±è·³è½¬è¿‡ç¨‹ä¸­æ·»åŠ é»˜è®¤çš„è¿‡æ¸¡åŠ¨ç”»ã€‚å½“éœ€è¦è‡ªå®šä¹‰è·¯ç”±è¿‡æ¸¡åŠ¨ç”»æ—¶ï¼Œå°±è¦ä½¿ç”¨ <code>PageRouteBuilder</code>ï¼Œå®ƒæ˜¯ <code>Flutter</code> æä¾›çš„ç”¨æ¥åˆ›å»ºè‡ªå®šä¹‰çš„è·¯ç”±çš„ä¸€ä¸ªç±»ï¼Œå®ä¾‹åŒ–è¿™ä¸ªç±»ä¼šå¾—åˆ°ä¸€ä¸ªè·¯ç”±å¯¹è±¡ <code>Route</code>ï¼Œè¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>Route</code>ã€‚</p><h2 id="PageRouteBuilder"><a href="#PageRouteBuilder" class="headerlink" title="PageRouteBuilder"></a>PageRouteBuilder</h2><p>ä½¿ç”¨ <code>PageRouteBuilder</code> åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±è¿‡æ¸¡åŠ¨ç”»æ—¶éœ€è¦ä¼ å…¥ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œä¸€ä¸ªå¿…è¦å‚æ•° <code>pageBuilder</code>ï¼Œè¿™ä¸ªå‡½æ•°ç”¨æ¥åˆ›å»ºè·³è½¬çš„é¡µé¢ï¼Œå¦ä¸€ä¸ªå‡½æ•° <code>transitionsBuilder</code>ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯å®ç°è¿‡æ¸¡åŠ¨ç”»çš„åœ°æ–¹ã€‚</p><blockquote><p><code>transitionsBuilder</code> çš„ <code>child</code> å‚æ•°æ˜¯ <code>pageBuilder</code> å‡½æ•°è¿”å›çš„ä¸€ä¸ª <code>transitionsBuilder widget</code> éƒ¨ä»¶ï¼Œ <code>pageBuilder</code> æ–¹æ³•ä»…ä¼šåœ¨ç¬¬ä¸€æ¬¡æ„å»ºè·¯ç”±çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œ<code>Flutter</code> èƒ½å¤Ÿè‡ªåŠ¨é¿å…åšé¢å¤–çš„å·¥ä½œï¼Œæ•´ä¸ªè¿‡æ¸¡æœŸé—´ <code>child</code> ä¿å­˜äº†åŒä¸€ä¸ªå®ä¾‹ã€‚</p></blockquote><pre><code class="dart">PageRouteBuilder(  pageBuilder: (      BuildContext context,      Animation&lt;double&gt; animation,      Animation&lt;double&gt; secondaryAnimation,    ) {      return widget;    },    transitionsBuilder: (      BuildContext context,      Animation&lt;double&gt; animation,      Animation&lt;double&gt; secondaryAnimation,      Widget child,    ) {      return child;    },);</code></pre><p>åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±éœ€è¦ç»§æ‰¿ <code>PageRouteBuilder</code>ï¼Œç„¶åå®ç°è‡ªå®šä¹‰è·¯ç”±çš„æ„é€ å‡½æ•°ã€‚</p><pre><code class="dart">// å®šä¹‰class YourRoute extends PageRouteBuilder {  final Widget page;  YourRoute(this.page)      : super(          pageBuilder: (            context,            animation,            secondaryAnimation,          ) {            return page;          },          transitionsBuilder: (            context,            animation,            secondaryAnimation,            child,          ) {            return child;          },        );}// ä½¿ç”¨Navigator.of(context).push(YourRoute(NewPage()));</code></pre><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>ä½¿ç”¨ <code>FirstPage</code> å’Œ <code>SecondPage</code> ä¸¤ä¸ªé¡µé¢å±•ç¤ºæ•ˆæœ</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;void main() =&gt; runApp(MyApp());class MyApp extends StatelessWidget {  @override  Widget build(BuildContext context) {    return MaterialApp(      debugShowCheckedModeBanner: false,      home: FirstPage(),    );  }}class FirstPage extends StatelessWidget {  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        title: Text(&#39;First Page&#39;),        elevation: 0.0,        backgroundColor: Colors.purple,      ),      body: Column(        mainAxisAlignment: MainAxisAlignment.center,        children: &lt;Widget&gt;[          Center(            child: RaisedButton(              onPressed: () {                Navigator.of(context).push(                  MaterialPageRoute(builder: (context) =&gt; SecondPage()),                );              },              child: Text(&#39;Next Page&#39;),            ),          )        ],      ),      backgroundColor: Colors.purple,    );  }}class SecondPage extends StatelessWidget {  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        title: Text(&#39;Second Page&#39;),        elevation: 0.0,        backgroundColor: Colors.deepPurpleAccent,      ),      body: Column(        mainAxisAlignment: MainAxisAlignment.center,        children: &lt;Widget&gt;[          Center(            child: RaisedButton(              onPressed: () {                Navigator.pop(context);              },              child: Text(&#39;Go Back&#39;),            ),          )        ],      ),      backgroundColor: Colors.deepPurpleAccent,    );  }}</code></pre><h3 id="FadeTransition"><a href="#FadeTransition" class="headerlink" title="FadeTransition"></a><code>FadeTransition</code></h3><pre><code class="dart">class FadeRoute extends PageRouteBuilder {  final Widget page;  FadeRoute(this.page)      : super(          pageBuilder: (            context,            animation,            secondaryAnimation,          ) {            return page;          },          transitionsBuilder: (            context,            animation,            secondaryAnimation,            child,          ) {            return FadeTransition(              opacity: animation,              child: child,            );          },        );}</code></pre><div><video src="videos/fade_transition.mov" controls width="320" autoplay muted loop></div><h3 id="ScaleTransition"><a href="#ScaleTransition" class="headerlink" title="ScaleTransition"></a><code>ScaleTransition</code></h3><pre><code class="dart">class ScaleRoute extends PageRouteBuilder {  final Widget page;  ScaleRoute(this.page)      : super(          pageBuilder: (            context,            animation,            secondaryAnimation,          ) {            return page;          },          transitionsBuilder: (            context,            animation,            secondaryAnimation,            child,          ) {            return ScaleTransition(              alignment: Alignment.bottomLeft,              scale: Tween(                begin: 0.0,                end: 1.0,              ).animate(                CurvedAnimation(                  parent: animation,                  curve: Curves.easeInOut,                ),              ),              child: child,            );          },          transitionDuration: Duration(seconds: 1),        );}Navigator.of(context).push(ScaleRoute(SecondPage()));</code></pre><div><video src="videos/scale_transition.mov" controls width="320" autoplay muted loop></div><h3 id="RotationTransition"><a href="#RotationTransition" class="headerlink" title="RotationTransition"></a><code>RotationTransition</code></h3><pre><code class="dart">class RotationRoute extends PageRouteBuilder {  final Widget page;  RotationRoute(this.page)      : super(          pageBuilder: (            context,            animation,            secondaryAnimation,          ) {            return page;          },          transitionsBuilder: (            context,            animation,            secondaryAnimation,            child,          ) {            Animation myAnimation = CurvedAnimation(              parent: animation,              curve: Curves.easeInBack,            );            return RotationTransition(              turns: myAnimation,              child: child,            );          },          transitionDuration: Duration(seconds: 1),        );}Navigator.of(context).push(RotationRoute(SecondPage()));</code></pre><div><video src="videos/rotation_transition.mov" controls width="320" autoplay muted loop></div><h3 id="ScaleRotationRoute"><a href="#ScaleRotationRoute" class="headerlink" title="ScaleRotationRoute"></a><code>ScaleRotationRoute</code></h3><p>ç»“åˆä¸¤ä¸ªè¿‡æ¸¡åŠ¨ç”»</p><pre><code class="dart">class ScaleRotationRoute extends PageRouteBuilder {  final Widget page;  ScaleRotationRoute(this.page)      : super(          pageBuilder: (            context,            animation,            secondaryAnimation,          ) {            return page;          },          transitionsBuilder: (            context,            animation,            secondaryAnimation,            child,          ) {            return ScaleTransition(              scale: animation,              child: RotationTransition(                turns: Tween(                  begin: 0.0,                  end: 1.0,                ).animate(                  CurvedAnimation(parent: animation, curve: Curves.linear),                ),                child: child,              ),            );          },          transitionDuration: Duration(milliseconds: 800),        );}Navigator.of(context).push(ScaleRotationRoute(SecondPage()));</code></pre><div><video src="videos/scale_rotation_transition.mov" controls width="320" autoplay muted loop></div><h3 id="TransformRoute"><a href="#TransformRoute" class="headerlink" title="TransformRoute"></a><code>TransformRoute</code></h3><p>ä½¿ç”¨ <code>Transform</code> éƒ¨ä»¶åˆ›é€  <code>3D</code> æ•ˆæœ</p><pre><code class="dart">import &#39;dart:math&#39; show pi;class TransformRoute extends PageRouteBuilder {  final Widget page;  TransformRoute(this.page)      : super(          pageBuilder: (            context,            animation,            secondaryAnimation,          ) {            return page;          },          transitionsBuilder: (            context,            animation,            secondaryAnimation,            child,          ) {            return Transform(              transform: Matrix4.identity()                // ç±»ä¼¼äº CSS é‡Œé¢ `perspective` å±æ€§ï¼Œç¡®å®š z=0 å¹³é¢ä¸ç”¨æˆ·ä¹‹é—´çš„è·ç¦»                ..setEntry(3, 2, 0.0001)                ..rotateX(animation.value * pi * 2)                ..rotateY(animation.value * pi * 2),              alignment: FractionalOffset.center,              child: child,            );          },          transitionDuration: Duration(seconds: 2),        );}Navigator.of(context).push(TransformRoute(SecondPage()));</code></pre><div><video src="videos/transform_transition.mov" controls width="320" autoplay muted loop></div><h3 id="EnterExitRoute"><a href="#EnterExitRoute" class="headerlink" title="EnterExitRoute"></a><code>EnterExitRoute</code></h3><p>åŒæ—¶ä¸ºè¿›å…¥é¡µé¢å’Œé€€å‡ºé¡µé¢æ·»åŠ åŠ¨ç”»</p><pre><code class="dart">class EnterExitRoute extends PageRouteBuilder {  final Widget enterPage;  final Widget exitPage;  EnterExitRoute(this.enterPage, this.exitPage)      : super(          pageBuilder: (            context,            animation,            secondaryAnimation,          ) {            return exitPage;          },          transitionsBuilder: (            context,            animation,            secondaryAnimation,            child,          ) =&gt;              Stack(            children: [              SlideTransition(                position: Tween&lt;Offset&gt;(                  begin: Offset(0.0, 0.0),                  end: Offset(-1.0, 0.0),                ).animate(                  CurvedAnimation(parent: animation, curve: Curves.easeIn),                ),                child: enterPage,              ),              SlideTransition(                position: Tween&lt;Offset&gt;(                  begin: Offset(1.0, 0.0),                  end: Offset.zero,                ).animate(                  CurvedAnimation(parent: animation, curve: Curves.easeInOut),                ),                child: exitPage,              )            ],          ),        );}Navigator.of(context).push(  EnterExitRoute(FirstPage(), SecondPage()),);</code></pre><div><video src="videos/enter_exist_transition.mov" controls width="320" autoplay muted loop></div><h2 id="ä½¿ç”¨-Navigator-pushNamed-æ–¹æ³•è·³è½¬"><a href="#ä½¿ç”¨-Navigator-pushNamed-æ–¹æ³•è·³è½¬" class="headerlink" title="ä½¿ç”¨ Navigator.pushNamed æ–¹æ³•è·³è½¬"></a>ä½¿ç”¨ <code>Navigator.pushNamed</code> æ–¹æ³•è·³è½¬</h2><p>åœ¨ <code>onGenerateRoute</code> å¯¹è·³è½¬è·¯ç”±çš„ <code>name</code> è¿›è¡Œåˆ¤æ–­ï¼Œå¯¹ç‰¹å®šçš„è·¯ç”±æ·»åŠ è¿‡æ¸¡åŠ¨ç”»ã€‚</p><pre><code class="dart">class MyApp extends StatelessWidget {  @override  Widget build(BuildContext context) {    return MaterialApp(      debugShowCheckedModeBanner: false,      home: FirstPage(),      onGenerateRoute: (settings) {        switch (settings.name) {          case &#39;/second&#39;:            return ScaleRoute(SecondPage());            break;          default:            return null;        }      },    );  }}Navigator.pushNamed(context, &#39;/second&#39;, arguments: {});</code></pre><h2 id="è®¾ç½®å…¨å±€çš„è·¯ç”±è¿‡æ¸¡åŠ¨ç”»"><a href="#è®¾ç½®å…¨å±€çš„è·¯ç”±è¿‡æ¸¡åŠ¨ç”»" class="headerlink" title="è®¾ç½®å…¨å±€çš„è·¯ç”±è¿‡æ¸¡åŠ¨ç”»"></a>è®¾ç½®å…¨å±€çš„è·¯ç”±è¿‡æ¸¡åŠ¨ç”»</h2><p><code>Flutter</code> çš„é»˜è®¤è·¯ç”±è¿‡æ¸¡åŠ¨ç”»æ˜¯ç”± <code>buildTransitions</code> æ–¹æ³•åˆ›å»ºçš„ï¼Œå®ƒä½¿ç”¨çš„æ˜¯ <code>Theme.of(context).pageTransitionsTheme</code>æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥å®šä¹‰å…¨å±€çš„è·¯ç”±è·³è½¬è¿‡æ¸¡åŠ¨ç”»ã€‚</p><pre><code class="dart">@overrideWidget buildTransitions(context, animation, secondaryAnimation, child) {    final PageTransitionsTheme theme = Theme.of(context).pageTransitionsTheme;    return theme.buildTransitions&lt;T&gt;(this, context, animation, secondaryAnimation, child);}</code></pre><p>é¦–å…ˆè‡ªå®šä¹‰ä¸€ä¸ª <code>TransitionBuilder</code>ï¼Œ <code>buildTransitions</code> æ–¹æ³•è¿”å›è·³è½¬é¡µé¢ã€‚ç„¶åé…ç½® <code>theme</code> çš„ <code>pageTransitionsTheme</code>ï¼Œè®¾ç½®å¯¹åº”çš„å¹³å°ï¼Œæœ€ååœ¨ä½¿ç”¨ <code>MaterialPageRoute</code> æˆ–è€… <code>CupertinoPageRoute</code> è¿›è¡Œé¡µé¢è·³è½¬æ—¶å°±ä¼šæœ‰è‡ªå®šä¹‰çš„è¿‡æ¸¡åŠ¨ç”»äº†ã€‚</p><pre><code class="dart">class ScaleTransitionBuilder extends PageTransitionsBuilder {  @override  Widget buildTransitions&lt;T&gt;(    route,    context,    animation,    secondaryAnimation,    child,  ) {    return ScaleTransition(      scale: CurvedAnimation(parent: animation, curve: Curves.easeIn),      child: child,    );  }}class MyApp extends StatelessWidget {  @override  Widget build(BuildContext context) {    return MaterialApp(      debugShowCheckedModeBanner: false,      home: FirstPage(),      theme: ThemeData(        pageTransitionsTheme: PageTransitionsTheme(          builders: {            TargetPlatform.android: ScaleTransitionBuilder(),            TargetPlatform.iOS: ScaleTransitionBuilder(),          },        ),      ),    );  }}Navigator.push(context, MaterialPageRoute(builder: (ctx) =&gt; SecondPage()));</code></pre><h2 id="å°†åŠ¨ç”»å°è£…æˆä¸€ä¸ªåº“"><a href="#å°†åŠ¨ç”»å°è£…æˆä¸€ä¸ªåº“" class="headerlink" title="å°†åŠ¨ç”»å°è£…æˆä¸€ä¸ªåº“"></a>å°†åŠ¨ç”»å°è£…æˆä¸€ä¸ªåº“</h2><p>å°†è‡ªå®šä¹‰çš„è·¯ç”±è¿‡æ¸¡åŠ¨ç”»å°è£…èµ·æ¥æ–¹ä¾¿ä½¿ç”¨ã€‚</p><pre><code class="dart">enum TransitionType {  fade,  scale,  rotate,  transform,}class PageTransition extends PageRouteBuilder {  PageTransition(TransitionType type, Widget page, Duration time)      : super(          pageBuilder: (            context,            animation,            secondaryAnimation,          ) {            return page;          },          transitionsBuilder: (            context,            animation,            secondaryAnimation,            child,          ) {            switch (type) {              case TransitionType.fade:                return FadeTransition(opacity: animation, child: child);                break;              case TransitionType.scale:                return ScaleTransition(                  scale: Tween(begin: 0.0, end: 1.0).animate(                    CurvedAnimation(parent: animation, curve: Curves.easeInOut),                  ),                  child: child,                );                break;              case TransitionType.rotate:                return RotationTransition(                  turns: CurvedAnimation(                    parent: animation,                    curve: Curves.easeInBack,                  ),                  child: child,                );                break;              case TransitionType.transform:                return Transform(                  transform: Matrix4.identity()                    ..setEntry(3, 2, 0.0001)                    ..rotateX(animation.value * pi * 2)                    ..rotateY(animation.value * pi * 2),                  alignment: FractionalOffset.center,                  child: child,                );                break;              default:                return child;            };          },          transitionDuration: time,        );}// ä½¿ç”¨Navigator.push(  context,  PageTransition(    TransitionType.rotate,    SecondPage(),    Duration(milliseconds: 800),  ),}</code></pre><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://flutter.cn/docs/cookbook/animation/page-route-animation" target="_blank" rel="noopener">ä¸ºé¡µé¢åˆ‡æ¢åŠ å…¥åŠ¨ç”»æ•ˆæœ</a></p><p><a href="https://medium.com/flutter-community/everything-you-need-to-know-about-flutter-page-route-transition-9ef5c1b32823" target="_blank" rel="noopener">Everything you need to know about Flutter page route transition</a></p><p><a href="https://medium.com/flutter/perspective-on-flutter-6f832f4d912e" target="_blank" rel="noopener">Perspective on Flutter</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/transition.jpg&quot; alt=&quot;flutter-routes&quot;&gt;&lt;/p&gt;&lt;p&gt;Flutter åº”ç”¨è¿›è¡Œè·¯ç”±è·³è½¬çš„æ—¶å€™æœ‰é»˜è®¤çš„è¿‡æ¸¡åŠ¨ç”»ï¼Œä½†æ˜¯è‡ªå®šä¹‰çš„è·³è½¬åŠ¨ç”»ä¼šè®©åº”ç”¨æ›´å…·ç‰¹è‰²&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Egg.js ä¸Šä¼ æ¥å£å¼€å‘æ€»ç»“</title>
    <link href="https://coldstone.fun/post/2019/12/05/egg-api-dev/"/>
    <id>https://coldstone.fun/post/2019/12/05/egg-api-dev/</id>
    <published>2019-12-05T12:00:00.000Z</published>
    <updated>2020-06-18T09:46:58.872Z</updated>
    
    <content type="html"><![CDATA[<p><img src="./images/egg.jpg" alt="egg"></p><p>æ€»ç»“ä¸€ä¸‹ä¹‹å‰ç”¨ Egg.js å¼€å‘çš„æ–‡ä»¶ä¸Šä¼ æ¥å£çš„ä»»åŠ¡</p><a id="more"></a><h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>è¦åœ¨æµè§ˆå™¨ç«¯å°†æ–‡ä»¶ä¸Šä¼ åˆ°é˜¿é‡Œçš„ OSS å¯¹è±¡å­˜å‚¨ï¼Œéœ€è¦ç”¨åˆ°é˜¿é‡Œäº‘æä¾›çš„ <a href="https://github.com/ali-sdk/ali-oss" target="_blank" rel="noopener">SDK</a>ï¼Œä½†æ˜¯è¿™æ ·ä¼šåœ¨å‰ç«¯æš´éœ² OSS çš„ <code>accessKeyId</code> å’Œ <code>accessKeySecret</code>ï¼Œè¿™æ˜¯ä¸å®‰å…¨çš„ã€‚æ‰€ä»¥éœ€è¦ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ¥å£æŠŠå‰ç«¯ä¼ è¿‡æ¥çš„æ–‡ä»¶ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨é‡Œé¢ï¼Œæœ€åˆåªæ”¯æŒé˜¿é‡Œäº‘ï¼Œä¹‹åå¯èƒ½ä¼šæ”¯æŒå…¶å®ƒçš„äº‘æœåŠ¡å•†æ¯”å¦‚ä¸ƒç‰›äº‘ã€‚</p><h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><p>åç«¯æ¡†æ¶ç”¨çš„æ˜¯ Egg.jsï¼Œå› ä¸ºæ¯”è¾ƒç†Ÿæ‚‰ã€‚ç„¶åè¿™åªæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„æœåŠ¡ï¼Œä¸€ä¸ªè·¯ç”±å°±è¡Œã€‚</p><pre><code class="js">router.post(`/${app.name}/v1/upload`, controller.oss.upload)</code></pre><p>ç„¶åå®ç°å¯¹åº”çš„ <code>OssController</code> çš„ <code>upload</code> æ–¹æ³•ï¼Œä¸€èˆ¬çš„å®è·µæ˜¯åœ¨ <code>Controller</code> å±‚è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œè¿™é‡Œç”¨å†…ç½®çš„æ˜¯ <code>egg-validate</code> æ’ä»¶è¿›è¡Œæ ¡éªŒã€‚å‡å¦‚æœ‰ä¸¤ä¸ªå‚æ•° <code>folder</code> å’Œ <code>bucket</code> ä»£è¡¨æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•å’Œ <code>bucket</code>ï¼Œé‚£ä¹ˆéªŒè¯ä»£ç å¦‚ä¸‹</p><pre><code class="js">const body = ctx.request.bodyconst rules = {  folder: { type: &#39;string&#39;, required: false, default: &#39;/&#39;, trim: true },  bucket: { type: &#39;string&#39;, required: false, default:  &#39;you-bucket-name&#39; },}await ctx.validate(rules, body)</code></pre><p>æ¥å—å‰ç«¯çš„ä¸Šä¼ æ–‡ä»¶ç”¨çš„æ˜¯ <a href="https://github.com/eggjs/egg-multipart" target="_blank" rel="noopener">egg-multipart</a> æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶æœ‰ä¸¤ç§æ¨¡å¼ <code>file</code> å’Œ <code>stream</code>ï¼Œ<code>file</code> æ¨¡å¼é€‚åˆç®€å•çš„æ–‡ä»¶ä¸Šä¼ ï¼Œè¿™ç§æ¨¡å¼ä¼šå…ˆå°†å‰ç«¯ä¼ æ¥çš„å›¾ç‰‡å­˜åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ‰§è¡Œå®Œæ“ä½œåéœ€è¦ç”¨ <code>ctx.cleanupRequestFiles()</code> æ–¹æ³•å°†æ–‡ä»¶åˆ é™¤ã€‚ <code>stream</code> æ¨¡å¼é€‚åˆåœ¨å¯¹ä¸Šä¼ æ–‡ä»¶è¿›ä¸€æ­¥å¤„ç†çš„æ—¶å€™ä½¿ç”¨ï¼Œå¦‚å‹ç¼©ï¼Œè§£å‹ç­‰ï¼Œå¦‚æœä¸Šä¼ æ–‡ä»¶æ˜¯å›¾ç‰‡é‚£ä¹ˆå¯ä»¥å°†è¿™ä¸ªæµä¼ é€’ç»™å¤„ç†å›¾ç‰‡çš„åº“è¿›è¡Œå¤„ç†ã€‚</p><p>åœ¨ <code>config.default.js</code> é…ç½® <code>egg-multipart</code> æ’ä»¶ï¼Œåœ¨ <code>fileExtensions</code> æ–°å¢éœ€è¦æ·»åŠ çš„æ–‡ä»¶ç±»å‹æ‰©å±•åï¼Œ<code>cleanSchedule</code> é…ç½®å®šæ—¶æ¸…é™¤é›¶æ—¶ä¿å­˜çš„æ–‡ä»¶ã€‚</p><pre><code class="ts">config.multipart = {  mode: &#39;file&#39;,  fileSize: &#39;50mb&#39;,  tmpdir: path.join(os.tmpdir(), &#39;egg-multipart-tmp&#39;, appInfo.name),  cleanSchedule: {    cron: &#39;0 30 4 * * *&#39;,  },  fileExtensions: [ &#39;.pdf&#39;, &#39;.doc&#39;, &#39;.docx&#39; ],}</code></pre><p>ç„¶åç”¨ <code>ctx.request.files</code> è·å–è¯·æ±‚è¿‡æ¥çš„æ–‡ä»¶ï¼Œè¿™é‡Œä¹Ÿéœ€è¦è¿›è¡ŒéªŒè¯è¯·æ±‚æ˜¯å¦æœ‰æ–‡ä»¶ï¼Œæ ¡éªŒå¥½è¯·æ±‚å‚æ•°åå°±æŠŠè¯·æ±‚å‚æ•°ä¼ åˆ° <code>Services</code> å±‚é‡Œ</p><pre><code class="js">const files = ctx.request.filesconst body = ctx.request.body...ctx.body = await ctx.service.oss.upload(body, files)</code></pre><p>å¯¹åº”çš„ <code>OssService</code> æ˜¯è´Ÿè´£ä¸»è¦çš„ä»»åŠ¡åœ°æ–¹ï¼Œæ–°å»º <code>OSS</code> å®ä¾‹å¯¹è±¡ï¼Œä¸Šä¼ æ–‡ä»¶ï¼Œè®¾ç½®ä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚å¤´ï¼Œè¿”å›ä¸Šä¼ ç»“æœã€‚</p><pre><code class="ts">import * as fs from &#39;fs&#39;import * as OSS from &#39;ali-oss&#39;const ONE_YEAR = 3600 * 24 * 365/** * OssService */export default class OssService extends Service {  private client  private createClient(option) {      this.client = new OSS({})    }  }  private async uploadFile(dir, file) {    let result    const filename = file.filename.replace(/\.(\w+)$/, `-${Date.now()}.$1`)    try {      result = await this.client.put(`${dir}${filename}`, file.filepath, {        headers: { &#39;Cache-Control&#39;: `max-age=${ONE_YEAR}`, &#39;Content-Disposition&#39;: &#39;&#39; },      })    } catch (e) {      this.ctx.logger.error(new Error(e.message))      throw new Error(e.message)    } finally {      fs.unlink(file.filepath, () =&gt; true)    }    return result  }  public async upload(parmas, files) {    this.createClient(parmas)    let result    if (files.length &gt; 1) {      result = []      for (const file of files) {        const res = await this.uploadFile(parmas.dir, file)        result.push({ url: res.url })      }    } else {      const file = files[0]      const res = await this.uploadFile(parmas.dir, file)      result = { url: res.url }    }    return result  }}</code></pre><p>è‡³æ­¤ä¸Šä¼ æ–‡ä»¶åˆ° OSS æ¥å£åŸºæœ¬å®Œæˆäº†</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>Egg.js é›†æˆäº† <a href="https://github.com/visionmedia/supertest" target="_blank" rel="noopener">SuperTest</a> æµ‹è¯•æ¡†æ¶ï¼Œæ‰€ä»¥å†™æ¥å£çš„å•å…ƒæµ‹è¯•å¾ˆæ–¹ä¾¿ã€‚è¿™ä¸ªæ¥å£ä¸»è¦æ˜¯å¯¹ <code>Controller</code> å±‚è¯·æ±‚å‚æ•°è¿›è¡Œæµ‹è¯•ã€‚æµ‹è¯•ä»£ç å†™åœ¨é¡¹ç›®ç›®å½• <code>test/app/controller/oss.test.ts</code> æ–‡ä»¶å†…ã€‚</p><pre><code class="ts">import { app, assert } from &#39;egg-mock/bootstrap&#39;describe(&#39;æµ‹è¯• oss controller&#39;, () =&gt; {  it(&#39;ä¸å†ç™½åå•çš„ bucket åè¿”å›é”™è¯¯&#39;, async () =&gt; {    const result = await app.httpRequest()      .post(&#39;/upload-server/v1/upload&#39;)      .set(&#39;Content-type&#39;, &#39;multipart/form-data; boundary=--------------------------820317025826519383208825&#39;)      .field(&#39;bucket&#39;, &#39;wrong-bucket&#39;)      .expect(403)    assert(result.body)  })  it(&#39;ä¸Šä¼ æ–‡ä»¶æˆåŠŸ&#39;, async () =&gt; {    const result = await app.httpRequest()      .post(&#39;/upload-server/v1/upload&#39;)      .set(&#39;Content-type&#39;, &#39;multipart/form-data; boundary=--------------------------820317025826519383208825&#39;)      .field(&#39;dir&#39;, &#39;images&#39;)      .attach(&#39;avatar&#39;, &#39;test/app/controller/avatar.png&#39;)      .expect(200)    assert(result.body)  })})</code></pre><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>Egg.js æœ¬èº«éƒ¨ç½²ååˆ†çš„æ–¹ä¾¿ï¼Œåªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯</p><pre><code class="bash">egg-scripts start --daemon --env=prod --title=upload-server</code></pre><p>ä½†æ˜¯å°†è¿™ä¸ªæœåŠ¡å˜æˆä¸€ä¸ª <code>Docker</code> <code>iamge</code> å°±æ›´æ–¹ä¾¿äº†</p><blockquote><p>æ³¨æ„:<br>è¦ç”¨ <code>Docker</code> è¿è¡Œ Egg æœåŠ¡éœ€è¦å°† <code>package.json</code> ä¸­ <code>scripts</code> çš„ <code>start</code> å‘½ä»¤å»æ‰ <code>--daemon</code> å‚æ•°ï¼Œå˜æˆ<br><code>egg-scripts start --env=prod --title=upload-server</code><br>å› ä¸ºåœ¨ <code>Docker</code> è¿è¡Œ Egg åº”ç”¨éœ€è¦æ˜¯å‰å°æ¨¡å¼è¿è¡Œ</p></blockquote><pre><code class="dockerfile">FROM node:lts-alpine# è®¾ç½®æ—¶åŒºRUN apk --update add tzdata \    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \    &amp;&amp; echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone \    &amp;&amp; apk del tzdataWORKDIR /upload-serverCOPY package*.json ./RUN npm install --registry=https://registry.npm.taobao.orgCOPY . /upload-serverRUN npm run tsc &amp;&amp; npm prune --productionEXPOSE 7001CMD npm start</code></pre><p>æœ‰äº†é•œåƒåï¼Œå†™ä¸€ä¸ªè¿è¡Œå®¹å™¨çš„è„šæœ¬ï¼Œæ·»åŠ å¯æ‰§è¡Œçš„æƒé™ï¼Œä¹‹åå¯åŠ¨æœåŠ¡å°±å¯ä»¥åªç”¨è¿è¡Œè¿™ä¸ªè„šæœ¬å³å¯ã€‚</p><pre><code class="sh">#!/bin/bashset -eIMAGE_NAME=&quot;upload-server&quot;CONTAINER_NAME=&quot;upload-server&quot;echo &#39;æ‹‰å–ä»£ç &#39;git pull origin masterecho &#39;è¿è¡Œå®¹å™¨&#39;docker rm -f ${CONTAINER_NAME} || truedocker build -t ${IMAGE_NAME} .docker run -d -p 7001:7001 --env-file .env --name=${CONTAINER_NAME} ${IMAGE_NAME}exitEOF</code></pre><pre><code class="bash">chmod +x ./deploy.sh</code></pre><p>è¿è¡Œè„šæœ¬</p><pre><code class="bash">./deploy.sh</code></pre><h2 id="è¯·æ±‚é¢‘ç‡é™åˆ¶"><a href="#è¯·æ±‚é¢‘ç‡é™åˆ¶" class="headerlink" title="è¯·æ±‚é¢‘ç‡é™åˆ¶"></a>è¯·æ±‚é¢‘ç‡é™åˆ¶</h2><p>ä¸ºäº†é˜²æ­¢æ¥å£è¢«æ»¥ç”¨éœ€è¦é™åˆ¶è¯·æ±‚æ¥å£çš„é¢‘ç‡ï¼Œåœ¨ Github æ‰¾åˆ°ä¸€ä¸ª <a href="https://github.com/koajs/ratelimit" target="_blank" rel="noopener">koa-ratelimit</a> çš„ä»“åº“ï¼Œç”±äº Egg.js æ”¯æŒ Koa çš„æ’ä»¶ï¼Œæ‰€ä»¥ä¹Ÿé€‚åˆã€‚</p><p>å‚è€ƒè¿™ä¸ªä»“åº“çš„æ–‡æ¡£ï¼Œåœ¨é¡¹ç›® <code>middleware</code> æ–‡ä»¶æ·»åŠ ä¸€ä¸ª <code>ratelimit.ts</code>ï¼Œç”¨è¿™ä¸ªä¸­é—´ä»¶æ¥æ§åˆ¶ï¼Œä¸€å¼€å§‹ä½¿ç”¨çš„ <code>redis</code> ä½œä¸º <code>driver</code> å¯æ˜¯é‡åˆ°ä¸€ä¸ª <code>docker-compose</code> ç½‘ç»œé“¾æ¥é—®é¢˜å§‹ç»ˆæ— æ³•è§£å†³ï¼Œé‚æ”¾å¼ƒï¼Œæ”¹ç”¨å†…å­˜æ¨¡å¼ã€‚</p><pre><code class="ts">import * as Redis from &#39;ioredis&#39;import * as ratelimit from &#39;koa-ratelimit&#39;const db = new Map();export default () =&gt; {  return ratelimit({    db: db,    driver: &#39;memory&#39;,    duration: 60000,    errorMessage: &#39;è¯·æ±‚æ¬¡æ•°è¶…è¿‡é™åˆ¶&#39;,    id: ctx =&gt; ctx.ip,    headers: {      remaining: &#39;Upload-Limit-Remaining&#39;,      reset: &#39;Uplaod-Limit-Reset&#39;,      total: &#39;Upload-Limit-Total&#39;,    },    max: 300,    disableHeader: false,  })}</code></pre><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p><strong><em>ä¸Šä¼ åˆ° OSS çš„å›¾ç‰‡åœ¨æµè§ˆå™¨æ— æ³•é¢„è§ˆå˜ä¸ºä¸‹è½½</em></strong></p><p>é¦–å…ˆé˜¿é‡Œäº‘è§„å®š</p><blockquote><p>å¯¹äºå›¾ç‰‡æ–‡ä»¶ï¼ˆåœ¨æœªä¿®æ”¹æ–‡ä»¶httpå¤´çš„æƒ…å†µä¸‹ï¼‰ï¼š<br>è‹¥æ‚¨çš„Bucketæ˜¯2019å¹´9æœˆ23æ—¥å‰åˆ›å»ºçš„ï¼Œä½¿ç”¨OSSé»˜è®¤è®¿é—®åŸŸåæˆ–è‡ªæœ‰åŸŸåç”Ÿæˆçš„æ–‡ä»¶URLä»æµè§ˆå™¨è®¿é—®æ—¶å¯ä»¥é¢„è§ˆæ–‡ä»¶å†…å®¹ã€‚<br>è‹¥æ‚¨çš„Bucketæ˜¯2019å¹´9æœˆ23æ—¥ååˆ›å»ºçš„ï¼Œä½¿ç”¨OSSé»˜è®¤åŸŸåç”Ÿæˆçš„æ–‡ä»¶URLä»æµè§ˆå™¨è®¿é—®æ—¶ä¼šä»¥é™„ä»¶å½¢å¼ä¸‹è½½ï¼›ä½¿ç”¨è‡ªæœ‰åŸŸåç”Ÿæˆçš„æ–‡ä»¶URLè®¿é—®æ—¶ï¼Œå¯ä»¥é¢„è§ˆ&gt; æ–‡ä»¶å†…å®¹ã€‚ç»‘å®šè‡ªæœ‰åŸŸåæ­¥éª¤è¯·å‚è§ç»‘å®šè‡ªå®šä¹‰åŸŸåã€‚</p></blockquote><p>ç„¶åæ˜¯ä¸Šä¼ çš„å›¾ç‰‡ä¸èƒ½æ·»åŠ  <code>Content-Disposition</code> è¿”å›å¤´ä¿¡æ¯ï¼Œç»™æ–‡ä»¶æ·»åŠ äº†è¿™ä¸ª http è¿”å›å¤´ï¼Œä¹Ÿä¼šè®©å›¾ç‰‡å˜æˆä¸‹è½½ã€‚</p><hr><p><strong><em><code>egg-multipart</code> æ’ä»¶ä½¿ç”¨ <code>stream</code> æ¨¡å¼æ— æ³•è·å–è¯·æ±‚ä½“ä¼ è¿‡æ¥çš„å‚æ•°</em></strong></p><p>ç”¨ <code>file</code> æ¨¡å¼èƒ½å¤Ÿæ­£ç¡®çš„æ‹¿åˆ° <code>ctx.request.body</code> é‡Œçš„è¯·æ±‚å‚æ•°ï¼Œä½†æ˜¯å°†ä½¿ç”¨ <code>stream</code> æ¨¡å¼å°±æ— æ³•è·å–ï¼Œæœç´¢äº†ä¸€ä¸‹åå‘ç°ä½¿ç”¨ <code>stream</code> æ¨¡å¼éœ€è¦å°†ä¸Šä¼ æ–‡ä»¶æ”¾åˆ°è¡¨å•çš„æœ€åä¸€é¡¹å»ï¼Œä¸ç„¶æ‹¿ä¸åˆ°å…¶å®ƒå‚æ•°ã€‚</p><blockquote><p><a href="https://eggjs.org/zh-cn/basics/controller.html#%E8%8E%B7%E5%8F%96%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%96%87%E4%BB%B6" target="_blank" rel="noopener">https://eggjs.org/zh-cn/basics/controller.html#%E8%8E%B7%E5%8F%96%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%96%87%E4%BB%B6</a><br>åªæ”¯æŒä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ã€‚<br>ä¸Šä¼ æ–‡ä»¶å¿…é¡»åœ¨æ‰€æœ‰å…¶ä»–çš„ fields åé¢ï¼Œå¦åˆ™åœ¨æ‹¿åˆ°æ–‡ä»¶æµæ—¶å¯èƒ½è¿˜è·å–ä¸åˆ° fieldsã€‚</p></blockquote><hr><p><strong><em>Redis æ— æ³•é“¾æ¥é—®é¢˜</em></strong></p><p>ç”¨ä»¥ä¸‹çš„ <code>docker-compose.yml</code> æ–‡ä»¶å¯åŠ¨ Egg.js åº”ç”¨å’Œä¸€ä¸ª <code>Redis</code> æœåŠ¡ï¼Œç„¶åæƒ³åœ¨ä¸Šä¼ æ¥å£çš„è¯·æ±‚é¢‘ç‡é™åˆ¶çš„ä¸­é—´ä»¶ä¸­ä½¿ç”¨è¿™ä¸ª <code>Redis</code> æœåŠ¡ï¼Œç„¶åä¸€ç›´æŠ¥é“¾æ¥å¤±è´¥â€¦Google ä¹‹åè¯•äº†å‡ ç§æ–¹æ³•ä¾ç„¶æ²¡æœ‰æˆåŠŸ :sad:</p><pre><code class="yml">version: &quot;3&quot;services:  redis:    image: redis:alpine    container_name: redis    restart: always    hostname: redis    ports:      - &quot;6379:6379&quot;    networks:       - upload-server-network  upload_server:    build:      context: .      dockerfile: Dockerfile    container_name: upload_server    restart: always    environment:      - EGG_SERVER_ENV:prod    ports:      - 7001:7001    depends_on:      - redis    networks:      - upload-server-networknetworks:  upload-server-network:    driver: bridge</code></pre><hr><p><strong><em>Egg.js å…¨å±€é”™è¯¯å¤„ç†è¿”å›æ ¼å¼é—®é¢˜</em></strong></p><p>Egg.js æœ¬èº«æœ‰ä¸€ä¸ªå…¨å±€é”™è¯¯å¤„ç†çš„æ’ä»¶ <a href="https://github.com/eggjs/egg-onerror" target="_blank" rel="noopener">egg-onerror</a>ï¼Œä½†æ˜¯ç”¨è¿™ä¸ªæ’ä»¶åœ¨å¤„ç†ä¸Šä¼ æ–‡ä»¶çš„å¼‚å¸¸æ—¶ï¼Œç›´æ¥ <code>throw</code> é”™è¯¯ï¼Œè¿”å›ç»™å‰ç«¯çš„æ•°æ®æ ¼å¼æ˜¯æ–‡æœ¬ç±»å‹çš„ï¼Œä¸æ˜¯ json æ ¼å¼ï¼Œé™¤éå‰ç«¯åœ¨å‘é€è¯·æ±‚çš„æ·»åŠ  <code>Accept: application/json</code> è¯·æ±‚å¤´ä¿¡æ¯ã€‚<br>åªèƒ½åœ¨ <code>config.default.js</code> ä½¿ç”¨ <code>all</code> è¿›è¡Œæ•è·å¼‚å¸¸ï¼Œç„¶åç”¨ <code>JSON.stringify</code> æ–¹æ³•åœ¨å¤„ç†ä¸€éï¼Œè¿™æ · <code>throw new Error(e.message)</code> çš„æ—¶å€™è¿”å›ç»™å‰ç«¯çš„æ‰æ˜¯ jsonã€‚</p><pre><code class="js">config.onerror = {  all(err, ctx) {    ctx.status = err.status || 500    ctx.body = JSON.stringify({      code: ctx.status,      success: false,      message: err.message,    })  },}</code></pre><p>æœ€ç»ˆè¿˜æ˜¯æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œè‡ªå·±æ·»åŠ äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿›è¡Œå¼‚å¸¸æ•è·ã€‚</p><pre><code class="ts">private error(msg) {  const { ctx } = this  ctx.status = 400  ctx.body = {    code: ctx.status,    success: false,    message: msg,  }}...this.error(&#39;é”™è¯¯çš„ bucket&#39;)return</code></pre><hr>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;./images/egg.jpg&quot; alt=&quot;egg&quot;&gt;&lt;/p&gt;&lt;p&gt;æ€»ç»“ä¸€ä¸‹ä¹‹å‰ç”¨ Egg.js å¼€å‘çš„æ–‡ä»¶ä¸Šä¼ æ¥å£çš„ä»»åŠ¡&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Node" scheme="https://coldstone.fun/tags/Node/"/>
    
      <category term="Egg.js" scheme="https://coldstone.fun/tags/Egg-js/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Flutter å®ç°ä¸€ä¸ªèµ°é©¬ç¯å¸ƒå±€</title>
    <link href="https://coldstone.fun/post/2019/11/20/flutter-carousel/"/>
    <id>https://coldstone.fun/post/2019/11/20/flutter-carousel/</id>
    <published>2019-11-20T07:55:26.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<img src="images/carousel.jpg" height="334"><p>èµ°é©¬ç¯æ˜¯ä¸€ç§å¸¸è§çš„æ•ˆæœï¼Œæœ¬æ–‡è®²ä¸€ä¸‹å¦‚ä½•ç”¨ <code>PageView</code> åœ¨ <code>Flutter</code> é‡Œå®ç°ä¸€ä¸ªèµ°é©¬ç¯</p><a id="more"></a><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p>å®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼Œå½“å‰é¡µé¢çš„é«˜åº¦æ¯”å…¶å®ƒé¡µé¢é«˜ï¼Œåˆ‡æ¢é¡µé¢çš„æ—¶å€™æœ‰ä¸€ä¸ªé«˜åº¦å˜åŒ–çš„åŠ¨ç”»ã€‚å®ç°è¿™æ ·çš„æ•ˆæœä¸»è¦ç”¨åˆ°çš„æ˜¯ <code>PageView.builder</code> éƒ¨ä»¶ã€‚</p><div><video src="videos/heroes.mp4" controls width="320" autoplay muted></div><h2 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h2><h3 id="åˆ›å»ºé¦–é¡µ"><a href="#åˆ›å»ºé¦–é¡µ" class="headerlink" title="åˆ›å»ºé¦–é¡µ"></a>åˆ›å»ºé¦–é¡µ</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>IndexPage</code> éƒ¨ä»¶ï¼Œè¿™ä¸ªéƒ¨ä»¶ç”¨æ¥æ”¾ <code>PageView</code>ï¼Œå› ä¸ºéœ€è¦ä½¿ç”¨ <code>setState</code> æ–¹æ³•æ›´æ–° UIï¼Œæ‰€ä»¥å®ƒæ˜¯ stateful çš„ã€‚</p><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;class IndexPage extends StatefulWidget {  @override  _IndexPageState createState() =&gt; _IndexPageState();}class _IndexPageState extends State&lt;IndexPage&gt; {  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        elevation: 0.0,        backgroundColor: Colors.white,      ),      body: Column(        children: &lt;Widget&gt;[],      ),    );  }}</code></pre><p>ç„¶ååœ¨éƒ¨ä»¶å†…ç”³æ˜ä¸€ä¸ª <code>_pageIndex</code> å˜é‡ç”¨æ¥ä¿å­˜å½“å‰æ˜¾ç¤ºçš„é¡µé¢çš„ indexï¼Œåœ¨ <code>initState</code> ç”Ÿå‘½å‘¨æœŸé‡Œé¢åˆå§‹åŒ–ä¸€ä¸ª <code>PageController</code> ç”¨æ¥é…ç½® <code>PageView</code> éƒ¨ä»¶ã€‚</p><p>åœ¨ <code>body</code> çš„ <code>Column</code> é‡Œé¢åˆ›å»ºä¸€ä¸ª <code>PageView.builder</code>ï¼Œä½¿ç”¨ä¸€ä¸ª <code>SizedBox</code> éƒ¨ä»¶æŒ‡å®š <code>PageView</code> çš„é«˜åº¦ï¼Œå°† <code>controller</code> è®¾ç½®ä¸º <code>_pageController</code>ï¼Œåœ¨ <code>onPageChanged</code> äº‹ä»¶é‡Œå°†å½“å‰æ˜¾ç¤ºé¡µé¢çš„ <code>index</code> å€¼èµ‹å€¼ç»™ <code>_pageIndex</code> å˜é‡ã€‚</p><pre><code class="dart">int _pageIndex = 0;PageController _pageController;@overridevoid initState() {  super.initState();  _pageController = PageController(    initialPage: 0,    viewportFraction: 0.8,  );}body: Column(  children: &lt;Widget&gt;[    SizedBox(      height: 580.0,      child: PageView.builder(        itemCount: 3,        pageSnapping: true,        controller: _pageController,        onPageChanged: (int index) {          setState(() {            _pageIndex = index;          });        },        itemBuilder: (BuildContext ctx, int index) {          return _buildItem(_pageIndex, index);        },      ),    ),  ],),</code></pre><blockquote><p>å…³é”®ç‚¹: è®¾ç½® <code>PageController</code> çš„ <code>viewportFraction</code> å‚æ•°å°äº 1ï¼Œè¿™ä¸ªå€¼æ˜¯ç”¨æ¥è®¾ç½®æ¯ä¸ªé¡µé¢åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„æ¯”ä¾‹ï¼Œå°äº 1 çš„è¯ï¼Œå°±å¯ä»¥åœ¨å½“å‰é¡µé¢åŒæ—¶æ˜¾ç¤ºå…¶å®ƒé¡µé¢çš„å†…å®¹äº†ã€‚</p><pre><code class="dart">/// The fraction of the viewport that each page should occupy./// Defaults to 1.0, which means each page fills the viewport in the scrolling direction.final double viewportFraction;</code></pre></blockquote><h3 id="å®ç°-buildItem"><a href="#å®ç°-buildItem" class="headerlink" title="å®ç° _buildItem"></a>å®ç° <code>_buildItem</code></h3><p>æ¥ç€å®ç° <code>_buildItem</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è¿”å› <code>PageView.builder</code> é‡Œæ¯ä¸€ä¸ªé¡µé¢æ¸²æŸ“çš„å†…å®¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•° <code>activeIndex</code> æ˜¯å½“å‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šé¡µé¢çš„ <code>index</code>ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>index</code> æ˜¯æ¯ä¸€é¡¹è‡ªå·±çš„ <code>index</code>ã€‚</p><p>ä½¿ç”¨ä¸€ä¸ª <code>Center</code> éƒ¨ä»¶è®©å†…å®¹å±…ä¸­æ˜¾ç¤ºï¼Œç„¶åç”¨ä¸€ä¸ª <code>AnimatedContainer</code> æ·»åŠ é¡µé¢åˆ‡æ¢æ—¶çš„é«˜åº¦å˜åŒ–çš„åŠ¨ç”»æ•ˆæœï¼Œåˆ‡æ¢é¡µé¢çš„æ—¶å€™ä½¿ç”¨äº†<code>setState</code> æ–¹æ³•æ”¹å˜äº† <code>_pageIndex</code>ï¼Œ<code>Flutter</code> é‡æ–°ç»˜åˆ¶æ¯ä¸€é¡¹ã€‚å…³é”®ç‚¹åœ¨äºåˆ¤æ–­å½“å‰é¡µé¢æ˜¯å¦ä¸ºæ­£åœ¨æ˜¾ç¤ºçš„é¡µé¢ï¼Œæ˜¯çš„è¯å®ƒçš„é«˜åº¦å°±æ˜¯ 500 ä¸æ˜¯çš„è¯å°±æ˜¯ 450ã€‚</p><pre><code class="dart">_buildItem(activeIndex, index) {  return Center(    child: AnimatedContainer(      curve: Curves.easeInOut,      duration: Duration(milliseconds: 300),      height: activeIndex == index ? 500.0 : 450.0,      margin: EdgeInsets.symmetric(vertical: 20.0, horizontal: 10.0),      decoration: BoxDecoration(        color: heroes[index].color,        borderRadius: BorderRadius.all(Radius.circular(12.0)),      ),      child: Stack(),    ),  );}</code></pre><img src="images/empty00.jpg" width="320" style="width:320px"><h3 id="æ·»åŠ å†…å®¹"><a href="#æ·»åŠ å†…å®¹" class="headerlink" title="æ·»åŠ å†…å®¹"></a>æ·»åŠ å†…å®¹</h3><p>ç„¶åç»™ <code>AnimatedContainer</code> æ·»åŠ æ¯ä¸€é¡¹çš„å†…å®¹</p><pre><code class="dart">child: Stack(  fit: StackFit.expand,  children: &lt;Widget&gt;[    ClipRRect(      borderRadius: BorderRadius.all(        Radius.circular(12.0),      ),      child: Image.network(        heroes[index].image,        fit: BoxFit.cover,      ),    ),    Align(      alignment: Alignment.bottomCenter,      child: Row(        children: &lt;Widget&gt;[          Expanded(            child: Container(              padding: EdgeInsets.all(12.0),              decoration: BoxDecoration(                color: Colors.black26,                borderRadius: BorderRadius.only(                  bottomRight: Radius.circular(12.0),                  bottomLeft: Radius.circular(12.0),                ),              ),              child: Text(                heroes[index].title,                textAlign: TextAlign.center,                style: TextStyle(                  fontSize: 20.0,                  fontWeight: FontWeight.bold,                  color: Colors.white,                ),              ),            ),          )        ],      ),    ),  ],),</code></pre><h3 id="å®ç°æŒ‡ç¤ºå™¨"><a href="#å®ç°æŒ‡ç¤ºå™¨" class="headerlink" title="å®ç°æŒ‡ç¤ºå™¨"></a>å®ç°æŒ‡ç¤ºå™¨</h3><p>ç„¶åå®ç°é¡µé¢çš„æŒ‡ç¤ºå™¨ï¼Œåˆ›å»ºä¸€ä¸ª <code>PageIndicator</code> éƒ¨ä»¶ï¼Œéœ€è¦ä¼ å…¥ <code>pageCount</code> è¡¨ç¤ºæ€»é¡µæ•°ï¼Œä»¥åŠ <code>currentIndex</code> è¡¨ç¤ºå½“å‰æ˜¾ç¤ºçš„é¡µæ•°ç´¢å¼•ã€‚æŠŠæ‰€æœ‰æŒ‡ç¤ºå™¨æ”¾åœ¨ä¸€ä¸ª <code>Row</code> éƒ¨ä»¶é‡Œï¼Œåˆ¤æ–­å½“å‰æŒ‡ç¤ºå™¨çš„ <code>index</code> æ˜¯å¦ä¸ºæ­£åœ¨æ˜¾ç¤ºé¡µé¢çš„ <code>index</code>ï¼Œæ˜¯çš„è¯æ˜¾ç¤ºè¾ƒæ·±çš„é¢œè‰²ã€‚</p><pre><code class="dart">class PageIndicator extends StatelessWidget {  final int pageCount;  final int currentIndex;  const PageIndicator(this.currentIndex, this.pageCount);  Widget _indicator(bool isActive) {    return Container(      width: 6.0,      height: 6.0,      margin: EdgeInsets.symmetric(horizontal: 3.0),      decoration: BoxDecoration(        color: isActive ? Color(0xff666a84) : Color(0xffb9bcca),        shape: BoxShape.circle,        boxShadow: [          BoxShadow(            color: Colors.black12,            offset: Offset(0.0, 3.0),            blurRadius: 3.0,          ),        ],      ),    );  }  List&lt;Widget&gt; _buildIndicators() {    List&lt;Widget&gt; indicators = [];    for (int i = 0; i &lt; pageCount; i++) {      indicators.add(i == currentIndex ? _indicator(true) : _indicator(false));    }    return indicators;  }  @override  Widget build(BuildContext context) {    return Row(      mainAxisAlignment: MainAxisAlignment.center,      children: _buildIndicators(),    );  }}</code></pre><p>æ·»åŠ  <code>PageIndicator</code> åˆ° <code>SizedBox</code> ä¸‹æ”¾</p><h3 id="å°è£…-Carousel"><a href="#å°è£…-Carousel" class="headerlink" title="å°è£… Carousel"></a>å°è£… <code>Carousel</code></h3><p>æœ€åçš„æœ€åä¼˜åŒ–ä¸€ä¸‹ä»£ç ï¼ŒæŠŠéƒ¨ä»¶å°è£…ä¸€ä¸‹ï¼Œè®©å®ƒæˆä¸ºä¸€ä¸ªå•ç‹¬çš„éƒ¨ä»¶ï¼Œåˆ›å»ºä¸€ä¸ª <code>Carousel</code> éƒ¨ä»¶ï¼Œå¯¹å¤–æš´éœ² <code>items</code> å’Œ <code>height</code> ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«é…ç½®æ•°æ®å’Œé«˜åº¦ã€‚</p><pre><code class="dart">class Carousel extends StatefulWidget {  final List items;  final double height;  const Carousel({    @required this.items,    @required this.height,  });  @override  _CarouselState createState() =&gt; _CarouselState();}class _CarouselState extends State&lt;Carousel&gt; {  int _pageIndex = 0;  PageController _pageController;  Widget _buildItem(activeIndex, index) {    final items = widget.items;    return Center(      child: AnimatedContainer(        curve: Curves.easeInOut,        duration: Duration(milliseconds: 300),        height: activeIndex == index ? 500.0 : 450.0,        margin: EdgeInsets.symmetric(vertical: 20.0, horizontal: 10.0),        decoration: BoxDecoration(          color: items[index].color,          borderRadius: BorderRadius.all(Radius.circular(12.0)),        ),        child: Stack(          fit: StackFit.expand,          children: &lt;Widget&gt;[            ClipRRect(              borderRadius: BorderRadius.all(                Radius.circular(12.0),              ),              child: Image.network(                items[index].image,                fit: BoxFit.cover,              ),            ),            Align(              alignment: Alignment.bottomCenter,              child: Row(                children: &lt;Widget&gt;[                  Expanded(                    child: Container(                      padding: EdgeInsets.all(12.0),                      decoration: BoxDecoration(                        color: Colors.black26,                        borderRadius: BorderRadius.only(                          bottomRight: Radius.circular(12.0),                          bottomLeft: Radius.circular(12.0),                        ),                      ),                      child: Text(                        items[index].title,                        textAlign: TextAlign.center,                        style: TextStyle(                          fontSize: 20.0,                          fontWeight: FontWeight.bold,                          color: Colors.white,                        ),                      ),                    ),                  )                ],              ),            ),          ],        ),      ),    );  }  @override  void initState() {    super.initState();    _pageController = PageController(      initialPage: 0,      viewportFraction: 0.8,    );  }  @override  Widget build(BuildContext context) {    return Column(      children: &lt;Widget&gt;[        Container(          height: widget.height,          child: PageView.builder(            pageSnapping: true,            itemCount: heroes.length,            controller: _pageController,            onPageChanged: (int index) {              setState(() {                _pageIndex = index;              });            },            itemBuilder: (BuildContext ctx, int index) {              return _buildItem(_pageIndex, index);            },          ),        ),        PageIndicator(_pageIndex, widget.items.length),      ],    );  }}</code></pre><p>ä¹‹ååœ¨ <code>IndexPage</code> éƒ¨ä»¶é‡Œå°±åªç”¨å®ä¾‹åŒ–ä¸€ä¸ª <code>Carousel</code> äº†ï¼ŒåŒæ—¶ç”±äº <code>IndexPage</code> ä¸ç”¨ç®¡ç†éƒ¨ä»¶çŠ¶æ€äº†ï¼Œå¯ä»¥å°†å®ƒå˜æˆ <code>StatelessWidget</code>ã€‚</p><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><pre><code class="dart">import &#39;package:flutter/material.dart&#39;;class Hero {  final Color color;  final String image;  final String title;  Hero({    @required this.color,    @required this.image,    @required this.title,  });}List heroes = [  Hero(    color: Color(0xFF86F3FB),    image: &quot;https://game.gtimg.cn/images/lol/act/img/skin/big22009.jpg&quot;,    title: &#39;å¯’å†°å°„æ‰‹-è‰¾å¸Œ&#39;,  ),  Hero(    color: Color(0xFF7D6588),    image: &quot;https://game.gtimg.cn/images/lol/act/img/skin/big39006.jpg&quot;,    title: &#39;åˆ€é”‹èˆè€…-è‰¾ç‘è‰å¨…&#39;,  ),  Hero(    color: Color(0xFF4C314D),    image: &quot;https://game.gtimg.cn/images/lol/act/img/skin/big103015.jpg&quot;,    title: &#39;ä¹å°¾å¦–ç‹-é˜¿ç‹¸&#39;,  ),];class Carousel extends StatefulWidget {  final List items;  final double height;  const Carousel({    @required this.items,    @required this.height,  });  @override  _CarouselState createState() =&gt; _CarouselState();}class _CarouselState extends State&lt;Carousel&gt; {  int _pageIndex = 0;  PageController _pageController;  Widget _buildItem(activeIndex, index) {    final items = widget.items;    return Center(      child: AnimatedContainer(        curve: Curves.easeInOut,        duration: Duration(milliseconds: 300),        height: activeIndex == index ? 500.0 : 450.0,        margin: EdgeInsets.symmetric(vertical: 20.0, horizontal: 10.0),        decoration: BoxDecoration(          color: items[index].color,          borderRadius: BorderRadius.all(Radius.circular(12.0)),        ),        child: Stack(          fit: StackFit.expand,          children: &lt;Widget&gt;[            ClipRRect(              borderRadius: BorderRadius.all(                Radius.circular(12.0),              ),              child: Image.network(                items[index].image,                fit: BoxFit.cover,              ),            ),            Align(              alignment: Alignment.bottomCenter,              child: Row(                children: &lt;Widget&gt;[                  Expanded(                    child: Container(                      padding: EdgeInsets.all(12.0),                      decoration: BoxDecoration(                        color: Colors.black26,                        borderRadius: BorderRadius.only(                          bottomRight: Radius.circular(12.0),                          bottomLeft: Radius.circular(12.0),                        ),                      ),                      child: Text(                        items[index].title,                        textAlign: TextAlign.center,                        style: TextStyle(                          fontSize: 20.0,                          fontWeight: FontWeight.bold,                          color: Colors.white,                        ),                      ),                    ),                  )                ],              ),            ),          ],        ),      ),    );  }  @override  void initState() {    super.initState();    _pageController = PageController(      initialPage: 0,      viewportFraction: 0.8,    );  }  @override  Widget build(BuildContext context) {    return Column(      children: &lt;Widget&gt;[        Container(          height: widget.height,          child: PageView.builder(            pageSnapping: true,            itemCount: heroes.length,            controller: _pageController,            onPageChanged: (int index) {              setState(() {                _pageIndex = index;              });            },            itemBuilder: (BuildContext ctx, int index) {              return _buildItem(_pageIndex, index);            },          ),        ),        PageIndicator(_pageIndex, widget.items.length),      ],    );  }}class PageIndicator extends StatelessWidget {  final int currentIndex;  final int pageCount;  const PageIndicator(this.currentIndex, this.pageCount);  Widget _indicator(bool isActive) {    return Container(      width: 6.0,      height: 6.0,      margin: EdgeInsets.symmetric(horizontal: 3.0),      decoration: BoxDecoration(        color: isActive ? Color(0xff666a84) : Color(0xffb9bcca),        shape: BoxShape.circle,        boxShadow: [          BoxShadow(            color: Colors.black12,            offset: Offset(0.0, 3.0),            blurRadius: 3.0,          ),        ],      ),    );  }  List&lt;Widget&gt; _buildIndicators() {    List&lt;Widget&gt; indicators = [];    for (int i = 0; i &lt; pageCount; i++) {      indicators.add(i == currentIndex ? _indicator(true) : _indicator(false));    }    return indicators;  }  @override  Widget build(BuildContext context) {    return Row(      mainAxisAlignment: MainAxisAlignment.center,      children: _buildIndicators(),    );  }}class IndexPage extends StatelessWidget {  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        elevation: 0.0,        backgroundColor: Colors.white,      ),      body: Carousel(        height: 540,        items: heroes,      ),      backgroundColor: Colors.white,    );  }}</code></pre><p>è‡³æ­¤ï¼Œæ•´ä¸ªå¸ƒå±€å°±å®Œæˆäº†ï¼ ğŸ˜</p>]]></content>
    
    <summary type="html">
    
      &lt;img src=&quot;images/carousel.jpg&quot; height=&quot;334&quot;&gt;&lt;p&gt;èµ°é©¬ç¯æ˜¯ä¸€ç§å¸¸è§çš„æ•ˆæœï¼Œæœ¬æ–‡è®²ä¸€ä¸‹å¦‚ä½•ç”¨ &lt;code&gt;PageView&lt;/code&gt; åœ¨ &lt;code&gt;Flutter&lt;/code&gt; é‡Œå®ç°ä¸€ä¸ªèµ°é©¬ç¯&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Flutter" scheme="https://coldstone.fun/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†äº«ä¸¤é“é¢è¯•é¢˜</title>
    <link href="https://coldstone.fun/post/2019/11/15/two-interview-question/"/>
    <id>https://coldstone.fun/post/2019/11/15/two-interview-question/</id>
    <published>2019-11-15T02:33:15.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p>å‰å‡ å¤©é‡åˆ°ä¸¤ä¸ªå‰ç«¯é¢è¯•é¢˜ï¼Œè¦å†™ä»£ç çš„é‚£ç§ï¼Œç„¶åæˆ‘éƒ½æ²¡åšå¯¹â€¦è®°å½•ä¸€ä¸‹</p><a id="more"></a><p>å‰å‡ å¤©é‡åˆ°ä¸¤ä¸ªå‰ç«¯é¢è¯•é¢˜ï¼Œè¦å†™ä»£ç çš„é‚£ç§ï¼Œç„¶åæˆ‘éƒ½æ²¡åšå¯¹â€¦è®°å½•ä¸€ä¸‹</p><h2 id="ç¬¬ä¸€é¢˜"><a href="#ç¬¬ä¸€é¢˜" class="headerlink" title="ç¬¬ä¸€é¢˜"></a>ç¬¬ä¸€é¢˜</h2><blockquote><p>JavaScript é‡‡ç”¨åŸå‹ç»§æ‰¿ï¼Œå³ä¸€ä¸ªå¯¹è±¡ç»§æ‰¿è‡ªå¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼Œå¦å¤–ä¸€ä¸ªå¯¹è±¡å†ç»§æ‰¿è‡ªåˆ«çš„å¯¹è±¡ï¼Œä¾æ­¤å¾€å¤ã€‚è¯·å†™ä¸€ä¸ªé€šç”¨çš„ JavaScript å‡½æ•°ï¼Œæ¥æ‰¾å‡ºæŸä¸ªå¯¹è±¡èº«ä¸Šçš„æŸä¸ªå±æ€§ç»§æ‰¿è‡ªå“ªä¸ªå¯¹è±¡ã€‚</p></blockquote><p>è§£ç­”: å®é™…ä¸Šæ˜¯åœ¨è€ƒå¯Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡ä¸Šçš„å±æ€§æ˜¯æœ¬èº«çš„è¿˜æ˜¯é€šè¿‡ç»§æ‰¿æ¥çš„ï¼Œä½¿ç”¨ <code>hasOwnProperty</code> å’Œ <code>getPrototypeOf</code> æ–¹æ³•å³å¯</p><pre><code>function getPrototype(obj, key) {  if (obj.hasOwnProperty(key)) {    return obj  }  return getPrototype(Object.getPrototypeOf(obj), key)}const obj = { a: 'a' }const o1 = Object.create(obj)o1.b = 'b'console.log(o1.a) // aconsole.log(o1.b) // bconsole.log(o1.hasOwnProperty('a')) // falseconsole.log(o1.hasOwnProperty('b')) // trueconsole.log(getPrototype(o1, 'a')) // { a: 'a' }console.log(getPrototype(o1, 'b')) // { b: 'b' }</code></pre><p>ç›¸å…³æ–‡ç« </p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain" target="_blank" rel="noopener">ç»§æ‰¿ä¸åŸå‹é“¾</a></p><h2 id="ç¬¬äºŒé¢˜"><a href="#ç¬¬äºŒé¢˜" class="headerlink" title="ç¬¬äºŒé¢˜"></a>ç¬¬äºŒé¢˜</h2><blockquote><p><code>URLSearchParams()</code> å¯ä»¥è§£æå’Œå¤„ç†URLå‚æ•°ï¼Œç›®å‰å…¼å®¹æ€§ä¸€èˆ¬ï¼Œè¯·å®ç° <code>class URLSearchParams</code> çš„ polyfillã€‚</p><pre><code class="js">searchParams = new URLSearchParams(&quot;foo=1&amp;bar=2&quot;)// æˆ–è€…è¿™æ ·ä¼ å…¥searchParams = new URLSearchParams({foo: &quot;1&quot;, bar: &quot;2&quot;})// å®ä¾‹æ”¯æŒ get()ã€set()ã€has()ã€append() å››ä¸ªæ–¹æ³•// æ”¯æŒä»¥ä¸‹æ–¹å¼searchParams.get(&quot;foo&quot;) // 1searchParams.set(&quot;foo&quot;, &quot;10&quot;)searchParams.has(&quot;bar&quot;)searchParams.append(&quot;foo&quot;, &quot;100&quot;)</code></pre></blockquote><p>è§£ç­”ï¼šç®€å•å®ç°äº†ä¸‹ï¼Œçœ‹äº† Github ä¸Š <code>URLSearchParams</code> çš„ polyfill ä»£ç ï¼Œå‘ç°è¿™ä¸ªè¿˜æ˜¯æœ‰ç‚¹å¤æ‚çš„</p><pre><code>class URLSearchParams {  constructor (query) {    this._query = {}    if (typeof query === 'string') {      if (query.startsWith('?', 0)) {        query = query.slice(1)      }      query.split('&').forEach(pair => {        const params = pair.split('=')        const key = params[0]        const val = params[1]        this._query[key] = val      })    } else {      for (let [key, value] of Object.entries(query)) {        this._query[key] = query[key]      }    }  }  get (key) {    return this.has(key) ? this._query[key] : null  }  set (key, val) {    this._query[key] = encodeURIComponent(val)    return true  }  has (key) {    return key in this._query  }  append (key, val) {    const value = Array.isArray(val) ? val.join(',') : val    if (key in this._query) {      this._query[key].push(value)    } else {      this._query[key] = value    }    return this._query[key]  }}const mysp1 = new URLSearchParams('a=aaa&b=bbb')const mysp2 = new URLSearchParams({ c: 'ccc', d: 'ddd' })console.log(mysp1) // URLSearchParams { _query: { a: 'aaa', b: 'bbb' } }console.log(mysp1.get('a')) // aaaconsole.log(mysp1.set('c', 'ccc')) // trueconsole.log(mysp1.has('d')) // falseconsole.log(mysp1.append('e', 'eee')) // eeeconsole.log(mysp1) // { _query: { a: 'aaa', b: 'bbb', c: 'ccc', e: 'eee' } }console.log(mysp2) // URLSearchParams { _query: { c: 'ccc', d: 'ddd' } }console.log(mysp2.get('c')) // cccconsole.log(mysp2.set('d', 'ddd2')) // trueconsole.log(mysp2.has('d')) // trueconsole.log(mysp2.append('f', 'fff')) // fffconsole.log(mysp2) // URLSearchParams { _query: { c: 'ccc', d: 'ddd2', f: 'fff' } }</code></pre><p>ç›¸å…³æ–‡ç« </p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/URLSearchParams" target="_blank" rel="noopener">URLSearchParams docs</a></p><p><a href="https://github.com/ungap/url-search-params" target="_blank" rel="noopener">URLSearchParams polyfill</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è‡ªå·±å¤ªèœäº†ï¼ŒåŸºç¡€çŸ¥è¯†ç”±äºæ²¡æœ‰å»å›é¡¾æ‰€ä»¥å¿˜çš„å¾ˆå¤šï¼Œç»§ç»­åŠ æ²¹å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰å‡ å¤©é‡åˆ°ä¸¤ä¸ªå‰ç«¯é¢è¯•é¢˜ï¼Œè¦å†™ä»£ç çš„é‚£ç§ï¼Œç„¶åæˆ‘éƒ½æ²¡åšå¯¹â€¦è®°å½•ä¸€ä¸‹&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Interview" scheme="https://coldstone.fun/tags/Interview/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ FFmpeg è½¬æ¢è§†é¢‘æ ¼å¼</title>
    <link href="https://coldstone.fun/post/2019/11/11/simple-use-ffmpeg/"/>
    <id>https://coldstone.fun/post/2019/11/11/simple-use-ffmpeg/</id>
    <published>2019-11-11T12:12:26.000Z</published>
    <updated>2020-06-18T09:46:58.876Z</updated>
    
    <content type="html"><![CDATA[<p>ç”¨ B ç«™ä¸‹è½½åŠ©æ‰‹ ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘æ ¼å¼æ˜¯ <code>flv</code>ï¼Œç”¨ QuickTime çœ‹ä¸äº†ä¹Ÿä¸èƒ½å¯¼å…¥ iMovie è¿›è¡Œç¼–è¾‘ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸€ä¸‹è§†é¢‘æ ¼å¼ã€‚åœ¨æœç´¢äº†å¾ˆå¤šè§†é¢‘æ ¼å¼è½¬æ¢å·¥å…·åï¼Œå‘ç°å®ƒä»¬å¤§å¤šåº•å±‚æ˜¯ç”¨ <a href="https://www.ffmpeg.org/" target="_blank" rel="noopener">FFmpeg</a> è¿™ä¸ªå¼€æºå·¥å…·è¿›è¡Œè½¬æ¢çš„ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ <code>FFmpeg</code> å®ƒæœ¬èº«å‘¢</p><a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”¨ B ç«™ä¸‹è½½åŠ©æ‰‹ ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘æ ¼å¼æ˜¯ <code>flv</code>ï¼Œç”¨ QuickTime çœ‹ä¸äº†ä¹Ÿä¸èƒ½å¯¼å…¥ iMovie è¿›è¡Œç¼–è¾‘ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸€ä¸‹è§†é¢‘æ ¼å¼ã€‚åœ¨æœç´¢äº†å¾ˆå¤šè§†é¢‘æ ¼å¼è½¬æ¢å·¥å…·åï¼Œå‘ç°å®ƒä»¬å¤§å¤šåº•å±‚æ˜¯ç”¨ <a href="https://www.ffmpeg.org/" target="_blank" rel="noopener">FFmpeg</a> è¿™ä¸ªå¼€æºå·¥å…·è¿›è¡Œè½¬æ¢çš„ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ <code>FFmpeg</code> å®ƒæœ¬èº«å‘¢ã€‚</p><h2 id="å…³äº-FFmpeg"><a href="#å…³äº-FFmpeg" class="headerlink" title="å…³äº FFmpeg"></a>å…³äº FFmpeg</h2><p>å®˜æ–¹æè¿°ï¼šFFmpeg æ˜¯ä¸€ç§éå¸¸å¿«é€Ÿçš„è§†é¢‘å’ŒéŸ³é¢‘è½¬æ¢å™¨ï¼Œä¹Ÿå¯ä»¥ä»å®æ—¶éŸ³é¢‘/è§†é¢‘æºä¸­è·å–ã€‚ å®ƒè¿˜å¯ä»¥åœ¨ä»»æ„é‡‡æ ·ç‡ä¹‹é—´è½¬æ¢ï¼Œå¹¶ä½¿ç”¨é«˜è´¨é‡çš„å¤šç›¸æ»¤æ³¢å™¨å³æ—¶è°ƒæ•´è§†é¢‘å¤§å°ã€‚</p><p>è½¬æ¢æµç¨‹</p><pre><code class="pre"> _______              ______________|       |            |              || input |  demuxer   | encoded data |   decoder| file  | ---------&gt; | packets      | -----+|_______|            |______________|      |                                           v                                       _________                                      |         |                                      | decoded |                                      | frames  |                                      |_________| ________             ______________       ||        |           |              |      || output | &lt;-------- | encoded data | &lt;----+| file   |   muxer   | packets      |   encoder|________|           |______________|</code></pre><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>é¦–å…ˆå®‰è£… <code>FFmpeg</code>ï¼ŒmacOS å¯ä»¥ä½¿ç”¨ <code>homebrew</code> å®‰è£…</p><pre><code class="sh">brew install ffmpeg</code></pre><p>Windows åˆ° <code>https://ffmpeg.zeranoe.com/builds</code> è¿™é‡Œä¸‹è½½ zip åŒ…ï¼Œç„¶åå°† <code>bin</code> ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ <code>PATH</code> ä¸­ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ <code>ffmpeg</code> å‘½ä»¤ï¼Œå‡ºç°æç¤ºè¯­å³è¡¨ç¤ºå®‰è£…æˆåŠŸ</p><p><img src="images/ffmpeg-hint.jpg" alt="hint"></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åªéœ€ä¸€æ¡å‘½ä»¤å³å¯å¯¹è§†é¢‘è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œ<code>-i</code> å‚æ•°è¡¨ç¤ºéœ€è¦è½¬æ¢çš„è§†é¢‘ï¼Œå€¼æ˜¯è§†é¢‘è·¯å¾„ï¼Œåé¢çš„æ˜¯è½¬æ¢åçš„è§†é¢‘æ–‡ä»¶åã€‚</p><pre><code class="sh">ffmpeg -i input.mp4 output.avi</code></pre><p>è½¬æ¢è¿‡ç¨‹ä¸­ä¼šå‡ºç°è¿›åº¦æç¤º</p><p><img src="images/ffmpeg-running.jpg" alt="running"></p><ul><li><code>frame</code> è¡¨ç¤ºæ˜¯è½¬ç æ‰€è¿›è¡Œåˆ°çš„å¸§æ•°ã€‚</li><li><code>fps</code> è¡¨ç¤ºä¸­çš„ FPS å°±æ˜¯ Frame per Second ï¼Œæ˜¯ç°åœ¨ç”µè„‘æ¯ç§’æ‰€å¤„ç†çš„å¸§çš„æ•°é‡ï¼Œè¿™ä¸ªæ•°å­—è·Ÿè§†é¢‘çš„å¸§ç‡æ— å…³ã€‚</li><li><code>size</code> è¡¨ç¤ºå·²ç»è½¬æ¢å‡ºæ¥çš„è§†é¢‘çš„ä½“ç§¯ã€‚</li><li><code>time</code> è¡¨ç¤ºç»è½¬æ¢å‡ºæ¥çš„è§†é¢‘çš„æ—¶é—´ã€‚</li></ul><h2 id="è½¬æ¢å‚æ•°"><a href="#è½¬æ¢å‚æ•°" class="headerlink" title="è½¬æ¢å‚æ•°"></a>è½¬æ¢å‚æ•°</h2><p><code>-r</code></p><p>è¿™ä¸ªé€‰é¡¹è®¾ç½®è§†é¢‘å¸§ç‡, å•ä½æ˜¯ Hzï¼Œä¹Ÿå°±æ˜¯å¸§æ¯ç§’ FPSï¼Œå¦‚ <code>-r 30</code> å³ä»£è¡¨è¾“å‡ºè§†é¢‘çš„å¸§ç‡ä¸ºæ¯ç§’ 30 å¸§ï¼Œé™ä½å¸§ç‡å¯ä»¥å‡å°è§†é¢‘çš„ä½“ç§¯ã€‚</p><pre><code class="sh">ffmpeg -i input.mp4 -r 30 output.mp4</code></pre><p><code>-s</code></p><p>é»˜è®¤è¾“å‡ºçš„è§†é¢‘å°ºå¯¸ä¸åŸè§†é¢‘ç›¸åŒï¼Œ<code>-s 720x480</code> é€‰é¡¹å¯ä»¥æŒ‡å®šè¾“å‡ºè§†é¢‘çš„å°ºå¯¸ï¼Œä»¥åƒç´ ä¸ºå•ä½ã€‚</p><pre><code class="sh">ffmpeg -i input.mp4 -s 720x480 output.mp4</code></pre><p><code>-t</code></p><p>ç”¨æ¥æŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„æŒç»­æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå¦‚æˆªå– input.mp4 çš„å‰ 30 ç§’å¹¶ä¿å­˜ä¸º output.mp4ã€‚</p><pre><code class="sh">ffmpeg -i input.mp4 -t 30 output.mp4</code></pre><p><code>-c</code></p><p>ç”¨æ¥æŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„ç¼–ç ï¼Œè®¾ç½® <code>-c copy</code> è®© <code>FFmpeg</code> åœ¨è½¬æ¢éŸ³è§†é¢‘æ—¶ä¸é‡æ–°è¿›è¡Œç¼–ç ï¼Œå‡å°‘è½¬æ¢è€—æ—¶ã€‚</p><pre><code class="sh">ffmpeg -i input.mp4 -c copy -t 30 output.mp4</code></pre><p>æ‰§è¡Œ help å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šå…³äºè§†é¢‘è½¬æ¢çš„é€‰é¡¹</p><pre><code class="sh">ffmpeg -help</code></pre><p><img src="images/ffmpeg-video-opt.jpg" alt="video-options"></p><ul><li><code>-vframes</code> è®¾ç½®è¦è¾“å‡ºçš„è§†é¢‘å¸§æ•°</li><li><code>-r</code> é€Ÿç‡è®¾ç½®å¸§é€Ÿç‡ï¼ˆHzå€¼ï¼Œåˆ†æ•°æˆ–ç¼©å†™ï¼‰</li><li><code>-s</code> sizeè®¾ç½®å¸§å¤§å°ï¼ˆWxHæˆ–ç¼©å†™ï¼‰</li><li><code>-aspect</code> å®½é«˜æ¯”è®¾ç½®çš„å®½é«˜æ¯”ï¼ˆ4ï¼š3ã€16ï¼š9æˆ–1.3333ã€1.7777ï¼‰</li><li><code>-bits_per_raw_sample</code> è®¾ç½®æ¯ä¸ªåŸå§‹æ ·æœ¬çš„ä½æ•°</li><li><code>-vn</code> ç¦ç”¨è§†é¢‘</li><li><code>-vcodec</code> ç¼–è§£ç å™¨å¼ºåˆ¶è§†é¢‘ç¼–è§£ç å™¨ï¼ˆâ€œå¤åˆ¶â€ä»¥å¤åˆ¶æµï¼‰</li><li><code>-timecode</code> å•ä½ hhï¼šmmï¼šss [ï¼š;ã€‚] ffè®¾ç½®åˆå§‹ TimeCode å€¼ã€‚</li><li><code>-pass n</code> é€‰æ‹©é€šè¿‡æ¬¡æ•°ï¼ˆ1åˆ°3ï¼‰</li><li><code>-vf filter_graph</code> è®¾ç½®è§†é¢‘è¿‡æ»¤å™¨</li><li><code>-ab</code> æ¯”ç‰¹ç‡éŸ³é¢‘æ¯”ç‰¹ç‡ï¼ˆè¯·ä½¿ç”¨-bï¼šaï¼‰</li><li><code>-b</code> æ¯”ç‰¹ç‡è§†é¢‘æ¯”ç‰¹ç‡ï¼ˆè¯·ä½¿ç”¨-bï¼švï¼‰</li><li><code>-dn</code> ç¦ç”¨æ•°æ®</li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.ffmpeg.org/documentation.html" target="_blank" rel="noopener">FFmpeg Documentation</a></p><p><a href="https://wiki.fiveyellowmice.com/wiki/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8_FFmpeg_%E8%BF%9B%E8%A1%8C%E8%A7%86%E9%A2%91%E8%BD%AC%E7%A0%81:%E9%A6%96%E9%A1%B5" target="_blank" rel="noopener">å¦‚ä½•ä½¿ç”¨_FFmpeg_è¿›è¡Œè§†é¢‘è½¬ç </a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”¨ B ç«™ä¸‹è½½åŠ©æ‰‹ ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘æ ¼å¼æ˜¯ &lt;code&gt;flv&lt;/code&gt;ï¼Œç”¨ QuickTime çœ‹ä¸äº†ä¹Ÿä¸èƒ½å¯¼å…¥ iMovie è¿›è¡Œç¼–è¾‘ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢ä¸€ä¸‹è§†é¢‘æ ¼å¼ã€‚åœ¨æœç´¢äº†å¾ˆå¤šè§†é¢‘æ ¼å¼è½¬æ¢å·¥å…·åï¼Œå‘ç°å®ƒä»¬å¤§å¤šåº•å±‚æ˜¯ç”¨ &lt;a href=&quot;https://www.ffmpeg.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;FFmpeg&lt;/a&gt; è¿™ä¸ªå¼€æºå·¥å…·è¿›è¡Œè½¬æ¢çš„ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ &lt;code&gt;FFmpeg&lt;/code&gt; å®ƒæœ¬èº«å‘¢&lt;/p&gt;
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://coldstone.fun/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="FFmpeg" scheme="https://coldstone.fun/tags/FFmpeg/"/>
    
  </entry>
  
</feed>
